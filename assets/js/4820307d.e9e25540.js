"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[218],{3905:(e,t,r)=>{r.d(t,{Zo:()=>s,kt:()=>S});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var c=n.createContext({}),i=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},s=function(e){var t=i(e.components);return n.createElement(c.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),u=i(r),m=a,S=u["".concat(c,".").concat(m)]||u[m]||d[m]||o;return r?n.createElement(S,l(l({ref:t},s),{},{components:r})):n.createElement(S,l({ref:t},s))}));function S(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,l=new Array(o);l[0]=m;var p={};for(var c in t)hasOwnProperty.call(t,c)&&(p[c]=t[c]);p.originalType=e,p[u]="string"==typeof e?e:a,l[1]=p;for(var i=2;i<o;i++)l[i]=r[i];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},5007:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>p,toc:()=>i});var n=r(7462),a=(r(7294),r(3905));const o={sidebar_position:13},l="\u8ab0\u8aaa\u4e00\u5b9a\u8981\u76f4\u63a5\u57f7\u884c JavaScript \u624d\u80fd\u653b\u64ca\uff1f",p={unversionedId:"ch3/attack-without-js",id:"ch3/attack-without-js",title:"\u8ab0\u8aaa\u4e00\u5b9a\u8981\u76f4\u63a5\u57f7\u884c JavaScript \u624d\u80fd\u653b\u64ca\uff1f",description:"\u5beb\u5230\u9019\u88e1\uff0c\u7b2c\u4e8c\u7ae0\u300cXSS \u7684\u9632\u79a6\u65b9\u5f0f\u4ee5\u53ca\u7e5e\u904e\u624b\u6cd5\u300d\u6b63\u5f0f\u544a\u4e00\u6bb5\u843d\u3002",source:"@site/docs/ch3/13-attack-without-js.md",sourceDirName:"ch3",slug:"/ch3/attack-without-js",permalink:"/beyond-xss/ch3/attack-without-js",draft:!1,tags:[],version:"current",sidebarPosition:13,frontMatter:{sidebar_position:13},sidebar:"tutorialSidebar",previous:{title:"\u6700\u5f37\u7684 XSS\uff1aUniversal XSS",permalink:"/beyond-xss/ch2/universal-xss"},next:{title:"\u5229\u7528\u539f\u578b\u93c8\u7684\u653b\u64ca\u65b9\u5f0f\uff1aPrototype Pollution",permalink:"/beyond-xss/ch3/prototype-pollution"}},c={},i=[],s={toc:i},u="wrapper";function d(e){let{components:t,...o}=e;return(0,a.kt)(u,(0,n.Z)({},s,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u8ab0\u8aaa\u4e00\u5b9a\u8981\u76f4\u63a5\u57f7\u884c-javascript-\u624d\u80fd\u653b\u64ca"},"\u8ab0\u8aaa\u4e00\u5b9a\u8981\u76f4\u63a5\u57f7\u884c JavaScript \u624d\u80fd\u653b\u64ca\uff1f"),(0,a.kt)("p",null,"\u5beb\u5230\u9019\u88e1\uff0c\u7b2c\u4e8c\u7ae0\u300cXSS \u7684\u9632\u79a6\u65b9\u5f0f\u4ee5\u53ca\u7e5e\u904e\u624b\u6cd5\u300d\u6b63\u5f0f\u544a\u4e00\u6bb5\u843d\u3002"),(0,a.kt)("p",null,"\u6211\u5011\u82b1\u4e86\u8a31\u591a\u7684\u7bc7\u5e45\u5728\u8a0e\u8ad6 XSS\uff0c\u5305\u62ec\u5404\u7a2e\u80fd\u5920\u57f7\u884c XSS \u7684\u65b9\u5f0f\u3001\u9632\u79a6\u65b9\u5f0f\u4ee5\u53ca\u7e5e\u904e\u624b\u6cd5\u7b49\u7b49\uff0c\u4ee5\u7db2\u9801\u524d\u7aef\u4f86\u8aaa\uff0c\u80fd\u5920\u5c0d\u7db2\u9801\u505a\u7684\u6700\u56b4\u91cd\u7684\u4e8b\u60c5\uff0c\u57fa\u672c\u4e0a\u5c31\u662f\u57f7\u884c\u7a0b\u5f0f\u78bc\u4e86\u3002"),(0,a.kt)("p",null,"\u800c\u5728\u653b\u64ca\u7684\u7bc4\u4f8b\u4e2d\uff0c\u6211\u5011\u57fa\u672c\u4e0a\u90fd\u662f\u4ee5\u300c\u80fd\u5920\u6ce8\u5165 HTML\u300d\u505a\u70ba\u524d\u63d0\uff0c\u518d\u60f3\u8fa6\u6cd5\u8f49\u8b8a\u6210 XSS\u3002\u96d6\u7136\u8aaa\u5728\u4e4b\u524d\u7684\u7bc4\u4f8b\u4e2d\u90fd\u53ea\u662f\u4f7f\u7528\u9019\u500b\u7c21\u55ae\u7684 payload\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"<img src=x onload=alert(1)>"),"\uff0c\u4f46\u5728\u73fe\u5be6\u4e16\u754c\u7684\u72c0\u6cc1\u4e2d\u6216\u8a31\u4e26\u4e0d\u6703\u9019\u9ebc\u5bb9\u6613\u3002"),(0,a.kt)("p",null,"\u8209\u4f8b\u4f86\u8aaa\uff0c\u4e4b\u524d\u6709\u7a0d\u5fae\u63d0\u904e\u5176\u5be6\u9084\u6709\u4e00\u9053\u9632\u7dda\u53eb\u505a WAF\uff0cWeb Application Firewall\uff0c\u61c9\u7528\u7a0b\u5f0f\u5c08\u7528\u7684\u9632\u706b\u7246\uff0c\u5229\u7528\u4e00\u4e9b\u5df2\u7d93\u5beb\u597d\u7684\u898f\u5247\u963b\u64cb\u300c\u770b\u8d77\u4f86\u5c31\u5f88\u90aa\u60e1\u300d\u7684 payload\u3002"),(0,a.kt)("p",null,"\u4f8b\u5982\u8aaa Dcard \u5c31\u6709\u7528 Cloudflare \u7684 WAF\uff0c\u4f60\u53ef\u4ee5\u8a66\u8457\u9ede\u64ca\u9019\u500b\u9023\u7d50\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://www.dcard.tw/?a=%3Cscript%3E"},"https://www.dcard.tw/?a=%3Cscript%3E")),(0,a.kt)("p",null,"\u5c31\u6703\u770b\u5230\u88ab\u963b\u64cb\u7684\u63d0\u793a\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{src:r(6077).Z,width:"1064",height:"813"})),(0,a.kt)("p",null,"\u800c\u6700\u77e5\u540d\u7684\u958b\u6e90 WAF \u83ab\u904e\u65bc ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/SpiderLabs/ModSecurity"},"ModSecurity"),"\uff0c\u63d0\u4f9b\u4e86\u4e00\u500b\u57fa\u790e\u5efa\u8a2d\uff0c\u8b93\u5de5\u7a0b\u5e2b\u53ef\u4ee5\u81ea\u5df1\u6dfb\u52a0\u963b\u64cb\u7684\u898f\u5247\uff0c\u4e5f\u53ef\u4ee5\u7528\u5225\u4eba\u5beb\u7684\u3002"),(0,a.kt)("p",null,"\u50cf\u662f ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/coreruleset/coreruleset/tree/v4.0/dev"},"OWASP ModSecurity Core Rule Set (CRS)")," \u5c31\u662f\u500b\u958b\u6e90\u7684\u898f\u5247\u5408\u96c6\uff0c\u6211\u5011\u4f86\u770b\u4e00\u5c0f\u6bb5\uff1a"),(0,a.kt)("p",null,"\u4f86\u6e90\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/coreruleset/coreruleset/blob/v4.0/dev/rules/REQUEST-941-APPLICATION-ATTACK-XSS.conf#L105"},"coreruleset/rules/REQUEST-941-APPLICATION-ATTACK-XSS.conf")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-conf"},"#\n# -=[ XSS Filters - Category 1 ]=-\n# http://xssplayground.net23.net/xssfilter.html\n# script tag based XSS vectors, e.g., <script> alert(1)<\/script>\n#\nSecRule REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|REQUEST_HEADERS:User-Agent|REQUEST_HEADERS:Referer|ARGS_NAMES|ARGS|XML:/* \"@rx (?i)<script[^>]*>[\\s\\S]*?\" \\\n    \"id:941110,\\\n    phase:2,\\\n    block,\\\n    capture,\\\n    t:none,t:utf8toUnicode,t:urlDecodeUni,t:htmlEntityDecode,t:jsDecode,t:cssDecode,t:removeNulls,\\\n    msg:'XSS Filter - Category 1: Script Tag Vector',\\\n    logdata:'Matched Data: %{TX.0} found within %{MATCHED_VAR_NAME}: %{MATCHED_VAR}',\\\n    tag:'application-multi',\\\n    tag:'language-multi',\\\n    tag:'platform-multi',\\\n    tag:'attack-xss',\\\n    tag:'paranoia-level/1',\\\n    tag:'OWASP_CRS',\\\n    tag:'capec/1000/152/242',\\\n    ver:'OWASP_CRS/4.0.0-rc1',\\\n    severity:'CRITICAL',\\\n    setvar:'tx.xss_score=+%{tx.critical_anomaly_score}',\\\n    setvar:'tx.inbound_anomaly_score_pl1=+%{tx.critical_anomaly_score}'\"\n")),(0,a.kt)("p",null,"\u9019\u500b\u898f\u5247\u5c31\u5229\u7528\u4e86\u6b63\u898f\u8868\u9054\u5f0f ",(0,a.kt)("inlineCode",{parentName:"p"},"<script[^>]*>[\\s\\S]*?")," \u4f86\u627e\u51fa\u542b\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"<script")," \u7684 \u7a0b\u5f0f\u78bc\uff0c\u4e26\u4e14\u5c07\u5176\u963b\u64cb\uff0c\u56e0\u6b64 ",(0,a.kt)("inlineCode",{parentName:"p"},"<script>alert(1)<\/script>")," \u5c31\u6703\u88ab\u5075\u6e2c\u4e26\u4e14\u64cb\u4e0b\u3002"),(0,a.kt)("p",null,"\u800c\u6211\u5011\u6700\u559c\u6b61\u4f7f\u7528\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"<img src=x onerror=alert()>")," \u4e5f\u6709\u5176\u4ed6\u898f\u5247\u5c0d\u61c9\u5230\u4e86\uff0c\u6240\u4ee5\u5728\u5be6\u6230\u4e2d\u5e38\u78b0\u5230\u7684\u5c31\u662f\u8208\u9ad8\u91c7\u70c8\u5730\u4ee5\u70ba\u9019\u7db2\u7ad9\u5f88\u721b\u5f88\u597d\u6253\uff0c\u6b8a\u4e0d\u77e5\u88ab WAF \u64cb\u5f97\u4e0d\u8981\u4e0d\u8981\u7684\uff0c\u4e00\u76f4\u770b\u5230\u756b\u9762\u51fa\u73fe\u932f\u8aa4\u8996\u7a97\uff0c\u660e\u660e\u6f0f\u6d1e\u5c31\u662f\u5b58\u5728\uff0c\u537b\u56e0\u70ba WAF \u7684\u95dc\u4fc2\u6253\u4e0d\u9032\u53bb\u3002"),(0,a.kt)("p",null,"\u9019\u7a2e\u99ed\u5ba2\u8207\u7db2\u7ad9\u7684\u653b\u9632\u662f\u8cc7\u5b89\u6709\u8da3\u7684\u5730\u65b9\u4e4b\u4e00\uff0c\u4e5f\u662f\u70ba\u4ec0\u9ebc\u7d93\u9a57\u8ddf\u77e5\u8b58\u91cf\u5f88\u91cd\u8981\u3002\u4ee5 WAF \u4f86\u8aaa\uff0c\u5728\u63a8\u7279\u4e0a\u5e38\u5e38\u6703\u51fa\u73fe\u8a31\u591a\u7684 WAF bypass payload\uff0c\u70ba\u4e86\u8981\u7e5e\u904e WAF\uff0c\u5167\u5bb9\u901a\u5e38\u90fd\u9577\u5f97\u6eff\u300c\u5641\u5fc3\u300d\u7684\uff0c\u50cf\u9019\u500b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<details/open=/Open/href=/data=; ontoggle="(alert)(document.domain)\n')),(0,a.kt)("p",null,"\u5176\u5be6\u9019\u500b paylod \u60f3\u57f7\u884c\u7684\u5167\u5bb9\u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"<details open ontoggle=alert(document.domain)>"),"\uff0c\u4f46\u662f\u7528\u4e86\u4e00\u5806\u5176\u4ed6\u95dc\u9375\u5b57\u4f86\u6df7\u6dc6\uff0c\u6709\u5f88\u591a WAF \u662f\u6839\u64da\u6b63\u5247\u8868\u9054\u5f0f\u4f86\u5224\u65b7\uff0c\u56e0\u6b64\u53ea\u8981\u8b93 WAF \u4e0d\u5bb9\u6613\u8fa8\u8b58\u51fa\u4f86\uff0c\u5c31\u80fd\u9760\u9019\u6a23\u7684\u65b9\u6cd5\u7e5e\u904e WAF\u3002"),(0,a.kt)("p",null,"\u90a3\u5982\u679c\u7e5e\u4e0d\u904e\u5462\uff1f"),(0,a.kt)("p",null,"\u5c31\u7b97\u7db2\u7ad9\u53ef\u4ee5\u63d2\u5165 HTML \u53c8\u600e\u6a23\uff0c\u80fd\u57f7\u884c XSS \u7684 payload \u5982\u679c\u5beb\u4e0d\u9032\u53bb\uff0c\u8c48\u4e0d\u662f\u5c31\u6c92\u62db\u4e86\uff1f\u9019\u5c31\u4e0d\u4e00\u5b9a\u4e86\u3002"),(0,a.kt)("p",null,"\u6703\u9019\u6a23\u8a8d\u70ba\uff0c\u901a\u5e38\u662f\u56e0\u70ba\u5c0d\u524d\u7aef\u8cc7\u5b89\u7684\u8a8d\u8b58\u53ea\u6709 XSS\uff0c\u7e3d\u89ba\u5f97\u4e00\u5b9a\u8981\u80fd\u5920\u76f4\u63a5\u57f7\u884c\u7a0b\u5f0f\u78bc\u624d\u80fd\u9054\u6210\u653b\u64ca\u3002\u4e8b\u5be6\u4e0a\uff0c\u9084\u6709\u5f88\u591a\u7a2e\u300c\u9593\u63a5\u653b\u64ca\u300d\u7684\u65b9\u5f0f\uff0c\u800c\u6709\u4e9b\u653b\u64ca\u624b\u6cd5\u751a\u81f3\u9023 JavaScript \u90fd\u4e0d\u9700\u8981\u57f7\u884c\u3002"),(0,a.kt)("p",null,"\u5982\u540c\u6211\u5728\u7cfb\u5217\u958b\u982d\u6240\u8aaa\u7684\uff0c\u524d\u7aef\u8cc7\u5b89\u662f\u4e00\u500b\u5ee3\u95ca\u7684\u5b87\u5b99\uff0c\u6211\u5011\u5df2\u7d93\u7528\u4e86\u4e0d\u5c11\u6642\u9593\u63a2\u7d22\u4e86 XSS\uff0c\u662f\u6642\u5019\u9032\u5165\u4e00\u500b\u65b0\u7684\u661f\u7cfb\u4e86\uff01\u8b93\u6211\u5011\u77ed\u66ab\u4f11\u606f\u4e00\u4e0b\uff0c\u5f9e\u4e0b\u4e00\u7bc7\u958b\u59cb\u5c31\u6703\u6b63\u5f0f\u9032\u5165\u5230\u7b2c\u4e09\u7ae0\uff1a\u300c\u4e0d\u76f4\u63a5\u57f7\u884c JavaScript \u7684\u653b\u64ca\u624b\u6cd5\u300d\u3002"),(0,a.kt)("p",null,"\u5728\u63a5\u4e0b\u4f86\u7684\u5167\u5bb9\u4e2d\uff0c\u6211\u6703\u4ecb\u7d39\u66f4\u591a\u9664\u4e86 XSS \u4ee5\u5916\u7684\u653b\u64ca\u624b\u6cd5\u3002"),(0,a.kt)("p",null,"\u7b2c\u4e09\u7ae0\u7684\u5167\u5bb9\u6703\u5faa\u5e8f\u6f38\u9032\uff0c\u5f9e\u300c\u9593\u63a5\u5f71\u97ff JavaScript \u7684\u57f7\u884c\u300d\u4e00\u76f4\u5230\u300c\u771f\u7684\u90fd\u4e0d\u7528 JavaScript\u300d\uff0c\u518d\u5230\u300c\u4e0d\u53ea JavaScript\uff0c\u9023 CSS \u4e5f\u4e0d\u9700\u8981\u300d\uff0c\u4e0d\u65b7\u5730\u53bb\u63a2\u7d22\u524d\u7aef\u653b\u64ca\u7684\u6975\u9650\u5728\u54ea\u88e1\u3002"),(0,a.kt)("p",null,"\u5728\u9032\u5165\u7b2c\u4e09\u7ae0\u4e4b\u524d\uff0c\u5927\u5bb6\u4e5f\u53ef\u4ee5\u60f3\u4e00\u4e0b\u81ea\u5df1\u807d\u904e\u54ea\u4e9b\u300c\u4e0d\u76f4\u63a5\u57f7\u884c JavaScript\u300d\u7684\u653b\u64ca\u624b\u6cd5\uff0c\u5f88\u6709\u53ef\u80fd\u5c31\u662f\u4e4b\u5f8c\u6703\u51fa\u73fe\u7684\u5167\u5bb9\u3002"),(0,a.kt)("p",null,"\u6700\u5f8c\u4e00\u6a23\u4f86\u500b\u5c0f\u6e2c\u9a57\uff0c\u5c0f\u660e\u5728\u5be6\u4f5c\u4e00\u500b\u591a\u4eba\u7e6a\u756b\u904a\u6232\uff0c\u7528\u4e8c\u7dad\u9663\u5217\u4ee3\u8868\u756b\u5e03\uff0c\u73a9\u5bb6\u53ef\u4ee5\u5728\u4efb\u4f55\u4e00\u683c\u756b\u4e0a\u60f3\u8981\u7684\u984f\u8272\uff0c\u6703\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"onmessage")," \u63a5\u6536\u8cc7\u8a0a\u4e26\u4e14\u6539\u8b8a\u9663\u5217\uff0c\u5be6\u4f5c\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"onmessage = function(event){\n  const { x, y, color } = event.data\n  // for example, screen[10][5] = 'red'\n  screen[y][x] = color\n}\n")),(0,a.kt)("p",null,"\u8acb\u554f\u9019\u6a23\u7684\u7a0b\u5f0f\u78bc\u6709\u4ec0\u9ebc\u554f\u984c\uff1f\u6211\u5011\u4e0b\u4e00\u7bc7\u63ed\u66c9\u3002"))}d.isMDXComponent=!0},6077:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/13-01-196dd43ab77bc4c93c53265fe3e0727b.png"}}]);