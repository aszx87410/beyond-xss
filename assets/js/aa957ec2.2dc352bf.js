"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[935],{3905:(e,t,i)=>{i.d(t,{Zo:()=>s,kt:()=>d});var n=i(7294);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function r(e,t){if(null==e)return{};var i,n,a=function(e,t){if(null==e)return{};var i,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)i=l[n],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)i=l[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var p=n.createContext({}),m=function(e){var t=n.useContext(p),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},s=function(e){var t=m(e.components);return n.createElement(p.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var i=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,s=r(e,["components","mdxType","originalType","parentName"]),u=m(i),c=a,d=u["".concat(p,".").concat(c)]||u[c]||h[c]||l;return i?n.createElement(d,o(o({ref:t},s),{},{components:i})):n.createElement(d,o({ref:t},s))}));function d(e,t){var i=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=i.length,o=new Array(l);o[0]=c;var r={};for(var p in t)hasOwnProperty.call(t,p)&&(r[p]=t[p]);r.originalType=e,r[u]="string"==typeof e?e:a,o[1]=r;for(var m=2;m<l;m++)o[m]=i[m];return n.createElement.apply(null,o)}return n.createElement.apply(null,i)}c.displayName="MDXCreateElement"},5218:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>m});var n=i(7462),a=(i(7294),i(3905));const l={sidebar_position:20},o="\u91cd\u4e2d\u4e4b\u91cd\uff1aSame-origin policy \u8207 site",r={unversionedId:"ch4/sop-and-site",id:"ch4/sop-and-site",title:"\u91cd\u4e2d\u4e4b\u91cd\uff1aSame-origin policy \u8207 site",description:"\u5728\u524d\u9762\u7684\u6587\u7ae0\u88e1\u6709\u63d0\u904e\u4e0d\u5c11\u6b21\u300csame-origin\u300d\u6216\u662f\u300c\u540c\u6e90\u300d\uff0c\u7121\u8ad6\u5728\u524d\u7aef\u6216\u662f\u8cc7\u5b89\u7684\u4e16\u754c\u88e1\u90fd\u662f\u500b\u975e\u5e38\u91cd\u8981\u7684\u540d\u8a5e\uff0c\u56e0\u70ba\u700f\u89bd\u5668\u7684\u540c\u6e90\u653f\u7b56\uff08Same-origin policy\uff09\u5728\u958b\u767c\u4e0a\u6703\u78b0\u5230\uff0c\u5728\u653b\u64ca\u7684\u6642\u5019\u4e5f\u6703\u78b0\u5230\uff0c\u81f3\u95dc\u91cd\u8981\u3002",source:"@site/docs/ch4/20-sop-and-site.md",sourceDirName:"ch4",slug:"/ch4/sop-and-site",permalink:"/beyond-xss/ch4/sop-and-site",draft:!1,tags:[],version:"current",sidebarPosition:20,frontMatter:{sidebar_position:20},sidebar:"tutorialSidebar",previous:{title:"\u5c31\u7b97\u53ea\u6709 HTML \u4e5f\u80fd\u653b\u64ca\uff1f",permalink:"/beyond-xss/ch3/html-attack"},next:{title:"\u8de8\u4f86\u6e90\u8cc7\u6e90\u5171\u7528 CORS \u57fa\u672c\u4ecb\u7d39",permalink:"/beyond-xss/ch4/cors-intro"}},p={},m=[{value:"Origin \u8ddf site \u5230\u5e95\u662f\u4ec0\u9ebc\uff1f\u8a72\u600e\u9ebc\u5340\u5206\uff1f",id:"origin-\u8ddf-site-\u5230\u5e95\u662f\u4ec0\u9ebc\u8a72\u600e\u9ebc\u5340\u5206",level:2},{value:"\u7d30\u7a76 same origin",id:"\u7d30\u7a76-same-origin",level:2},{value:"\u7d30\u7a76 same site",id:"\u7d30\u7a76-same-site",level:2},{value:"Same origin \u8207 same site",id:"same-origin-\u8207-same-site",level:2},{value:"\u795e\u5947\u7684 document.domain",id:"\u795e\u5947\u7684-documentdomain",level:2},{value:"\u6848\u4f8b\u4e00\uff1a\u55ae\u65b9\u9762\u6539\u8b8a",id:"\u6848\u4f8b\u4e00\u55ae\u65b9\u9762\u6539\u8b8a",level:3},{value:"\u6848\u4f8b\u4e8c\uff1a\u6d88\u5931\u7684 port",id:"\u6848\u4f8b\u4e8c\u6d88\u5931\u7684-port",level:3},{value:"\u6848\u4f8b\u4e09\uff1a\u6211\u4e0d\u662f\u539f\u4f86\u7684\u6211",id:"\u6848\u4f8b\u4e09\u6211\u4e0d\u662f\u539f\u4f86\u7684\u6211",level:3},{value:"document.domain \u7684\u6de1\u51fa\u53ca\u9000\u5834",id:"documentdomain-\u7684\u6de1\u51fa\u53ca\u9000\u5834",level:2},{value:"\u5c0f\u7d50",id:"\u5c0f\u7d50",level:2}],s={toc:m},u="wrapper";function h(e){let{components:t,...l}=e;return(0,a.kt)(u,(0,n.Z)({},s,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u91cd\u4e2d\u4e4b\u91cdsame-origin-policy-\u8207-site"},"\u91cd\u4e2d\u4e4b\u91cd\uff1aSame-origin policy \u8207 site"),(0,a.kt)("p",null,"\u5728\u524d\u9762\u7684\u6587\u7ae0\u88e1\u6709\u63d0\u904e\u4e0d\u5c11\u6b21\u300csame-origin\u300d\u6216\u662f\u300c\u540c\u6e90\u300d\uff0c\u7121\u8ad6\u5728\u524d\u7aef\u6216\u662f\u8cc7\u5b89\u7684\u4e16\u754c\u88e1\u90fd\u662f\u500b\u975e\u5e38\u91cd\u8981\u7684\u540d\u8a5e\uff0c\u56e0\u70ba\u700f\u89bd\u5668\u7684\u540c\u6e90\u653f\u7b56\uff08Same-origin policy\uff09\u5728\u958b\u767c\u4e0a\u6703\u78b0\u5230\uff0c\u5728\u653b\u64ca\u7684\u6642\u5019\u4e5f\u6703\u78b0\u5230\uff0c\u81f3\u95dc\u91cd\u8981\u3002"),(0,a.kt)("p",null,"\u53e6\u5916\uff0c\u9084\u6709\u5e7e\u500b\u5e38\u88ab\u6df7\u7528\u7684\u540d\u8a5e\uff0c\u4f8b\u5982\u8aaa host \u6216\u662f site\uff0c\u50cf\u662f XSS \u7684 XS \u5c31\u662f cross-site\uff0cCSRF \u7684 CS \u4e5f\u662f cross-site \u7684\u610f\u601d\uff0c\u90a3 origin \u8ddf site \u53c8\u6709\u4ec0\u9ebc\u4e0d\u540c\uff1f\u8ddf host \u53c8\u6709\u4ec0\u9ebc\u4e0d\u540c\uff1f"),(0,a.kt)("p",null,"\u9019\u7bc7\u5c31\u5e36\u4f60\u5b8c\u5168\u641e\u61c2\u9019\u4e9b\u89c0\u5ff5\uff0c\u4ee5\u5f8c\u518d\u4e5f\u4e0d\u641e\u6df7\u3002"),(0,a.kt)("h2",{id:"origin-\u8ddf-site-\u5230\u5e95\u662f\u4ec0\u9ebc\u8a72\u600e\u9ebc\u5340\u5206"},"Origin \u8ddf site \u5230\u5e95\u662f\u4ec0\u9ebc\uff1f\u8a72\u600e\u9ebc\u5340\u5206\uff1f"),(0,a.kt)("p",null,"\u5148\u63d0\u4f9b\u4e00\u4e0b\u7c21\u55ae\u597d\u61c2\u4f46\u6709\u4e9b\u8a31\u932f\u8aa4\u7684\u89e3\u91cb\uff0c\u5f85\u6703\u6211\u5011\u518d\u4f86\u4e00\u500b\u500b\u4fee\u6b63\u3002"),(0,a.kt)("p",null,"Origin \u7684\u8a71\u5c31\u662f\uff1ascheme + port + host\uff0c\u4e09\u8005\u52a0\u8d77\u4f86\u5c31\u662f origin\u3002"),(0,a.kt)("p",null,"\u5047\u8a2d\u6709\u500b URL \u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw/abc"),"\uff0c\u5404\u500b\u7d44\u6210\u5206\u5225\u662f\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"scheme\uff1ahttps"),(0,a.kt)("li",{parentName:"ul"},"port\uff1a443\uff08https \u7684\u9810\u8a2d port\uff09"),(0,a.kt)("li",{parentName:"ul"},"host\uff1ahuli.tw")),(0,a.kt)("p",null,"\u56e0\u6b64\u5b83\u7684 origin \u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw"),"\uff0c\u53ef\u4ee5\u770b\u5230 path \u7684\u90e8\u5206 ",(0,a.kt)("inlineCode",{parentName:"p"},"/abc")," \u4e26\u4e0d\u5f71\u97ff origin\uff0c\u800c port \u7684\u90e8\u4efd https \u5df2\u7d93\u860a\u542b\u9810\u8a2d\u5c31\u662f 443 port \u4e86\u3002"),(0,a.kt)("p",null,"\u800c same origin \u5c31\u662f\u5169\u500b URL \u7684 origin \u8981\u662f\u4e00\u6a23\u7684\uff0c\u8209\u4f8b\u4f86\u8aaa\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"https://huli.tw/abc")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"li"},"https://huli.tw/hello/yo")," \u662f same origin\uff0c\u56e0\u70ba scheme\u3001port \u8ddf host \u90fd\u4e00\u6a23\uff0cpath \u4e0d\u5f71\u97ff\u7d50\u679c"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"https://huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"li"},"http://huli.tw")," \u4e0d\u662f same origin\uff0c\u56e0\u70ba scheme \u4e0d\u4e00\u6a23"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"http://huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"li"},"http://huli.tw:8080")," \u4e0d\u662f same origin\uff0c\u56e0\u70ba port \u4e0d\u4e00\u6a23"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"https://huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"li"},"https://blog.huli.tw")," \u4e0d\u662f same origin\uff0c\u56e0\u70ba host \u4e0d\u4e00\u6a23")),(0,a.kt)("p",null,"\u5f9e\u4e0a\u9762\u5e7e\u500b\u7bc4\u4f8b\u53ef\u4ee5\u770b\u51fa same origin \u7684\u689d\u4ef6\u76f8\u7576\u56b4\u82db\uff0c\u57fa\u672c\u4e0a\u9664\u4e86 path \u4ee5\u5916\u7684\u90e8\u5206\u90fd\u8981\u4e00\u6a23\uff0c\u624d\u80fd\u53eb\u505a same origin\u3002"),(0,a.kt)("p",null,"\u63a5\u8457\u6211\u5011\u770b\u4e00\u4e0b site\uff0csite \u7684\u8a71\u770b\u7684\u6771\u897f\u6bd4 origin \u5c11\uff0c\u53ea\u770b scheme \u8ddf host\uff0c\u6240\u4ee5\u4e0d\u770b port\u3002\u800c\u5169\u500b URL \u662f same site \u7684\u5b9a\u7fa9\u4e5f\u66f4\u5bec\u9b06\u4e86\uff0chost \u7684\u90e8\u5206\u4e0d\u7528\u5b8c\u5168\u76f8\u540c\uff0c\u53ea\u8981\u662f subdomain \u4e5f\u7b97\u662f same site\u3002"),(0,a.kt)("p",null,"\u8209\u4f8b\u4f86\u8aaa\uff0c"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"https://huli.tw/abc")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"li"},"https://huli.tw/hello/yo")," \u662f same site\uff0c\u56e0\u70ba scheme \u8ddf host \u90fd\u4e00\u6a23"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"https://huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"li"},"http://huli.tw")," \u4e0d\u662f same site\uff0c\u56e0\u70ba scheme \u4e0d\u4e00\u6a23"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"http://huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"li"},"http://huli.tw:8080")," \u662f same site\uff0c\u56e0\u70ba port \u4e0d\u5f71\u97ff\u7d50\u679c"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"https://huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"li"},"https://blog.huli.tw")," \u662f same site\uff0c\u56e0\u70ba huli.tw \u8ddf blog.huli.tw \u90fd\u5728\u540c\u4e00\u500b domain huli.tw \u5e95\u4e0b"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"https://abc.huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"li"},"https://blog.huli.tw")," \u4e5f\u662f same site\uff0c\u56e0\u70ba abc.huli.tw \u8ddf blog.huli.tw \u90fd\u5728\u540c\u4e00\u500b domain huli.tw \u5e95\u4e0b")),(0,a.kt)("p",null,"\u8ddf same origin \u6bd4\u8d77\u4f86\uff0csame site \u986f\u7136\u66f4\u70ba\u5bec\u9b06\uff0cport \u4e0d\u540c\u4e5f\u662f same site\uff0chost \u7684\u90e8\u5206\u53ea\u8981\u96b8\u5c6c\u65bc\u540c\u500b parent domain \u57fa\u672c\u4e0a\u4e5f\u662f same site\u3002"),(0,a.kt)("p",null,"\u4f46\u5c31\u5982\u540c\u6211\u958b\u982d\u8aaa\u7684\uff0c\u4e0a\u9762\u7684\u5b9a\u7fa9\u96d6\u7136\u5728\u5927\u591a\u6578\u60c5\u6cc1\u4e0b\u90fd\u6b63\u78ba\uff0c\u4f46\u5176\u5be6\u4e26\u4e0d\u7cbe\u78ba\uff0c\u5e95\u4e0b\u6211\u5011\u76f4\u63a5\u4f86\u770b spec\uff0c\u770b\u770b\u6709\u54ea\u4e9b\u72c0\u6cc1\u4f8b\u5916\u3002"),(0,a.kt)("h2",{id:"\u7d30\u7a76-same-origin"},"\u7d30\u7a76 same origin"),(0,a.kt)("p",null,"\u5728 HTML \u898f\u7bc4\u4e2d\u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://html.spec.whatwg.org/multipage/origin.html#origin"},"7.5 Origin")," \u7ae0\u7bc0\u88e1\u9762\u53ef\u4ee5\u770b\u5230\u5b8c\u6574\u7684\u5b9a\u7fa9\uff0c\u5148\u4f86\u770b\u4e00\u4e0b\u898f\u7bc4\u88e1\u9762\u5c0d origin \u7684\u8aaa\u660e\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Origins are the fundamental currency of the web's security model. Two actors in the web platform that share an origin are assumed to trust each other and to have the same authority. Actors with differing origins are considered potentially hostile versus each other, and are isolated from each other to varying degrees.")),(0,a.kt)("p",null,"\u9019\u908a\u5beb\u5f97\u5f88\u6e05\u695a\uff0c\u958b\u5b97\u660e\u7fa9\u5c31\u8b1b\u4e86\u5982\u679c\u5169\u500b\u7db2\u7ad9\u6709\u8457\u76f8\u540c\u7684 origin\uff0c\u5c31\u610f\u5473\u8457\u9019\u5169\u500b\u7db2\u7ad9\u4fe1\u4efb\u5f7c\u6b64\uff0c\u4f46\u5982\u679c\u662f\u4e0d\u540c\u7684 origin\uff0c\u5c31\u6703\u88ab\u9694\u96e2\u958b\u4f86\u800c\u4e14\u53d7\u5230\u9650\u5236\u3002"),(0,a.kt)("p",null,"\u63a5\u8457\u898f\u7bc4\u88e1\u628a origin \u5206\u6210\u5169\u7a2e\uff0c\u4e00\u7a2e\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"An opaque origin"),"\uff0c\u53e6\u4e00\u7a2e\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"A tuple origin"),"\u3002"),(0,a.kt)("p",null,"Opaque origin \u53ef\u4ee5\u60f3\u6210\u662f\u5728\u7279\u6b8a\u72c0\u6cc1\u4e0b\u624d\u6703\u51fa\u73fe\u7684 origin\uff0c\u4f8b\u5982\u8aaa\u6211\u5728\u672c\u6a5f\u958b\u555f\u4e00\u500b\u7db2\u9801\uff0c\u7db2\u5740\u6703\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"file:///..."),"\uff0c\u9019\u6642\u5019\u5728\u7db2\u9801\u5167\u767c\u9001 request\uff0corigin \u5c31\u6703\u662f opaque origin\uff0c\u4e5f\u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"null"),"\u3002"),(0,a.kt)("p",null,"Tuple origin \u5247\u662f\u6bd4\u8f03\u5e38\u898b\u800c\u4e14\u6211\u5011\u4e5f\u6bd4\u8f03\u95dc\u5fc3\u7684 origin\uff0c\u6587\u4ef6\u5beb\u8aaa tuple \u5167\u5305\u542b\u4e86\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"scheme (an ASCII string)."),(0,a.kt)("li",{parentName:"ol"},"host (a host)."),(0,a.kt)("li",{parentName:"ol"},"port (null or a 16-bit unsigned integer)."),(0,a.kt)("li",{parentName:"ol"},"domain (null or a domain). Null unless stated otherwise.")),(0,a.kt)("p",null,"\u4f60\u53ef\u80fd\u6703\u597d\u5947\u70ba\u4ec0\u9ebc\u53c8\u6709 host \u53c8\u6709 domain\uff0c\u9019\u500b\u6211\u5011\u665a\u9ede\u6703\u63d0\u5230\u3002"),(0,a.kt)("p",null,"\u63a5\u8457\uff0c\u5728\u898f\u7bc4\u88e1\u9762\u4e5f\u6709\u8b1b\u5230\u5224\u65b7 A \u8ddf B \u5169\u500b origin \u662f\u5426\u662f same origin \u7684\u6f14\u7b97\u6cd5\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"If A and B are the same opaque origin, then return true."),(0,a.kt)("li",{parentName:"ol"},"If A and B are both tuple origins and their schemes, hosts, and port are identical, then return true."),(0,a.kt)("li",{parentName:"ol"},"Return false.")),(0,a.kt)("p",null,"\u8981\u561b\u5169\u500b\u662f\u4e00\u6a23\u7684 opaque origin\uff0c\u5426\u5247\u7684\u8a71\u8981 scheme\u3001host \u8ddf port \u4e09\u8005\u90fd\u76f8\u7b49\uff0c\u624d\u662f same origin\u3002\u9664\u4e86 same origin \u4ee5\u5916\uff0c\u4f60\u9084\u6703\u5728 spec \u88e1\u9762\u770b\u5230\u53e6\u5916\u4e00\u500b\u8a5e\u53eb\u505a\u300csame origin-domain\u300d\uff0c\u9019\u500b\u7b49\u7b49\u4e5f\u6703\u63d0\u5230\u3002"),(0,a.kt)("p",null,"\u5982\u540c\u6211\u524d\u9762\u8aaa\u7684\uff0csame origin \u662f\u5f88\u56b4\u683c\u7684\u9650\u5236\uff0c\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw/api")," \u9019\u500b\u7db2\u5740\u4f86\u8aaa\uff0c\u56e0\u70ba origin \u4e0d\u770b path\uff0c\u6240\u4ee5\u5b83\u7684 origin \u6703\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw"),"\uff0c\u4e5f\u5c31\u662f\u8aaa\uff0c\u8ddf\u5b83\u540c\u6e90\u7684\u7db2\u7ad9\u7684\u7db2\u5740\u4e00\u5b9a\u90fd\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw/*"),"\uff0c\u624d\u6703\u662f\u540c\u6e90\u7684\u3002"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"https://blog.huli.tw")," \u96d6\u7136\u53ea\u662f\u7db2\u57df\u8ddf\u5b50\u7db2\u57df\u7684\u95dc\u4fc2\uff0c\u4f46\u4e5f\u4e0d\u662f\u540c\u6e90\u7684\uff0c\u56e0\u70ba host \u4e0d\u4e00\u6a23\u3002"),(0,a.kt)("p",null,"\u8a18\u4f4f\u9019\u9ede\uff0c\u9019\u5f88\u91cd\u8981\u3002"),(0,a.kt)("p",null,"\u9019\u908a\u4ed4\u7d30\u63a2\u7a76\u7684 origin \u8ddf same origin \u7684\u5b9a\u7fa9\u8ddf\u958b\u982d\u6240\u8aaa\u7684\u300c\u4e0d\u7cbe\u78ba\u7684\u8aaa\u6cd5\u300d\u6bd4\u8d77\u4f86\uff0c\u5dee\u5225\u5728\u65bc\u591a\u4e86\u4e00\u500b opaque origin \u4ee5\u53ca same origin-domain\uff0c\u9084\u6709 origin tuple \u4e2d\u591a\u4e86\u4e00\u500b\u6211\u5011\u525b\u525b\u90fd\u6c92\u7528\u5230\u7684\u300cdomain\u300d\u3002"),(0,a.kt)("p",null,"\u6700\u5f8c\u518d\u63d0\u4e00\u500b\u6771\u897f\uff0c\u7576\u6211\u8aaa\u300c",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw/api")," \u7684 origin \u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw"),"\u300d\u7684\u6642\u5019\uff0c\u66f4\u7cbe\u78ba\u7684\u8aaa\u6cd5\u662f\uff1a\u300c",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw/api")," \u7684 origin \u5e8f\u5217\u5316\uff08serialization\uff09\u904e\u7684\u7d50\u679c\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw"),"\u300d"),(0,a.kt)("p",null,"\u9019\u662f\u56e0\u70ba\u524d\u9762\u6709\u63d0\u5230 origin \u5176\u5be6\u662f\u500b tuple\uff0c\u8868\u793a\u8d77\u4f86\u6703\u50cf\u9019\u6a23\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"(https, huli.tw, null, null)"),"\uff0c\u800c tuple \u8b8a\u6210\u5b57\u4e32\u5f8c\u624d\u6703\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw"),"\u3002tuple \u7684\u8868\u793a\u6cd5\u8ddf\u5e8f\u5217\u5316\u904e\u5f8c\u7684\u5b57\u4e32\u6bd4\u8d77\u4f86\uff0c\u6211\u8a8d\u70ba\u5f8c\u8005\u6bd4\u8f03\u597d\u8b80\uff0c\u56e0\u6b64\u7576\u5169\u8005\u80fd\u8868\u73fe\u51fa\u7684\u8cc7\u8a0a\u985e\u4f3c\u6642\uff0c\u6211\u6703\u63a1\u7528\u5f8c\u8005\u90a3\u7a2e\u505a\u6cd5"),(0,a.kt)("h2",{id:"\u7d30\u7a76-same-site"},"\u7d30\u7a76 same site"),(0,a.kt)("p",null,"site \u7684\u5b9a\u7fa9\u4e5f\u5728\u540c\u4e00\u4efd spec \u88e1\u9762\uff0c\u5beb\u8aaa\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"A site is an opaque origin or a scheme-and-host.")),(0,a.kt)("p",null,"\u6240\u4ee5 site \u53ef\u4ee5\u662f opaque origin\uff0c\u6216\u8005\u662f scheme-and-host\u3002"),(0,a.kt)("p",null,"\u5728 spec \u4e2d\u53ef\u4ee5\u767c\u73fe\u9664\u4e86 same site \u4ee5\u5916\uff0c\u9084\u6709\u53e6\u5916\u4e00\u500b\u540d\u8a5e\u53eb\u505a\u300cschemelessly same site\u300d\uff0c\u9019\u5169\u500b\u7684\u5dee\u5225\u4e5f\u5f88\u660e\u986f\uff0csame site \u6703\u770b scheme\uff0c\u800c schemelessly same site \u5247\u4e0d\u770b scheme\u3002"),(0,a.kt)("p",null,"\u56e0\u6b64\uff0c\u5728\u5224\u65b7\u5169\u500b origin A \u8ddf B \u662f\u5426\u662f same site \u6642\uff0c\u6f14\u7b97\u6cd5\u662f\u9019\u6a23\u7684\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Two origins, A and B, are said to be same site if both of the following statements are true:"),(0,a.kt)("ul",{parentName:"blockquote"},(0,a.kt)("li",{parentName:"ul"},"A and B are schemelessly same site  "),(0,a.kt)("li",{parentName:"ul"},"A and B are either both opaque origins, or both tuple origins with the same scheme"))),(0,a.kt)("p",null,"\u5982\u679c A \u8ddf B \u662f same site\uff0c\u8981\u561b\u4ed6\u5011\u90fd\u662f opaque origin\uff0c\u8981\u561b\u5169\u500b\u6709\u8457\u540c\u6a23\u7684 scheme \u800c\u4e14\u5169\u500b\u662f schemelessly same site\u3002"),(0,a.kt)("p",null,"\u6240\u4ee5 same site \u662f\u6703\u770b scheme \u7684\uff0chttp \u8ddf https \u7684\u5169\u500b\u7db2\u5740\u7d55\u5c0d\u4e0d\u6703\u662f same site\uff0c\u4f46\u6709\u53ef\u80fd\u662f schemelessly same site\u3002"),(0,a.kt)("p",null,"\u9019\u908a\u5176\u5be6\u6709\u4e00\u5c0f\u6bb5\u6b77\u53f2\uff0c\u90a3\u5c31\u662f same site \u525b\u51fa\u4f86\u7684\u6642\u5019\uff0c\u5176\u5be6\u662f\u4e0d\u770b scheme \u7684\uff0c\u662f\u5230\u5f8c\u4f86\u624d\u628a scheme \u7d0d\u5165\u8003\u91cf\u3002"),(0,a.kt)("p",null,"\u5728\u9019\u4efd 2016 \u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/draft-west-first-party-cookies-07#section-2.1"},"RFC: Same-site Cookies")," \u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u5c0d\u65bc same site \u7684\u5224\u65b7\u4e26\u6c92\u6709 scheme\uff0c\u6240\u4ee5\u90a3\u6642\u5019 ",(0,a.kt)("inlineCode",{parentName:"p"},"https://huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"http://huli.tw")," \u662f same site\u3002"),(0,a.kt)("p",null,"\u4e00\u76f4\u5230 2019 \u5e74 6 \u6708\u7684\u6642\u5019\uff0c\u624d\u958b\u59cb\u5728\u8a0e\u8ad6\u662f\u5426\u8981\u628a scheme \u5217\u5165\u8003\u91cf\uff0c\u8a73\u60c5\u53ef\u53c3\u8003\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/w3c/webappsec-fetch-metadata/issues/34"},"Treat http://foo.com -> https://foo.com requests as Sec-Fetch-Site: cross-site. #34"),"\u3002"),(0,a.kt)("p",null,"\u90a3\u6642 same site \u7684 spec \u4e26\u4e0d\u662f\u5b9a\u7fa9\u5728\u6211\u5011\u4eca\u5929\u770b\u7684 HTML spec \u88e1\u9762\uff0c\u800c\u662f\u53e6\u5916\u4e00\u4efd URL spec\uff0c\u6240\u4ee5\u5f8c\u4f86\u8a0e\u8ad6\u88ab\u79fb\u5230\u90a3\u908a\u53bb\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/whatwg/url/issues/448"},'Consider introducing a "same-site" concept that includes scheme. #448'),"\uff0c\u63a5\u8457\u5728 2019 \u5e74 9 \u6708\uff0c\u5c31\u6709\u4e86\u9019\u500b PR\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/whatwg/url/pull/449"},"Tighten 'same site' checks to include 'scheme'. #449"),"\uff0c\u624d\u6b63\u5f0f\u5728\u898f\u683c\u4e2d\u628a scheme \u5217\u5165\u8003\u91cf\uff0c\u5c07 same site \u5b9a\u7fa9\u6210\u300c\u6703\u770b scheme\u300d\uff0c\u800c\u4e0d\u770b scheme \u7684\u5247\u5f15\u5165\u4e86\u4e00\u500b\u65b0\u7684\u540d\u8a5e\uff1aschemelessly same site\u3002"),(0,a.kt)("p",null,"\u63a5\u8457\u904e\u4e86\u5169\u500b\u6708\uff0c\u76f8\u95dc\u7684 spec \u5f9e URL \u79fb\u5230 HTML\uff0c\u53ef\u53c3\u8003\u9019\u5169\u500b PR\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/whatwg/url/pull/457"},'Let HTML handle the "same site" definition #457'),"\u3001",(0,a.kt)("a",{parentName:"p",href:"https://github.com/whatwg/html/pull/5076"},"Define (schemelessly) same site for origins #5076")),(0,a.kt)("p",null,"Spec \u6b78 spec\uff0c\u6709\u6642\u5019\u898f\u683c\u4fee\u6b63\u4e0d\u4ee3\u8868\u700f\u89bd\u5668\u5c31\u6703\u99ac\u4e0a\u8ddf\u4e0a\uff0c\u90a3\u700f\u89bd\u5668\u76ee\u524d\u7684\u5be6\u4f5c\u70ba\u4f55\u5462\uff1f"),(0,a.kt)("p",null,"Chrome \u5728 2020 \u5e74 11 \u6708\u6642\u6709\u5beb\u4e86\u4e00\u7bc7\u6587\u7ae0\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://web.dev/schemeful-samesite/"},"Schemeful Same-Site"),"\uff0c\u770b\u4f86\u5728\u90a3\u6642\u700f\u89bd\u5668\u9084\u662f\u628a\u4e0d\u540c scheme \u4e5f\u7576\u4f5c\u662f same site\uff0c\u4f46\u5f9e ",(0,a.kt)("a",{parentName:"p",href:"https://chromestatus.com/feature/5096179480133632"},"Chrome platform status:  Feature: Schemeful same-site")," \u4e2d\u6211\u5011\u53ef\u4ee5\u5f97\u77e5\uff0cChrome \u5f9e 89 \u4ee5\u5f8c\u5c31\u628a scheme \u4e5f\u5217\u5165\u8003\u616e\u4e86\u3002"),(0,a.kt)("p",null,"\u81f3\u65bc Firefox \u7684\u8a71\uff0c\u5f9e\u9019\u500b issue\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://bugzilla.mozilla.org/show_bug.cgi?id=1651119"},"[meta] Enable cookie sameSite schemeful")," \u7684\u72c0\u614b\u770b\u4f86\uff0c\u4f3c\u4e4e\u9084\u6c92\u6709\u628a\u9019\u500b\u884c\u70ba\u7576\u4f5c\u662f\u9810\u8a2d\u503c\uff0c\u5982\u679c\u6c92\u6709\u7279\u5225\u8abf\u6574\u8a2d\u5b9a\uff0cscheme \u4e0d\u540c\u4e5f\u6703\u88ab\u770b\u4f5c\u662f same site\u3002"),(0,a.kt)("p",null,"\u770b\u5b8c\u4e86\u6b77\u53f2\uff0c\u63a5\u8457\u5c31\u4f86\u770b\u4e00\u4e0b\u6700\u91cd\u8981\u7684 schemelessly same site \u662f\u5982\u4f55\u5224\u65b7\u7684\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"schemelessly same site",src:i(4613).Z,width:"980",height:"349"})),(0,a.kt)("p",null,"Opaque \u7684\u90e8\u4efd\u6211\u5011\u5c31\u5148\u4e0d\u8aaa\u4e86\uff0c\u4e0a\u9762\u7684\u91cd\u9ede\u5f88\u986f\u7136\u662f\u4e00\u500b\u65b0\u7684\u540d\u8a5e\uff1a\u300cregistrable domain\u300d\uff0c\u5728\u5224\u65b7\u5169\u500b host \u662f\u5426\u662f same site \u6642\uff0c\u6703\u7528\u9019\u500b\u4f86\u505a\u6bd4\u8f03\u3002"),(0,a.kt)("p",null,"\u9019\u500b registrable domain \u7684\u5b9a\u7fa9\u5728\u53e6\u5916\u4e00\u4efd ",(0,a.kt)("a",{parentName:"p",href:"https://url.spec.whatwg.org/#host-registrable-domain"},"URL \u7684 spec")," \u4e2d\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"A host\u2019s registrable domain is a domain formed by the most specific public suffix, along with the domain label immediately preceding it, if any")),(0,a.kt)("p",null,"\u9019\u908a\u53c8\u63d0\u5230\u4e00\u500b\u65b0\u7684\u8a5e\uff1a\u300cpublic suffix\u300d\u3002"),(0,a.kt)("p",null,"\u5148\u8209\u500b\u4f8b\u5b50\u6703\u6bd4\u8f03\u597d\u61c2\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"blog.huli.tw")," \u7684 registrable domain \u6703\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"huli.tw"),"\uff0c\u800c ",(0,a.kt)("inlineCode",{parentName:"p"},"huli.tw")," \u7684 registrable domain \u4e5f\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"huli.tw"),"\u3002"),(0,a.kt)("p",null,"\u4f46\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"bob.github.io")," \u7684 registrable domain \u4e0d\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"github.io"),"\uff0c\u800c\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"bob.github.io"),"\u3002"),(0,a.kt)("p",null,"\u9019\u662f\u70ba\u4ec0\u9ebc\u5462\uff1f\u5e95\u4e0b\u6211\u7c21\u55ae\u89e3\u91cb\u4e00\u4e0b\u3002"),(0,a.kt)("p",null,"\u5982\u679c\u6c92\u6709\u300cregistrable domain\u300d\u4ee5\u53ca\u300cpublic suffix\u300d\u9019\u5169\u500b\u6982\u5ff5\u7684\u8a71\uff0c\u90a3 same site \u7684\u5b9a\u7fa9\u5c31\u662f\u958b\u982d\u6240\u8b1b\u7684\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"blog.huli.tw")," \u662f same site\uff0c\u9019\u6c92\u4ec0\u9ebc\u554f\u984c\u3002"),(0,a.kt)("p",null,"\u4f46\u5982\u679c\u662f\u9019\u6a23\u7684\u8a71\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"bob.github.io")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"alice.github.io")," \u4e5f\u662f same site \u4e86\u3002"),(0,a.kt)("p",null,"\u54a6\uff0c\u9019\u6a23\u4e0d\u597d\u55ce\uff1f"),(0,a.kt)("p",null,"\u4e0d\u597d\uff0c\u56e0\u70ba ",(0,a.kt)("inlineCode",{parentName:"p"},"github.io")," \u662f GitHub pages \u7684\u670d\u52d9\uff0c\u6bcf\u4e00\u500b GitHub \u7684\u4f7f\u7528\u8005\u90fd\u6703\u6709\u81ea\u5df1\u5c08\u5c6c\u7684 subdomain \u53ef\u4ee5\u7528\uff0c\u4f46 GitHub \u4e0d\u5e0c\u671b ",(0,a.kt)("inlineCode",{parentName:"p"},"bob.github.io")," \u80fd\u5e72\u64fe\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"alice.github.io"),"\uff0c\u56e0\u70ba\u5b83\u5011\u5176\u5be6\u5c31\u662f\u5b8c\u5168\u7368\u7acb\u7684\u5169\u500b\u7db2\u7ad9\uff0c\u4e26\u4e0d\u50cf ",(0,a.kt)("inlineCode",{parentName:"p"},"huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"blog.huli.tw")," \u4e00\u6a23\uff0c\u64c1\u6709\u8005\u90fd\u662f\u6211\u3002"),(0,a.kt)("p",null,"\u56e0\u6b64\uff0cpublic suffix \u7684\u6982\u5ff5\u5c31\u51fa\u73fe\u4e86\uff0c\u9019\u662f\u4e00\u500b\u4eba\u5de5\u7dad\u8b77\u7684\u6e05\u55ae\uff0c\u88e1\u9762\u6709\u8457\u9019\u4e9b\u300c\u4e0d\u60f3\u88ab\u7576\u4f5c\u662f\u540c\u500b\u7db2\u7ad9\u7684\u5217\u8868\u300d\uff0c\u6211\u8209\u5e7e\u500b\u4f8b\u5b50\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"github.io"),(0,a.kt)("li",{parentName:"ol"},"com.tw"),(0,a.kt)("li",{parentName:"ol"},"s3.amazonaws.com"),(0,a.kt)("li",{parentName:"ol"},"azurestaticapps.net"),(0,a.kt)("li",{parentName:"ol"},"herokuapp.com")),(0,a.kt)("p",null,"\u6240\u4ee5\u700f\u89bd\u5668\u53c3\u7167\u9019\u5f35\u8868\u4e4b\u5f8c\uff0c\u5c31\u6703\u8a8d\u5b9a ",(0,a.kt)("inlineCode",{parentName:"p"},"bob.github.io")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"alice.github.io")," \u5176\u5be6\u4e26\u6c92\u6709\u95dc\u4fc2\uff0c\u4e0d\u662f same site\u3002\u9019\u4e5f\u6709\u500b\u5c08\u6709\u540d\u8a5e\u53eb\u505a eTLD\uff08effective Top-Level-Domain\uff09\uff0c\u7d30\u7bc0\u53ef\u53c3\u8003\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://blog.kalan.dev/2021-11-09-url-and-samesite/"},"\u5982\u4f55\u5224\u65b7\u5169\u500b\u7db2\u57df\u7684\u64c1\u6709\u8005\u662f\u5426\u76f8\u540c\uff1f")),(0,a.kt)("p",null,"\u5982\u4e0a\u6240\u8ff0\uff0c\u56e0\u70ba ",(0,a.kt)("inlineCode",{parentName:"p"},"github.io")," \u5b58\u5728\u65bc public suffix list \u88e1\u9762\uff0c\u6240\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"bob.github.io")," \u7684 registrable domain \u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"bob.github.io"),"\uff0c\u800c ",(0,a.kt)("inlineCode",{parentName:"p"},"alice.github.io")," \u7684 registrable domain \u5247\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"alice.github.io"),"\u3002"),(0,a.kt)("p",null,"\u6240\u4ee5\u5462\uff0c\u6211\u5011\u4e00\u958b\u59cb\u8b1b\u7684 same site \u7684\u5b9a\u7fa9\u4e26\u4e0d\u6b63\u78ba\uff0c\u5169\u500b host \u770b\u8d77\u4f86\u5f88\u50cf\u662f\u96b8\u5c6c\u65bc\u540c\u4e00\u500b parent domain\uff0c\u4e26\u4e0d\u4ee3\u8868\u5c31\u4e00\u5b9a\u662f same site\uff0c\u9084\u8981\u770b\u6709\u6c92\u6709\u5728 public suffix list \u88e1\u9762\u3002"),(0,a.kt)("p",null,"\u800c ",(0,a.kt)("inlineCode",{parentName:"p"},"bob.github.io")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"alice.github.io")," \u4e0d\u662f same site\uff0c\u56e0\u70ba\u4ed6\u5011\u7684 registrable domain \u4e0d\u4e00\u6a23\u3002"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"blog.huli.tw")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"huli.tw")," \u9084\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"test.huli.tw")," \u9019\u4e09\u500b host \u90fd\u662f same site\uff0c\u56e0\u70ba registrable domain \u90fd\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"huli.tw"),"\u3002"),(0,a.kt)("p",null,"spec \u4e2d\u6709\u9644\u4e0a\u4e00\u5f35\u66f4\u6e05\u695a\u7684\u8868\u683c\uff0c\u5927\u5bb6\u53ef\u4ee5\u4ed4\u7d30\u770b\u4e00\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"registrable domain table",src:i(280).Z,width:"872",height:"485"})),(0,a.kt)("p",null,"\u6700\u5f8c\uff0c\u70ba same site \u505a\u500b\u7e3d\u7d50\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u6709 same site \u8ddf schemelessly same site\uff0c\u8f03\u5e38\u7528\u7684\u662f\u524d\u8005"),(0,a.kt)("li",{parentName:"ol"},"\u8981\u6bd4\u8f03\u5169\u500b host \u662f\u5426\u70ba same site \u6642\uff0c\u8981\u770b registrable domain"),(0,a.kt)("li",{parentName:"ol"},"\u8981\u6c7a\u5b9a registrable domain \u662f\u4ec0\u9ebc\uff0c\u8981\u770b public suffix list"),(0,a.kt)("li",{parentName:"ol"},"\u5169\u500b host \u50c5\u7ba1\u770b\u8d77\u4f86\u96b8\u5c6c\u65bc\u540c\u500b parent domain\uff0c\u4f46\u56e0\u70ba\u6709 public suffix \u7684\u5b58\u5728\uff0c\u4e0d\u4e00\u5b9a\u662f same site"),(0,a.kt)("li",{parentName:"ol"},"same site \u4e0d\u770b port\uff0c\u6240\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"li"},"http://blog.huli.tw:8888")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"li"},"http://huli.tw")," \u662f same site")),(0,a.kt)("h2",{id:"same-origin-\u8207-same-site"},"Same origin \u8207 same site"),(0,a.kt)("p",null,"Same origin \u770b\u7684\u662f\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"scheme"),(0,a.kt)("li",{parentName:"ol"},"port"),(0,a.kt)("li",{parentName:"ol"},"host")),(0,a.kt)("p",null,"\u800c same site \u770b\u7684\u662f\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"scheme"),(0,a.kt)("li",{parentName:"ol"},"host(registrable domain)")),(0,a.kt)("p",null,"\u5982\u679c\u5169\u500b\u7db2\u7ad9\u662f same origin\uff0c\u90a3\u5c31\u4e00\u5b9a\u662f same site\uff0c\u56e0\u70ba same origin \u7684\u5224\u65b7\u6a19\u6e96\u66f4\u70ba\u56b4\u82db\u3002"),(0,a.kt)("p",null,"\u5169\u8005\u6700\u5927\u7684\u5dee\u5225\u5c31\u5728\u65bc\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"same origin \u770b port\uff0csame site \u4e0d\u770b"),(0,a.kt)("li",{parentName:"ol"},"same origin \u770b host\uff0csame site \u770b registrable domain")),(0,a.kt)("p",null,"\u5e95\u4e0b\u8209\u5e7e\u500b\u4f8b\u5b50\uff1a"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"A"),(0,a.kt)("th",{parentName:"tr",align:null},"B"),(0,a.kt)("th",{parentName:"tr",align:null},"same origin"),(0,a.kt)("th",{parentName:"tr",align:null},"same site"),(0,a.kt)("th",{parentName:"tr",align:null},"\u8aaa\u660e"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"http://huli.tw:8080"},"http://huli.tw:8080")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"http://huli.tw"},"http://huli.tw")),(0,a.kt)("td",{parentName:"tr",align:null},"X"),(0,a.kt)("td",{parentName:"tr",align:null},"O"),(0,a.kt)("td",{parentName:"tr",align:null},"same site \u4e0d\u770b port")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://blog.huli.tw"},"https://blog.huli.tw")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://huli.tw"},"https://huli.tw")),(0,a.kt)("td",{parentName:"tr",align:null},"X"),(0,a.kt)("td",{parentName:"tr",align:null},"O"),(0,a.kt)("td",{parentName:"tr",align:null},"registrable domain \u76f8\u540c")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://alice.github.io"},"https://alice.github.io")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://github.io"},"https://github.io")),(0,a.kt)("td",{parentName:"tr",align:null},"X"),(0,a.kt)("td",{parentName:"tr",align:null},"X"),(0,a.kt)("td",{parentName:"tr",align:null},"github.io \u5728 public suffix \u88e1\u9762")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://a.alice.github.io"},"https://a.alice.github.io")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://b.alice.github.io"},"https://b.alice.github.io")),(0,a.kt)("td",{parentName:"tr",align:null},"X"),(0,a.kt)("td",{parentName:"tr",align:null},"O"),(0,a.kt)("td",{parentName:"tr",align:null},"registrable domain \u76f8\u540c")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://bob.github.io/page1"},"https://bob.github.io/page1")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("a",{parentName:"td",href:"https://bob.github.io/about"},"https://bob.github.io/about")),(0,a.kt)("td",{parentName:"tr",align:null},"O"),(0,a.kt)("td",{parentName:"tr",align:null},"O"),(0,a.kt)("td",{parentName:"tr",align:null},"\u4e0d\u7ba1 path")))),(0,a.kt)("h2",{id:"\u795e\u5947\u7684-documentdomain"},"\u795e\u5947\u7684 document.domain"),(0,a.kt)("p",null,"\u5728\u770b origin \u7684 spec \u6642\uff0c\u5c31\u6709\u63d0\u5230\u4e00\u500b\u795e\u5947\u7684\u300cdomain\u300d\u5c6c\u6027\uff0c\u4e0d\u77e5\u9053\u8981\u5e79\u561b\uff0c\u751a\u81f3\u9084\u6709\u300csame origin-domain\u300d\u9019\u500b\u6771\u897f\uff0c\u5728 origin \u7684 spec \u4e2d\u5176\u5be6\u6709\u4e00\u6bb5\u7da0\u5e95\u7684 note\uff0c\u76f4\u63a5\u7834\u984c\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"same origin note",src:i(9993).Z,width:"1387",height:"407"})),(0,a.kt)("p",null,"\u5beb\u8aaa origin \u9664\u4e86 domain \u9019\u500b\u5c6c\u6027\u4ee5\u5916\u90fd\u662f\u4e0d\u53ef\u8b8a\u7684\uff0c\u800c\u9019\u5c6c\u6027\u53ef\u4ee5\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"document.domain")," \u4f86\u6539\u8b8a\u3002\u5728 spec \u4e2d\u6709\u4e00\u500b\u7ae0\u7bc0 ",(0,a.kt)("a",{parentName:"p",href:"https://html.spec.whatwg.org/multipage/origin.html#relaxing-the-same-origin-restriction"},"7.5.2 Relaxing the same-origin restriction"),"\uff0c\u5c31\u662f\u5728\u8b1b\u9019\u4ef6\u4e8b\u60c5\uff0c\u6211\u7bc0\u9304\u4e00\u5c0f\u6bb5\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"(document.domain) can be set to a value that removes subdomains, to change the origin's domain to allow pages on other subdomains of the same domain (if they do the same thing) to access each other. This enables pages on different hosts of a domain to synchronously access each other's DOMs.")),(0,a.kt)("p",null,"\u70ba\u4e86\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\uff0c\u76f4\u63a5\u4f86\u500b demo\u3002"),(0,a.kt)("p",null,"\u6211\u6539\u4e86\u672c\u6a5f\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/hosts"),"\uff0c\u5167\u5bb9\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"127.0.0.1   alice.example.com\n127.0.0.1   bob.example.com\n")),(0,a.kt)("p",null,"\u5982\u6b64\u4e00\u4f86\uff0c\u9019\u5169\u500b\u7db2\u5740\u90fd\u6703\u9023\u5230 local\uff0c\u63a5\u8457\u6211\u958b\u4e86\u4e00\u500b\u7c21\u55ae\u7684 HTTP server\uff0c\u5beb\u4e86\u4e00\u500b\u7c21\u55ae\u7684 HTML\uff0c\u8b93\u5b83\u8dd1\u5728 localhost:5555"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"viewport\" content =\"width=device-width, initial-scale=1\" />\n  </head>\n  <body>\n    <h1></h1>\n    <h2></h2>\n    <button onclick=\"load('alice')\">load alice iframe</button>\n    <button onclick=\"load('bob')\">load bob iframe</button>\n    <button onclick=\"access()\">access iframe content</button>\n    <button onclick=\"update()\">update domain</button>\n    <br>\n    <br>\n  </body>\n  <script>\n    const name = document.domain.replace('.example.com', '')\n    document.querySelector('h1').innerText = name\n    document.querySelector('h2').innerText = Math.random()\n\n    function load(name) {\n      const iframe = document.createElement('iframe')\n      iframe.src = 'http://' + name + '.example.com:5555'\n      document.body.appendChild(iframe)\n    }\n\n    function access() {\n      const win = document.querySelector('iframe').contentWindow\n      alert('secret:' + win.document.querySelector('h2').innerText)    \n    }\n\n    function update() {\n      document.domain = 'example.com'\n    }\n  <\/script>\n</html>\n")),(0,a.kt)("p",null,"\u9801\u9762\u4e0a\u6709\u4e09\u500b\u529f\u80fd\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u8f09\u5165 iframe"),(0,a.kt)("li",{parentName:"ol"},"\u8b80\u53d6 iframe \u5167 DOM \u7684\u8cc7\u6599"),(0,a.kt)("li",{parentName:"ol"},"\u6539\u8b8a document.domain")),(0,a.kt)("p",null,"\u6211\u5011\u5148\u958b\u555f ",(0,a.kt)("inlineCode",{parentName:"p"},"http://alice.example.com:5555"),"\uff0c\u7136\u5f8c\u8f09\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"http://bob.example.com:5555")," \u7684 iframe\uff0c\u63a5\u8457\u6309\u4e0b alice \u9801\u9762\u4e2d\u7684\u300caccess iframe content\u300d\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"exception",src:i(1033).Z,width:"722",height:"461"})),(0,a.kt)("p",null,"\u4f60\u6703\u5728 console \u770b\u5230\u932f\u8aa4\u8a0a\u606f\uff0c\u5beb\u8aaa\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},'Uncaught DOMException: Blocked a frame with origin "',(0,a.kt)("a",{parentName:"p",href:"http://alice.example.com:5555%22"},'http://alice.example.com:5555"')," from accessing a cross-origin frame.")),(0,a.kt)("p",null,"\u56e0\u70ba alice \u8ddf bob \u96d6\u7136\u662f same site\uff0c\u4f46\u662f\u4e26\u4e0d\u662f same origin\uff0c\u800c iframe \u5982\u679c\u8981\u5b58\u53d6\u5230 DOM \u7684\u5167\u5bb9\uff0c\u5fc5\u9808\u662f same origin \u624d\u884c\u3002"),(0,a.kt)("p",null,"\u63a5\u8457\u6211\u5011\u96d9\u96d9\u6309\u4e0b alice \u8ddf bob \u9801\u9762\u4e2d\u7684\u300cupdate domain\u300d\uff0c\u6309\u5b8c\u4ee5\u5f8c\u518d\u6309\u4e00\u6b21\u300caccess iframe content\u300d\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"success",src:i(1696).Z,width:"721",height:"427"})),(0,a.kt)("p",null,"\u4f60\u6703\u770b\u5230\u9019\u4e00\u6b21\uff0c\u6211\u5011\u9806\u4fbf\u53d6\u5f97\u4e86 bob \u9801\u9762\u4e2d\u7684\u8cc7\u6599\uff0c\u6210\u529f\u628a  ",(0,a.kt)("inlineCode",{parentName:"p"},"http://alice.example.com:5555")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"http://bob.example.com:5555")," \u5f9e cross origin \u8b8a\u6210\u4e86 same origin\uff0c\u9019\u5c31\u662f\u5fcd\u8853\uff0csame site \u8b8a\u6210 same origin \u4e4b\u8853\uff01"),(0,a.kt)("p",null,"\u9019\u4e00\u62db\u4e26\u4e0d\u662f\u4efb\u610f\u5169\u500b\u7db2\u9801\u90fd\u53ef\u4ee5\u4f7f\u7528\u7684\uff0c\u57fa\u672c\u4e0a\u53ea\u6709 same site \u7684\u7db2\u7ad9\u53ef\u4ee5\uff0c\u800c\u4e14\u5728\u8a2d\u7f6e\u6642\u9084\u6703\u505a\u5f88\u591a\u6aa2\u67e5\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"check",src:i(455).Z,width:"1302",height:"604"})),(0,a.kt)("p",null,"\u4ee5 github.io \u70ba\u4f8b\uff0c\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"p"},"alice.github.io")," \u57f7\u884c\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"document.domain = 'github.io'"),"\uff0cconsole \u5c31\u6703\u8df3\u51fa\u932f\u8aa4\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Uncaught DOMException: Failed to set the 'domain' property on 'Document': 'github.io' is a top-level domain.")),(0,a.kt)("p",null,"\u70ba\u4ec0\u9ebc\u6539\u8b8a ",(0,a.kt)("inlineCode",{parentName:"p"},"document.domain")," \u5f8c\uff0c\u5169\u500b\u9801\u9762\u5c31\u6703\u8b8a\u6210\u662f same origin \u5462\uff1f\u5176\u5be6\u56b4\u683c\u4f86\u8aaa\u4e0d\u662f same origin\uff0c\u800c\u662f same origin-domain\uff0c\u5728 ",(0,a.kt)("a",{parentName:"p",href:"https://html.spec.whatwg.org/multipage/browsers.html#concept-bcc-content-document"},"docuemnt")," \u76f8\u95dc\u7684 spec \u4e2d\u6709\u5beb\u5230\uff0c\u6709\u4e9b\u6aa2\u67e5\u662f\u770b same origin-domain\uff0c\u800c\u4e0d\u662f same origin\u3002"),(0,a.kt)("p",null,"\u90a3\u600e\u9ebc\u770b\u5169\u500b origin \u662f\u4e0d\u662f same origin-domain \u5462\uff1f\u4e00\u8d77\u4f86\u770b\u770b spec \u600e\u9ebc\u8aaa\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("ol",{parentName:"blockquote"},(0,a.kt)("li",{parentName:"ol"},"If A and B are the same opaque origin, then return true.  "),(0,a.kt)("li",{parentName:"ol"},"If A and B are both tuple origins, run these substeps:")),(0,a.kt)("ul",{parentName:"blockquote"},(0,a.kt)("li",{parentName:"ul"},"If A and B's schemes are identical, and their domains are identical and non-null, then return true.  "),(0,a.kt)("li",{parentName:"ul"},"Otherwise, if A and B are same origin and their domains are identical and null, then return true.")),(0,a.kt)("ol",{parentName:"blockquote",start:3},(0,a.kt)("li",{parentName:"ol"},"Return false."))),(0,a.kt)("p",null,"\u5982\u679c A \u8ddf B \u7684 scheme \u4e00\u6a23\uff0c\u800c\u4e14 domain \u5c6c\u6027\u4e5f\u4e00\u6a23\u800c\u4e14\u4e0d\u662f null \u7684\u8a71\uff0c\u5c31\u56de\u50b3 true\uff0c\u5426\u5247\u7684\u8a71\u6aa2\u67e5 A \u8ddf B \u662f\u4e0d\u662f same origin \u800c\u4e14 domain \u90fd\u662f null\uff0c\u6210\u7acb\u624d\u56de\u50b3 true\u3002"),(0,a.kt)("p",null,"\u9019\u908a\u53ef\u4ee5\u770b\u5230\u5e7e\u500b\u6709\u8da3\u7684\u5730\u65b9\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u4e00\u5b9a\u8981\u5169\u500b\u7db2\u9801\u90fd\u6c92\u6709\u8a2d\u7f6e domain \u6216\u662f\u90fd\u6709\u8a2d\u7f6e\uff0c\u624d\u6709\u53ef\u80fd\u56de\u50b3 true\uff08\u9019\u5f88\u91cd\u8981\uff09"),(0,a.kt)("li",{parentName:"ol"},"\u5982\u679c\u6709\u8a2d\u7f6e domain \u7684\u8a71\uff0csame origin-domain \u5c31\u4e0d\u6aa2\u67e5 port \u4e86")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"document.domain")," \u5c31\u662f\u6539\u8b8a origin tuple \u4e2d domain \u9019\u500b\u5c6c\u6027\u7528\u7684\u3002"),(0,a.kt)("p",null,"\u5728\u4e0a\u9762\u7684\u7bc4\u4f8b\u4e2d\uff0c\u6211\u5011\u5169\u500b\u7db2\u9801 ",(0,a.kt)("inlineCode",{parentName:"p"},"http://alice.example.com:5555")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"http://bob.example.com:5555")," \u90fd\u5c07\u81ea\u5df1\u7684 domain \u6539\u6210 ",(0,a.kt)("inlineCode",{parentName:"p"},"example.com"),"\uff0c\u6240\u4ee5\u662f same origin-domain\u3002"),(0,a.kt)("p",null,"\u5e95\u4e0b\u6211\u5011\u4f86\u770b\u770b\u4e09\u500b\u6709\u8da3\u7684\u6848\u4f8b\u3002"),(0,a.kt)("h3",{id:"\u6848\u4f8b\u4e00\u55ae\u65b9\u9762\u6539\u8b8a"},"\u6848\u4f8b\u4e00\uff1a\u55ae\u65b9\u9762\u6539\u8b8a"),(0,a.kt)("p",null,"\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"p"},"https://alice.example.com")," \u57f7\u884c\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"document.domain = 'example.com'"),"\uff0c\u63a5\u8457\u628a ",(0,a.kt)("inlineCode",{parentName:"p"},"https://example.com")," \u5d4c\u5165\u5728 iframe \u88e1\u9762\uff0c\u5b83\u5011\u5169\u500b\u300c\u4f9d\u820a\u4e0d\u662f same origin-domain\u300d\uff0c\u56e0\u70ba alice \u9801\u9762\u6709 domain \u5c6c\u6027\uff0c\u4f46\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"example.com")," \u9801\u9762\u6c92\u6709 domain \u5c6c\u6027\u3002"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"example.com")," \u4e5f\u8981\u57f7\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"document.domain = 'example.com'"),"\uff0c\u5169\u8005\u624d\u6703\u662f same origin-domain\u3002"),(0,a.kt)("h3",{id:"\u6848\u4f8b\u4e8c\u6d88\u5931\u7684-port"},"\u6848\u4f8b\u4e8c\uff1a\u6d88\u5931\u7684 port"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"http://alice.example.com:1234")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"http://alice.example.com:4567"),"\uff0c\u56e0\u70ba port \u4e0d\u4e00\u6a23\uff0c\u6240\u4ee5\u662f cross origin\uff0c\u4f46\u5982\u679c\u5169\u500b\u9801\u9762\u90fd\u57f7\u884c\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"document.domain = 'alice.example.com'")," \u7684\u8a71\uff0c\u5c31\u6703\u8b8a\u6210 same origin-domain\uff0c\u53ef\u4ee5\u5b58\u53d6\u5f7c\u6b64\u7684 DOM\uff0c\u56e0\u70ba\u5b83\u4e0d\u770b port\u3002"),(0,a.kt)("h3",{id:"\u6848\u4f8b\u4e09\u6211\u4e0d\u662f\u539f\u4f86\u7684\u6211"},"\u6848\u4f8b\u4e09\uff1a\u6211\u4e0d\u662f\u539f\u4f86\u7684\u6211"),(0,a.kt)("p",null,"\u5047\u8a2d ",(0,a.kt)("inlineCode",{parentName:"p"},"http://alice.example.com")," \u628a\u81ea\u5df1\u5d4c\u5165\u5728 iframe \u88e1\u9762\uff0c\u90a3 iframe \u8ddf\u539f\u672c\u7684\u9801\u9762\u986f\u7136\u662f same origin\uff0c\u53ef\u4ee5\u5b58\u53d6\u5f7c\u6b64\u7684 DOM\u3002"),(0,a.kt)("p",null,"\u4f46\u662f\u5462\uff0c\u5982\u679c\u6211\u5728\u9801\u9762\u4e0a\u57f7\u884c\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"document.domain = 'alice.example.com'"),"\uff0c\u9019\u9801\u9762\u5c31\u6703\u88ab\u8a2d\u7f6e domain \u5c6c\u6027\uff0c\u800c iframe \u88e1\u7684\u9801\u9762\u4e26\u6c92\u6709\u8a2d\u7f6e domain \u5c6c\u6027\uff0c\u6240\u4ee5\u5b83\u5011\u5c31\u8b8a\u5f97\u4e0d\u662f same origin-domain \u4e86\u3002"),(0,a.kt)("h2",{id:"documentdomain-\u7684\u6de1\u51fa\u53ca\u9000\u5834"},"document.domain \u7684\u6de1\u51fa\u53ca\u9000\u5834"),(0,a.kt)("p",null,"\u7528\u9019\u4e00\u62db\u4f86\u653e\u5bec same origin \u7684\u9650\u5236\u61c9\u8a72\u6eff\u65e9\u5c31\u6709\u4e86\uff0c\u800c\u9072\u9072\u6c92\u6709\u62d4\u6389\u5c31\u662f\u70ba\u4e86\u76f8\u5bb9\u65e9\u671f\u7684\u884c\u70ba\uff0c\u6211\u731c\u5728\u65e9\u671f\u7684\u6642\u5019\u5f88\u591a\u7db2\u9801\u90fd\u6703\u7528\u9019\u62db\u53bb\u5b58\u53d6 same site \u4f46\u662f cross origin \u7684\u9801\u9762\u3002"),(0,a.kt)("p",null,"\u4f46\u9019\u6a23\u505a\u986f\u7136\u662f\u6709\u98a8\u96aa\u7684\uff0c\u4f8b\u5982\u8aaa\u5047\u8a2d\u67d0\u500b subdomain \u6709 XSS \u6f0f\u6d1e\uff0c\u5c31\u6709\u6a5f\u6703\u5229\u7528\u9019\u500b\u65b9\u5f0f\u64f4\u5927\u5f71\u97ff\u7bc4\u570d\uff0c\u5728 2016 \u5e74\u7531 ",(0,a.kt)("a",{parentName:"p",href:"https://twitter.com/fin1te"},"@fin1te")," \u6240\u5beb\u7684\u4e00\u7bc7\u6587\u7ae0 ",(0,a.kt)("a",{parentName:"p",href:"https://whitton.io/articles/xss-on-facebook-via-png-content-types/"},"An XSS on Facebook via PNGs & Wonky Content Types")," \u4e2d\uff0c\u5c31\u5229\u7528\u4e86\u9019\u500b\u624b\u6cd5\uff0c\u6210\u529f\u5f9e subdomain \u7e5e\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"www.facebook.com")," \u9032\u884c XSS\uff0c\u63d0\u5347\u6f0f\u6d1e\u7684\u5f71\u97ff\u529b\u3002 "),(0,a.kt)("p",null,"\u4e5f\u56e0\u70ba\u5b89\u5168\u6027\u7684\u554f\u984c\uff0cChrome \u5728 2022 \u5e74 1 \u6708 11 \u65e5\u65bc\u90e8\u843d\u683c\u767c\u5e03\u4e86\u4e00\u7bc7\u6587\u7ae0\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://developer.chrome.com/blog/immutable-document-domain/"},"Chrome will disable modifying document.domain to relax the same-origin policy"),"\uff0c\u6587\u4e2d\u8aaa\u660e\u4e86\u6700\u5feb\u5f9e Chrome 101 \u7248\u958b\u59cb\uff0c\u5c31\u6703\u505c\u6b62\u652f\u63f4\u66f4\u6539 ",(0,a.kt)("inlineCode",{parentName:"p"},"document.domain"),"\u3002"),(0,a.kt)("p",null,"\u539f\u672c\u7684\u884c\u70ba\u53ef\u4ee5\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"postMessage")," \u6216\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Channel Messaging API")," \u4f86\u53d6\u4ee3\uff0c\u53ea\u662f\u8981\u591a\u5beb\u4e00\u4e9b\u7a0b\u5f0f\u78bc\u5c31\u662f\u4e86\uff0c\u7562\u7adf\u6c92\u8fa6\u6cd5\u50cf\u539f\u672c\u76f4\u63a5\u64cd\u4f5c DOM \u9019\u9ebc\u65b9\u4fbf\u3002"),(0,a.kt)("p",null,"\u800c\u5982\u679c\u6709\u7db2\u9801\u60f3\u7e7c\u7e8c\u4f7f\u7528\u9019\u500b\u4fee\u6539 document.domain \u7684\u529f\u80fd\uff0c\u9700\u8981\u5728 response header \u88e1\u9762\u5e36\u4e0a ",(0,a.kt)("inlineCode",{parentName:"p"},"Origin-Agent-Cluster: ?0"),"\uff0c\u624d\u80fd\u7e7c\u7e8c\u4f7f\u7528\u3002"),(0,a.kt)("p",null,"\u6587\u4e2d\u4e5f\u6709\u9644\u4e0a\u95dc\u65bc\u9019\u500b\u6539\u52d5\u7684\u76f8\u95dc\u8a0e\u8ad6\u4e32\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/w3ctag/design-reviews/issues/564"},"Deprecating document.domain setter. #564")),(0,a.kt)("h2",{id:"\u5c0f\u7d50"},"\u5c0f\u7d50"),(0,a.kt)("p",null,"\u6240\u8b02\u7684\u540c\u6e90\u653f\u7b56\uff0c\u5c31\u662f\u700f\u89bd\u5668\u7684\u4fdd\u8b77\u6a5f\u5236\uff0c\u78ba\u4fdd\u53ea\u6709\u540c\u6e90\u7684\u7db2\u9801\u53ef\u4ee5\u8b80\u53d6\u5f7c\u6b64\u7684\u8cc7\u6599\uff0c\u4f86\u907f\u514d\u8cc7\u5b89\u554f\u984c\u3002\u56e0\u6b64\u6211\u5011\u6709\u9700\u8981\u77e5\u9053 origin \u7684\u5b9a\u7fa9\u662f\u4ec0\u9ebc\uff0c\u624d\u80fd\u5224\u65b7\u5169\u500b\u7db2\u9801\u662f\u5426\u540c\u6e90\u3002"),(0,a.kt)("p",null,"\u4ecb\u7d39\u5b8c origin \u8207 site \u9019\u5169\u500b\u91cd\u8981\u7684\u57fa\u672c\u89c0\u5ff5\u4ee5\u5f8c\uff0c\u6211\u5011\u6703\u9678\u7e8c\u770b\u5230\u5169\u500b\u5ef6\u4f38\u7684\u540d\u8a5e\uff0c\u5206\u5225\u662f CSRF\uff08Cross-site request forgery\uff09 \u8207 CORS\uff08Cross-origin resource sharing\uff09\u3002"),(0,a.kt)("p",null,"\u672c\u6587\u6539\u5beb\u81ea\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://blog.huli.tw/2022/01/16/same-site-to-same-origin-document-domain/"},"\u5fcd\u8853\uff01\u628a same site \u8b8a same origin \u4e4b\u8853\uff01")),(0,a.kt)("p",null,"\u53c3\u8003\u8cc7\u6599\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://html.spec.whatwg.org/multipage/origin.html#origin"},"HTML spec")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://url.spec.whatwg.org/#host-registrable-domain"},"URL spec")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://blog.kalan.dev/2021-11-09-url-and-samesite/"},"\u5982\u4f55\u5224\u65b7\u5169\u500b\u7db2\u57df\u7684\u64c1\u6709\u8005\u662f\u5426\u76f8\u540c\uff1f")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://developer.chrome.com/blog/immutable-document-domain/"},"Chrome will disable modifying document.domain to relax the same-origin policy"))))}h.isMDXComponent=!0},4613:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/20-01-edadea6cfb957872adccc3a543883d9b.png"},280:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/20-02-b666bbfbac8fe1684ad927082dc5a452.png"},9993:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/20-03-251552df2e976227c38ada9c7ec321f5.png"},1033:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/20-04-290308aa6bce3f68805c523b6df75761.png"},1696:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/20-05-3b2e6e0865aa2cd1c254c8b23649dc9b.png"},455:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/20-06-0c004681ed15c8ee94ee0d2e87e5e3f1.png"}}]);