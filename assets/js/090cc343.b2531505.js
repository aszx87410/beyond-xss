"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[873],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=r.createContext({}),s=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=s(e.components);return r.createElement(p.Provider,{value:t},e.children)},m="mdxType",k={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=s(n),u=i,d=m["".concat(p,".").concat(u)]||m[u]||k[u]||a;return n?r.createElement(d,o(o({ref:t},c),{},{components:n})):r.createElement(d,o({ref:t},c))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[m]="string"==typeof e?e:i,o[1]=l;for(var s=2;s<a;s++)o[s]=n[s];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6704:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>k,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var r=n(7462),i=(n(7294),n(3905));const a={sidebar_position:22},o="\u8de8\u4f86\u6e90\u7684\u5b89\u5168\u6027\u554f\u984c",l={unversionedId:"ch4/cors-attack",id:"ch4/cors-attack",title:"\u8de8\u4f86\u6e90\u7684\u5b89\u5168\u6027\u554f\u984c",description:"\u96d6\u7136\u8aaa\u6709\u4e9b\u7db2\u7ad9\u6703\u5229\u7528 reverse proxy \u6216\u5176\u4ed6\u6a5f\u5236\u628a\u524d\u5f8c\u7aef\u653e\u5728\u540c\u4e00\u500b origin \u5e95\u4e0b\uff0c\u4f46\u9019\u4f3c\u4e4e\u662f\u5c11\u6578\u3002\u5728\u5927\u591a\u6578\u7684\u60c5\u6cc1\u4e0b\uff0c\u70ba\u4e86\u8981\u8b93\u524d\u7aef\u53ef\u4ee5\u5b58\u53d6\u5230\u8de8\u4f86\u6e90\u5f8c\u7aef API \u7684\u8cc7\u6599\uff0c\u958b\u653e\u8de8\u4f86\u6e90\u5b58\u53d6\u5e7e\u4e4e\u662f\u4e0d\u53ef\u907f\u514d\u3002",source:"@site/docs/ch4/22-cors-attack.md",sourceDirName:"ch4",slug:"/ch4/cors-attack",permalink:"/beyond-xss/ch4/cors-attack",draft:!1,tags:[],version:"current",sidebarPosition:22,frontMatter:{sidebar_position:22},sidebar:"tutorialSidebar",previous:{title:"\u8de8\u4f86\u6e90\u8cc7\u6e90\u5171\u7528 CORS \u57fa\u672c\u4ecb\u7d39",permalink:"/beyond-xss/ch4/cors-intro"},next:{title:"\u8de8\u7ad9\u8acb\u6c42\u507d\u9020 CSRF \u4e00\u9ede\u5c31\u901a",permalink:"/beyond-xss/ch4/csrf"}},p={},s=[{value:"CORS misconfiguration",id:"cors-misconfiguration",level:2},{value:"\u5be6\u969b\u6848\u4f8b",id:"\u5be6\u969b\u6848\u4f8b",level:3},{value:"\u5176\u4ed6\u5404\u7a2e COXX \u7cfb\u5217 header",id:"\u5176\u4ed6\u5404\u7a2e-coxx-\u7cfb\u5217-header",level:2},{value:"\u56b4\u91cd\u7684\u5b89\u5168\u6f0f\u6d1e\uff1aMeltdown \u8207 Spectre",id:"\u56b4\u91cd\u7684\u5b89\u5168\u6f0f\u6d1emeltdown-\u8207-spectre",level:2},{value:"\u8d85\u7d1a\u7c21\u5316\u7248\u7684 Spectre \u653b\u64ca\u89e3\u91cb",id:"\u8d85\u7d1a\u7c21\u5316\u7248\u7684-spectre-\u653b\u64ca\u89e3\u91cb",level:2},{value:"CORB\uff08Cross-Origin Read Blocking\uff09",id:"corbcross-origin-read-blocking",level:2},{value:"CORP\uff08Cross-Origin Resource Policy\uff09",id:"corpcross-origin-resource-policy",level:2},{value:"Site Isolation",id:"site-isolation",level:2},{value:"COEP\uff08Cross-Origin-Embedder-Policy\uff09",id:"coepcross-origin-embedder-policy",level:2},{value:"COOP\uff08Cross-Origin-Opener-Policy\uff09",id:"coopcross-origin-opener-policy",level:2},{value:"\u518d\u56de\u5230 cross-origin isolated state",id:"\u518d\u56de\u5230-cross-origin-isolated-state",level:2},{value:"\u5c0f\u7d50",id:"\u5c0f\u7d50",level:2}],c={toc:s},m="wrapper";function k(e){let{components:t,...a}=e;return(0,i.kt)(m,(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"\u8de8\u4f86\u6e90\u7684\u5b89\u5168\u6027\u554f\u984c"},"\u8de8\u4f86\u6e90\u7684\u5b89\u5168\u6027\u554f\u984c"),(0,i.kt)("p",null,"\u96d6\u7136\u8aaa\u6709\u4e9b\u7db2\u7ad9\u6703\u5229\u7528 reverse proxy \u6216\u5176\u4ed6\u6a5f\u5236\u628a\u524d\u5f8c\u7aef\u653e\u5728\u540c\u4e00\u500b origin \u5e95\u4e0b\uff0c\u4f46\u9019\u4f3c\u4e4e\u662f\u5c11\u6578\u3002\u5728\u5927\u591a\u6578\u7684\u60c5\u6cc1\u4e0b\uff0c\u70ba\u4e86\u8981\u8b93\u524d\u7aef\u53ef\u4ee5\u5b58\u53d6\u5230\u8de8\u4f86\u6e90\u5f8c\u7aef API \u7684\u8cc7\u6599\uff0c\u958b\u653e\u8de8\u4f86\u6e90\u5b58\u53d6\u5e7e\u4e4e\u662f\u4e0d\u53ef\u907f\u514d\u3002"),(0,i.kt)("p",null,"\u800c CORS header \u7684\u8a2d\u5b9a\u770b\u4f3c\u7c21\u55ae\uff0c\u4f46\u5be6\u4f5c\u4e0a\u53ef\u4e0d\u4e00\u5b9a\u3002\u5982\u679c\u8a2d\u7f6e\u6709\u554f\u984c\u7684\u8a71\uff0c\u5c31\u53ef\u4ee5\u8b93\u653b\u64ca\u8005\u5b58\u53d6\u5230\u4e0d\u8a72\u5b58\u53d6\u7684\u8cc7\u6e90\u3002"),(0,i.kt)("p",null,"\u9664\u6b64\u4e4b\u5916\uff0c\u9664\u4e86 CORS \u7684\u8a2d\u7f6e\u932f\u8aa4\uff0c\u50cf\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"<img>")," \u6216\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"<script>")," \u7684\u90a3\u7a2e\u8de8\u4f86\u6e90\u5b58\u53d6\u5176\u5be6\u4e5f\u6709\u8cc7\u5b89\u4e0a\u7684\u96b1\u6182\uff0c\u9019\u9ede\u6211\u5011\u4e5f\u6703\u5728\u9019\u7bc7\u4e00\u8d77\u8ac7\u5230\u3002"),(0,i.kt)("h2",{id:"cors-misconfiguration"},"CORS misconfiguration"),(0,i.kt)("p",null,"\u524d\u9762\u6211\u6709\u63d0\u5230\u904e\u5982\u679c\u8de8\u4f86\u6e90\u975e\u7c21\u55ae\u8acb\u6c42\u60f3\u8981\u5e36\u4e0a cookie\uff0c\u90a3 ",(0,i.kt)("inlineCode",{parentName:"p"},"Access-Control-Allow-Origin")," \u5c31\u4e0d\u80fd\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"*"),"\uff0c\u800c\u662f\u5fc5\u9808\u6307\u5b9a\u55ae\u4e00\u7684 origin\uff0c\u5426\u5247\u700f\u89bd\u5668\u5c31\u4e0d\u6703\u7d66\u904e\u3002"),(0,i.kt)("p",null,"\u4f46\u73fe\u5be6\u7684\u72c0\u6cc1\u662f\uff0c\u6211\u5011\u4e0d\u53ef\u80fd\u53ea\u6709\u4e00\u500b origin\u3002\u6211\u5011\u53ef\u80fd\u6709\u8a31\u591a\u7684 origin\uff0c\u4f8b\u5982\u8aaa ",(0,i.kt)("inlineCode",{parentName:"p"},"buy.huli.tw"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"social.huli.org"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"note.huli.com.tw"),"\uff0c\u90fd\u9700\u8981\u53bb\u5b58\u53d6 ",(0,i.kt)("inlineCode",{parentName:"p"},"api.huli.tw"),"\uff0c\u9019\u6642\u5019\u6211\u5011\u5c31\u6c92\u8fa6\u6cd5\u5beb\u6b7b response header \u88e1\u7684 origin\uff0c\u800c\u662f\u5fc5\u9808\u52d5\u614b\u8abf\u6574\u3002"),(0,i.kt)("p",null,"\u5148\u8b1b\u4e00\u7a2e\u6700\u7cdf\u7cd5\u7684\u5beb\u6cd5\uff0c\u5c31\u662f\u9019\u6a23\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"app.use((req, res, next) => {\n  res.headers['Access-Control-Allow-Credentials'] = 'true'\n  res.headers['Access-Control-Allow-Origin'] = req.headers['Origin']\n})\n")),(0,i.kt)("p",null,"\u70ba\u4e86\u65b9\u4fbf\u8d77\u898b\uff0c\u6240\u4ee5\u76f4\u63a5\u653e\u5165 request header \u88e1\u9762\u7684 origin\u3002\u9019\u6a23\u505a\u7684\u8a71\uff0c\u5176\u5be6\u5c31\u4ee3\u8868\u4efb\u4f55\u4e00\u500b origin \u90fd\u80fd\u5920\u901a\u904e CORS \u6aa2\u67e5\u3002"),(0,i.kt)("p",null,"\u9019\u6a23\u505a\u6703\u6709\u4ec0\u9ebc\u554f\u984c\u5462\uff1f"),(0,i.kt)("p",null,"\u554f\u984c\u53ef\u5927\u4e86\u3002"),(0,i.kt)("p",null,"\u5047\u8a2d\u6211\u4eca\u5929\u505a\u4e00\u500b\u7db2\u7ad9\uff0c\u7db2\u5740\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"https://fake-example.com"),"\uff0c\u4e26\u4e14\u8a66\u5716\u8b93\u4f7f\u7528\u8005\u53bb\u9ede\u64ca\u9019\u500b\u7db2\u7ad9\uff0c\u800c\u7db2\u7ad9\u88e1\u9762\u5beb\u4e86\u4e00\u6bb5 script\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// \u7528 api \u53bb\u62ff\u4f7f\u7528\u8005\u8cc7\u6599\uff0c\u4e26\u4e14\u5e36\u4e0a cookie\nfetch('https://api.example.com/me', {\n  credentials: 'include'\n})\n  .then(res => res.text())\n  .then(res => {\n    // \u6210\u529f\u62ff\u5230\u4f7f\u7528\u8005\u8cc7\u6599\uff0c\u6211\u53ef\u4ee5\u50b3\u9001\u5230\u6211\u81ea\u5df1\u7684 server\n    console.log(res)\n\n    // \u628a\u4f7f\u7528\u8005\u5c0e\u56de\u771f\u6b63\u7684\u7db2\u7ad9\n    window.location = 'https://example.com'\n  })\n")),(0,i.kt)("p",null,"\u56e0\u70ba\u4f3a\u670d\u5668\u56de\u50b3\u4e86\u6b63\u78ba\u7684 header\uff0c\u8a8d\u53ef ",(0,i.kt)("inlineCode",{parentName:"p"},"https://fake-example.com")," \u662f\u5408\u683c\u7684 origin\uff0cCORS \u6aa2\u67e5\u5c31\u901a\u904e\u4e86\uff0c\u6240\u4ee5\u5728\u9019\u7db2\u7ad9\u4e0a\u4e5f\u80fd\u62ff\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"http://api.example.com/me")," \u7684\u8cc7\u6599\u3002"),(0,i.kt)("p",null,"\u56e0\u6b64\u9019\u500b\u653b\u64ca\u53ea\u8981\u4f7f\u7528\u8005\u9ede\u4e86\u7db2\u7ad9\u4e26\u4e14\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"example.com")," \u662f\u767b\u5165\u72c0\u614b\u5c31\u6703\u4e2d\u62db\u3002\u81f3\u65bc\u5f71\u97ff\u7bc4\u570d\u8981\u770b\u7db2\u7ad9\u7684 API\uff0c\u6700\u57fa\u672c\u7684\u5c31\u662f\u53ea\u62ff\u5f97\u5230\u4f7f\u7528\u8005\u8cc7\u6599\uff0c\u6bd4\u8f03\u56b4\u91cd\u4e00\u9ede\u7684\u53ef\u80fd\u53ef\u4ee5\u62ff\u5230\u4f7f\u7528\u8005\u7684 token\uff08\u5982\u679c\u6709\u9019\u500b API \u7684\u8a71\uff09\u3002"),(0,i.kt)("p",null,"\u9019\u500b\u653b\u64ca\u6709\u5e7e\u4ef6\u4e8b\u60c5\u8981\u6ce8\u610f\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u9019\u4e0d\u662f XSS\uff0c\u56e0\u70ba\u6211\u6c92\u6709\u5728 ",(0,i.kt)("inlineCode",{parentName:"li"},"example.com")," \u57f7\u884c\u7a0b\u5f0f\u78bc\uff0c\u6211\u662f\u5728\u6211\u81ea\u5df1\u7684\u7db2\u7ad9 ",(0,i.kt)("inlineCode",{parentName:"li"},"http://fake-example.com")," \u4e0a\u57f7\u884c"),(0,i.kt)("li",{parentName:"ol"},"\u9019\u6709\u9ede\u50cf\u662f CSRF\uff0c\u4f46\u662f\u7db2\u7ad9\u901a\u5e38\u5c0d\u65bc GET \u7684 API \u4e26\u4e0d\u6703\u52a0\u4e0a CSRF token \u7684\u9632\u8b77\uff0c\u6240\u4ee5\u53ef\u4ee5\u904e\u95dc"),(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c\u6709\u8a2d\u5b9a SameSite cookie\uff0c\u653b\u64ca\u5c31\u6703\u5931\u6548\uff0c\u56e0\u70ba cookie \u6703\u5e36\u4e0d\u4e0a\u53bb")),(0,i.kt)("p",null,"\uff08CSRF \u8ddf SameSite \u4e4b\u5f8c\u90fd\u6703\u518d\u63d0\u5230\uff09"),(0,i.kt)("p",null,"\u56e0\u6b64\u9019\u500b\u653b\u64ca\u8981\u6210\u7acb\u6709\u5e7e\u500b\u524d\u63d0\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"CORS header \u7d66\u5230\u4e0d\u8a72\u7d66\u7684 origin"),(0,i.kt)("li",{parentName:"ol"},"\u7db2\u7ad9\u63a1\u7528 cookie \u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u800c\u4e14\u6c92\u6709\u8a2d\u5b9a SameSite"),(0,i.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u8005\u8981\u4e3b\u52d5\u9ede\u64ca\u7db2\u7ad9\u4e26\u4e14\u662f\u767b\u5165\u72c0\u614b")),(0,i.kt)("p",null,"\u91dd\u5c0d\u7b2c\u4e00\u9ede\uff0c\u53ef\u80fd\u6c92\u6709\u4eba\u6703\u50cf\u6211\u4e0a\u9762\u90a3\u6a23\u5b50\u5beb\uff0c\u76f4\u63a5\u7528 request header \u7684 origin\u3002\u6bd4\u8f03\u6709\u53ef\u80fd\u7684\u505a\u6cd5\u662f\u9019\u6a23\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"app.use((req, res, next) => {\n  res.headers['Access-Control-Allow-Credentials'] = 'true'\n  const origin = req.headers['Origin']\n\n  // \u5075\u6e2c\u662f\u4e0d\u662f example.com \u7d50\u5c3e\n  if (/example\\.com$/.test(origin)) {\n    res.headers['Access-Control-Allow-Origin'] = origin\n  }\n})\n")),(0,i.kt)("p",null,"\u5982\u6b64\u4e00\u4f86\uff0c\u5e95\u4e0b\u7684 origin \u90fd\u53ef\u4ee5\u904e\u95dc\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"example.com"),(0,i.kt)("li",{parentName:"ol"},"buy.example.com"),(0,i.kt)("li",{parentName:"ol"},"social.example.com")),(0,i.kt)("p",null,"\u53ef\u662f\u9019\u6a23\u5beb\u662f\u6709\u554f\u984c\u7684\uff0c\u56e0\u70ba\u9019\u6a23\u4e5f\u53ef\u4ee5\u904e\u95dc\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"fakeexample.com")),(0,i.kt)("p",null,"\u50cf\u662f\u9019\u985e\u578b\u7684\u6f0f\u6d1e\u662f\u7d93\u7531\u932f\u8aa4\u7684 CORS \u8a2d\u7f6e\u5f15\u8d77\uff0c\u6240\u4ee5\u7a31\u70ba CORS misconfiguration\u3002"),(0,i.kt)("p",null,"\u800c\u89e3\u6c7a\u65b9\u6cd5\u5c31\u662f\u4e0d\u8981\u7528 RegExp \u53bb\u5224\u65b7\uff0c\u800c\u662f\u4e8b\u5148\u6e96\u5099\u597d\u4e00\u500b\u6e05\u55ae\uff0c\u6709\u5728\u6e05\u55ae\u4e2d\u51fa\u73fe\u7684\u624d\u901a\u904e\uff0c\u5426\u5247\u90fd\u662f\u5931\u6557\u3002\u5982\u6b64\u4e00\u4f86\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8b49\u4e0d\u6703\u6709\u5224\u65b7\u4e0a\u7684\u6f0f\u6d1e\uff0c\u7136\u5f8c\u4e5f\u8a18\u5f97\u628a cookie \u52a0\u4e0a SameSite \u5c6c\u6027\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const allowOrigins = [\n  'https://example.com',\n  'https://buy.example.com',\n  'https://social.example.com'\n]\napp.use((req, res, next) => {\n  res.headers['Access-Control-Allow-Credentials'] = 'true'\n  const origin = req.headers['Origin']\n\n  if (allowOrigins.includes(origin)) {\n    res.headers['Access-Control-Allow-Origin'] = origin\n  }\n})\n")),(0,i.kt)("h3",{id:"\u5be6\u969b\u6848\u4f8b"},"\u5be6\u969b\u6848\u4f8b"),(0,i.kt)("p",null,"\u7b2c\u4e00\u500b\u6848\u4f8b\u662f Jordan Milne \u5728 2016 \u5e74\u627e\u5230\u7684 JetBrains IDE \u7684\u6f0f\u6d1e\u3002"),(0,i.kt)("p",null,"\u5728\u4f7f\u7528 JetBrains IDE \u7684\u6642\u5019\uff0c\u5b83\u6703\u81ea\u5df1\u8dd1\u4e00\u500b local server \u8d77\u4f86\uff0c\u7576\u4f60\u958b\u555f\u4e00\u500b\u6a94\u6848\u4e26\u6309\u4e0b\u300cview in browser\u300d\u7684\u6642\u5019\uff0c\u5c31\u6703\u6253\u958b\u7db2\u5740\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost:63342/<projectname>/<your_file.html>"),"\uff0c\u80cc\u5f8c\u5c31\u662f\u90a3\u500b local server \u5728\u8ca0\u8cac\u3002"),(0,i.kt)("p",null,"\u800c\u9019\u500b server \u6c92\u6709\u5beb\u597d\uff0c\u5b83\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Access-Control-Allow-Origin")," header \u5c31\u8ddf\u6211\u524d\u9762\u8209\u7684\u932f\u8aa4\u7bc4\u4f8b\u4e00\u6a23\uff0c\u76f4\u63a5\u4f7f\u7528\u4e86\u8acb\u6c42\u4e2d\u7684 origin header\uff0c\u56e0\u6b64\u4efb\u610f\u7db2\u7ad9\u90fd\u53ef\u4ee5\u8b80\u53d6 response\u3002"),(0,i.kt)("p",null,"\u518d\u4f86\u4f5c\u8005\u53c8\u767c\u73fe\u4e86\u8def\u5f91\u904d\u6b77\uff08path traversal\uff09\u7684\u6f0f\u6d1e\uff0c\u53ef\u4ee5\u5229\u7528\u9019\u500b API \u8b80\u53d6\u5230\u4efb\u4f55\u6a94\u6848\u3002\u56e0\u6b64\u7d50\u5408\u8d77\u4f86\uff0c\u7b49\u65bc\u662f\u653b\u64ca\u8005\u53ef\u4ee5\u5728\u4ed6\u7684\u7db2\u7ad9\u4e0a\uff0c\u900f\u904e JetBrains \u7684 local server API \u8b80\u53d6\u5230\u7cfb\u7d71\u4e0a\u7684\u6a94\u6848\u3002"),(0,i.kt)("p",null,"\u4f5c\u8005\u7d66\u7684\u7c21\u55ae PoC \u662f\u9019\u6a23\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<script>\nvar xhr = new XMLHttpRequest();\nxhr.open("GET", "http://localhost:63342/testing/something.txt", true);\nxhr.onload = function() {alert(xhr.responseText)};\nxhr.send();\n<\/script>\n')),(0,i.kt)("p",null,"\u5f8c\u7e8c\u4f5c\u8005\u53c8\u627e\u5230\u5176\u4ed6\u554f\u984c\uff0c\u4e26\u6210\u529f\u9054\u6210\u4e86 RCE\uff0c\u4f46\u90a3\u4e9b\u90e8\u5206\u8207\u9019\u7bc7\u95dc\u6ce8\u7684 CORS \u8a2d\u5b9a\u554f\u984c\u7121\u95dc\uff0c\u56e0\u6b64\u6211\u5c31\u4e0d\u7d30\u8b1b\u4e86\uff0c\u6709\u8208\u8da3\u7684\u53ef\u4ee5\u53bb\u539f\u6587\u89c0\u770b\uff1a",(0,i.kt)("a",{parentName:"p",href:"http://blog.saynotolinux.com/blog/2016/08/15/jetbrains-ide-remote-code-execution-and-local-file-disclosure-vulnerability-analysis/"},"JetBrains IDE Remote Code Execution and Local File Disclosure"),"\u3002"),(0,i.kt)("p",null,"\u7b2c\u4e8c\u500b\u6848\u4f8b\u662f James Kettle \u5728 2017 \u5e74 AppSec EU \u7814\u8a0e\u6703\u4e0a\u5206\u4eab\u7684\u6bd4\u7279\u5e63\u4ea4\u6613\u6240\u7684\u6f0f\u6d1e\u3002"),(0,i.kt)("p",null,"\u4ed6\u627e\u5230\u4e86\u4e00\u500b\u4ea4\u6613\u6240\u6709\u500b API \u540c\u6a23\u6709\u8457\u76f8\u540c\u7684\u6f0f\u6d1e\uff0c\u5141\u8a31\u4efb\u610f origin \u8de8\u4f86\u6e90\u8b80\u53d6 response\uff0c\u800c\u5176\u4e2d\u4e00\u500b API \u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/requestApiKey"),"\uff0c\u53ef\u4ee5\u62ff\u5230\u4f7f\u7528\u8005\u7684 apiKey\uff0c\u800c\u9019\u500b apiKey \u53ef\u4ee5\u8b93\u4f60\u628a\u4f7f\u7528\u8005\u7684\u6bd4\u7279\u5e63\u8f49\u5230\u81ea\u5df1\u7684\u5e33\u6236\u53bb\u3002"),(0,i.kt)("p",null,"\u60f3\u770b\u66f4\u591a\u53ef\u4ee5\u53c3\u8003\uff1a",(0,i.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=wgkj4ZgxI4c&ab_channel=OWASP"},"AppSec EU 2017 Exploiting CORS Misconfigurations For Bitcoins And Bounties by James Kettle")),(0,i.kt)("p",null,"\u6700\u5f8c\u4e00\u500b\u4f86\u770b\u6211\u81ea\u5df1\u5728 2020 \u5e74\u56de\u5831\u7684 Asiayo \u6f0f\u6d1e\uff0croot cause \u4e00\u6a21\u4e00\u6a23\uff0c\u53ef\u4ee5\u5728\u5225\u7684\u7db2\u7ad9\u62ff\u5230\u4f7f\u7528\u8005\u7684\u8cc7\u6599\uff0c\u5305\u62ec\u59d3\u540d\u3001\u624b\u6a5f\u4ee5\u53ca email \u7b49\u7b49\uff1a"),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(802).Z,width:"1201",height:"153"})),(0,i.kt)("p",null,"\u539f\u59cb\u5831\u544a\uff1a",(0,i.kt)("a",{parentName:"p",href:"https://zeroday.hitcon.org/vulnerability/ZD-2020-00829"},"Asiayo \u7db2\u7ad9 CORS misconfiguration \u6f0f\u6d1e")),(0,i.kt)("h2",{id:"\u5176\u4ed6\u5404\u7a2e-coxx-\u7cfb\u5217-header"},"\u5176\u4ed6\u5404\u7a2e COXX \u7cfb\u5217 header"),(0,i.kt)("p",null,"\u9664\u4e86\u6211\u5011\u6700\u719f\u6089\u7684 CORS \u4ee5\u5916\uff0c\u9084\u6709\u5e7e\u500b\u4ee5 CO \u958b\u982d\u7684 header\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"CORB\uff08Cross-Origin Read Blocking\uff09"),(0,i.kt)("li",{parentName:"ol"},"CORP\uff08Cross-Origin Resource Policy\uff09"),(0,i.kt)("li",{parentName:"ol"},"COEP\uff08Cross-Origin-Embedder-Policy\uff09"),(0,i.kt)("li",{parentName:"ol"},"COOP\uff08Cross-Origin-Opener-Policy\uff09")),(0,i.kt)("p",null,"\u9019\u4e9b header \u7684 CO \u4e5f\u90fd\u662f Cross-origin \u7684\u7c21\u5beb\uff0c\u56e0\u6b64\u4e5f\u8ddf\u8de8\u4f86\u6e90\u7684\u8cc7\u6599\u5b58\u53d6\u6709\u95dc\uff0c\u63a5\u8457\u6211\u5011\u5c31\u4f86\u770b\u770b\u9019\u4e9b header \u5230\u5e95\u662f\u5728\u505a\u4ec0\u9ebc\u7684\u3002"),(0,i.kt)("h2",{id:"\u56b4\u91cd\u7684\u5b89\u5168\u6f0f\u6d1emeltdown-\u8207-spectre"},"\u56b4\u91cd\u7684\u5b89\u5168\u6f0f\u6d1e\uff1aMeltdown \u8207 Spectre"),(0,i.kt)("p",null,"\u5728 2018 \u5e74 1 \u6708 3 \u865f\uff0cGoogle \u7684 Project Zeror \u5c0d\u5916\u767c\u5e03\u4e86\u4e00\u7bc7\u540d\u70ba\uff1a",(0,i.kt)("a",{parentName:"p",href:"https://googleprojectzero.blogspot.com/2018/01/reading-privileged-memory-with-side.html"},"Reading privileged memory with a side-channel")," \u7684\u6587\u7ae0\uff0c\u88e1\u9762\u8b1b\u8ff0\u4e86\u4e09\u7a2e\u91dd\u5c0d CPU data cache \u7684\u653b\u64ca\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Variant 1: bounds check bypass (CVE-2017-5753)"),(0,i.kt)("li",{parentName:"ul"},"Variant 2: branch target injection (CVE-2017-5715)"),(0,i.kt)("li",{parentName:"ul"},"Variant 3: rogue data cache load (CVE-2017-5754)")),(0,i.kt)("p",null,"\u800c\u524d\u5169\u7a2e\u53c8\u88ab\u7a31\u70ba Spectre\uff0c\u7b2c\u4e09\u7a2e\u88ab\u7a31\u70ba\u662f Meltdown\u3002\u5982\u679c\u4f60\u6709\u5370\u8c61\u7684\u8a71\uff0c\u5728\u7576\u6642\u9019\u53ef\u662f\u4e00\u4ef6\u5927\u4e8b\uff0c\u56e0\u70ba\u554f\u984c\u662f\u51fa\u5728 CPU\uff0c\u800c\u4e14\u4e26\u4e0d\u662f\u500b\u5bb9\u6613\u4fee\u5fa9\u7684\u554f\u984c\u3002"),(0,i.kt)("p",null,"\u800c\u9019\u500b\u6f0f\u6d1e\u7684\u516c\u4f48\u6211\u89ba\u5f97\u5c0d\u65bc\u700f\u89bd\u5668\u7684\u904b\u4f5c\u6a5f\u5236\u6709\u6eff\u5927\u7684\u5f71\u97ff\uff08\u6216\u81f3\u5c11\u52a0\u901f\u4e86\u700f\u89bd\u5668\u6f14\u9032\u7684\u904e\u7a0b\uff09\uff0c\u5c24\u5176\u662f spectre \u53ef\u4ee5\u62ff\u4f86\u653b\u64ca\u700f\u89bd\u5668\uff0c\u800c\u9019\u7576\u7136\u4e5f\u5f71\u97ff\u4e86\u9019\u7cfb\u5217\u7684\u4e3b\u984c\uff1a\u8de8\u4f86\u6e90\u8cc7\u6e90\u5b58\u53d6\u3002"),(0,i.kt)("p",null,"\u56e0\u6b64\uff0c\u7a0d\u5fae\u7406\u89e3\u4e00\u4e0b Spectre \u5728\u5e79\u561b\u6211\u89ba\u5f97\u662f\u5f88\u6709\u5fc5\u8981\u7684\u3002\u5982\u679c\u60f3\u8981\u5b8c\u5168\u7406\u89e3\u9019\u500b\u653b\u64ca\uff0c\u9700\u8981\u6709\u6eff\u591a\u7684\u80cc\u666f\u77e5\u8b58\uff0c\u4f46\u9019\u4e0d\u662f\u9019\u4e00\u7bc7\u4e3b\u8981\u60f3\u8b1b\u7684\u6771\u897f\uff0c\u56e0\u6b64\u5e95\u4e0b\u6211\u6703\u4ee5\u975e\u5e38\u7c21\u5316\u7684\u6a21\u578b\u4f86\u89e3\u91cb Spectre\uff0c\u60f3\u8981\u5b8c\u5168\u7406\u89e3\u7684\u8a71\u53ef\u4ee5\u53c3\u8003\u4e0a\u9762\u7684\u9023\u7d50\u3002"),(0,i.kt)("h2",{id:"\u8d85\u7d1a\u7c21\u5316\u7248\u7684-spectre-\u653b\u64ca\u89e3\u91cb"},"\u8d85\u7d1a\u7c21\u5316\u7248\u7684 Spectre \u653b\u64ca\u89e3\u91cb"),(0,i.kt)("p",null,"\u518d\u6b21\u5f37\u8abf\uff0c\u9019\u662f\u70ba\u4e86\u65b9\u4fbf\u7406\u89e3\u6240\u7c21\u5316\u904e\u7684\u7248\u672c\uff0c\u8ddf\u539f\u59cb\u7684\u653b\u64ca\u6709\u4e00\u5b9a\u51fa\u5165\uff0c\u4f46\u6838\u5fc3\u6982\u5ff5\u61c9\u8a72\u662f\u985e\u4f3c\u7684\u3002"),(0,i.kt)("p",null,"\u5047\u8a2d\u73fe\u5728\u6709\u4e00\u6bb5\u7a0b\u5f0f\u78bc\uff08C \u8a9e\u8a00\uff09\u9577\u9019\u6a23\u5b50\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"uint8_t arr1[16] = {1, 2, 3}; \nuint8_t arr2[256]; \nunsigned int array1_size = 16;\n\nvoid run(size_t x) {\n  if(x < array1_size) {\n    uint8_t y = array2[array1[x]];\n  }\n}\n\nsize_t x = 1;\nrun(x);\n")),(0,i.kt)("p",null,"\u6211\u5ba3\u544a\u4e86\u5169\u500b\u9663\u5217\uff0c\u578b\u614b\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"uint8_t"),"\uff0c\u6240\u4ee5\u6bcf\u500b\u9663\u5217\u7684\u5143\u7d20\u5927\u5c0f\u90fd\u6703\u662f 1 \u500b byte\uff088 bit\uff09\u3002\u800c arr1 \u7684\u9577\u5ea6\u662f 16\uff0carr2 \u7684\u9577\u5ea6\u662f 256\u3002"),(0,i.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u6709\u4e00\u500b function \u53eb\u505a ",(0,i.kt)("inlineCode",{parentName:"p"},"run"),"\uff0c\u6703\u5403\u4e00\u500b\u6578\u5b57 x\uff0c\u7136\u5f8c\u5224\u65b7 x \u662f\u4e0d\u662f\u6bd4 ",(0,i.kt)("inlineCode",{parentName:"p"},"array1_size")," \u5c0f\uff0c\u662f\u7684\u8a71\u6211\u5c31\u5148\u628a ",(0,i.kt)("inlineCode",{parentName:"p"},"array1[x]")," \u7684\u503c\u53d6\u51fa\u4f86\uff0c\u7136\u5f8c\u4f5c\u70ba\u7d22\u5f15\u53bb\u5b58\u53d6 ",(0,i.kt)("inlineCode",{parentName:"p"},"array2"),"\uff0c\u518d\u628a\u62ff\u5230\u7684\u503c\u7d66 y\u3002"),(0,i.kt)("p",null,"\u4ee5\u4e0a\u9762\u7684\u4f8b\u5b50\u4f86\u8aaa\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"run(1)")," \u7684\u8a71\uff0c\u5c31\u6703\u57f7\u884c\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-C"},"uint8_t y = array2[array1[1]];\n")),(0,i.kt)("p",null,"\u800c ",(0,i.kt)("inlineCode",{parentName:"p"},"array1[1]")," \u7684\u503c\u662f 2\uff0c\u6240\u4ee5\u5c31\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"y = array2[2]"),"\u3002"),(0,i.kt)("p",null,"\u9019\u6bb5\u7a0b\u5f0f\u78bc\u770b\u8d77\u4f86\u6c92\u4ec0\u9ebc\u554f\u984c\uff0c\u800c\u4e14\u6211\u6709\u505a\u4e86\u9663\u5217\u9577\u5ea6\u7684\u5224\u65b7\uff0c\u6240\u4ee5\u4e0d\u6703\u6709\u8d85\u51fa\u9663\u5217\u7d22\u5f15\uff08Out-of-Bounds\uff0c\u7c21\u7a31 OOB\uff09\u7684\u72c0\u6cc1\u767c\u751f\uff0c\u53ea\u6709\u5728 x \u6bd4 array1_size \u5c0f\u7684\u6642\u5019\u624d\u6703\u7e7c\u7e8c\u5f80\u4e0b\u57f7\u884c\u3002 "),(0,i.kt)("p",null,"\u4e0d\u904e\u9019\u53ea\u662f\u4f60\u770b\u8d77\u4f86\u800c\u5df2\u3002"),(0,i.kt)("p",null,"\u5728 CPU \u57f7\u884c\u7a0b\u5f0f\u78bc\u7684\u6642\u5019\uff0c\u6709\u4e00\u500b\u6a5f\u5236\u53eb\u505a branch prediction\u3002\u70ba\u4e86\u589e\u9032\u7a0b\u5f0f\u78bc\u57f7\u884c\u7684\u6548\u7387\uff0c\u6240\u4ee5 CPU \u5728\u57f7\u884c\u7684\u6642\u5019\u5982\u679c\u78b0\u5230 if \u689d\u4ef6\uff0c\u6703\u5148\u9810\u6e2c\u7d50\u679c\u662f true \u9084\u662f false\uff0c\u5982\u679c\u9810\u6e2c\u7684\u7d50\u679c\u662f true\uff0c\u5c31\u6703\u5148\u5e6b\u4f60\u57f7\u884c if \u88e1\u9762\u7684\u7a0b\u5f0f\u78bc\uff0c\u628a\u7d50\u679c\u5148\u7b97\u51fa\u4f86\u3002"),(0,i.kt)("p",null,"\u525b\u525b\u8b1b\u7684\u90fd\u53ea\u662f\u300c\u9810\u6e2c\u300d\uff0c\u7b49\u5230\u5be6\u969b\u7684 if \u689d\u4ef6\u57f7\u884c\u5b8c\u4e4b\u5f8c\uff0c\u5982\u679c\u8ddf\u9810\u6e2c\u7684\u7d50\u679c\u76f8\u540c\uff0c\u90a3\u5c31\u7686\u5927\u6b61\u559c\uff0c\u5982\u679c\u4e0d\u540c\u7684\u8a71\uff0c\u5c31\u6703\u628a\u525b\u525b\u7b97\u5b8c\u7684\u7d50\u679c\u4e1f\u6389\uff0c\u9019\u500b\u6a5f\u5236\u7a31\u70ba\uff1a\u9810\u6e2c\u57f7\u884c\uff08speculatively execute\uff09"),(0,i.kt)("p",null,"\u56e0\u70ba CPU \u6703\u628a\u7d50\u679c\u4e1f\u6389\uff0c\u6240\u4ee5\u6211\u5011\u4e5f\u62ff\u4e0d\u5230\u9810\u6e2c\u57f7\u884c\u7684\u7d50\u679c\uff0c\u9664\u975e CPU \u6709\u7559\u4e0b\u4e00\u4e9b\u7dda\u7d22\u3002"),(0,i.kt)("p",null,"\u800c\u9019\u5c31\u662f Spectre \u653b\u64ca\u6210\u7acb\u7684\u4e3b\u56e0\uff0c\u56e0\u70ba\u9084\u771f\u7684\u6709\u7559\u4e0b\u7dda\u7d22\u3002"),(0,i.kt)("p",null,"\u4e00\u6a23\u662f\u70ba\u4e86\u589e\u9032\u57f7\u884c\u7684\u6548\u7387\uff0c\u5728\u9810\u6e2c\u57f7\u884c\u7684\u6642\u5019\u6703\u628a\u4e00\u4e9b\u7d50\u679c\u653e\u5230 CPU cache \u88e1\u9762\uff0c\u589e\u9032\u4e4b\u5f8c\u8b80\u53d6\u8cc7\u6599\u7684\u6548\u7387\u3002"),(0,i.kt)("p",null,"\u5047\u8a2d\u73fe\u5728\u6709 ABC \u4e09\u500b\u6771\u897f\uff0c\u4e00\u500b\u5728 CPU cache \u88e1\u9762\uff0c\u5176\u4ed6\u5169\u500b\u90fd\u4e0d\u5728\uff0c\u6211\u5011\u8981\u600e\u9ebc\u77e5\u9053\u662f\u54ea\u4e00\u500b\u5728\uff1f"),(0,i.kt)("p",null,"\u7b54\u6848\u662f\uff0c\u900f\u904e\u5b58\u53d6\u9019\u4e09\u500b\u6771\u897f\u7684\u6642\u9593\u4f86\u5206\u8fa8\uff01\u56e0\u70ba\u5728 CPU cache \u88e1\u9762\u7684\u6771\u897f\u8b80\u53d6\u4e00\u5b9a\u6bd4\u8f03\u5feb\uff0c\u6240\u4ee5\u5982\u679c\u8b80\u53d6 A \u82b1\u4e86 10ms\uff0cB \u82b1\u4e86 10ms\uff0cC \u53ea\u82b1\u4e86 1ms\uff0c\u6211\u5011\u5c31\u77e5\u9053 C \u4e00\u5b9a\u662f\u5728 CPU cache \u88e1\u9762\u3002\u9019\u7a2e\u900f\u904e\u5176\u4ed6\u7dda\u7d22\u4f86\u5f97\u77e5\u8cc7\u8a0a\u7684\u653b\u64ca\u65b9\u6cd5\uff0c\u53eb\u505a side-channel attack\uff0c\u5f9e\u5176\u4ed6\u7ba1\u9053\u4f86\u5f97\u77e5\u8cc7\u8a0a\u3002"),(0,i.kt)("p",null,"\u4e0a\u9762\u7684\u65b9\u6cd5\u6211\u5011\u662f\u900f\u904e\u6642\u9593\u4f86\u5224\u65b7\uff0c\u6240\u4ee5\u53c8\u53eb\u505a timing attack\u3002"),(0,i.kt)("p",null,"\u7d50\u5408\u4e0a\u8ff0\u77e5\u8b58\u4e4b\u5f8c\uff0c\u6211\u5011\u518d\u56de\u4f86\u770b\u4e4b\u524d\u90a3\u6bb5\u7a0b\u5f0f\u78bc\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"uint8_t arr1[16] = {1, 2, 3}; \nuint8_t arr2[256]; \nunsigned int array1_size = 16;\n\nvoid run(size_t x) {\n  if(x < array1_size) {\n    uint8_t y = array2[array1[x]];\n  }\n}\n\nsize_t x = 1;\nrun(x);\n")),(0,i.kt)("p",null,"\u5047\u8a2d\u73fe\u5728\u6211\u8dd1\u5f88\u591a\u6b21 ",(0,i.kt)("inlineCode",{parentName:"p"},"run(10)"),"\uff0cCPU \u6839\u64da branch prediction \u7684\u6a5f\u5236\uff0c\u5408\u7406\u63a8\u6e2c\u6211\u4e0b\u4e00\u6b21\u4e5f\u6703\u6eff\u8db3 if \u689d\u4ef6\uff0c\u57f7\u884c\u5230\u88e1\u9762\u7684\u7a0b\u5f0f\u78bc\u3002\u5c31\u5728\u9019\u6642\u5019\u6211\u7a81\u7136\u628a x \u8a2d\u6210 100\uff0c\u8dd1\u4e86\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"run(100)"),"\u3002"),(0,i.kt)("p",null,"\u9019\u6642\u5019 if \u88e1\u9762\u7684\u7a0b\u5f0f\u78bc\u6703\u88ab\u9810\u6e2c\u57f7\u884c\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-C"},"uint8_t y = array2[array1[100]];\n")),(0,i.kt)("p",null,"\u5047\u8a2d array1","[100]"," \u7684\u503c\u662f 38 \u597d\u4e86\uff0c\u90a3\u5c31\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"y = array2[38]"),"\uff0c\u6240\u4ee5 ",(0,i.kt)("inlineCode",{parentName:"p"},"array2[38]")," \u6703\u88ab\u653e\u5230 CPU cache \u88e1\u9762\uff0c\u589e\u9032\u4e4b\u5f8c\u8f09\u5165\u7684\u6548\u7387\u3002"),(0,i.kt)("p",null,"\u63a5\u8457\u5be6\u969b\u57f7\u884c\u5230 if condition \u767c\u73fe\u689d\u4ef6\u4e0d\u7b26\u5408\uff0c\u6240\u4ee5\u628a\u525b\u525b\u62ff\u5230\u7684\u7d50\u679c\u4e1f\u6389\uff0c\u4ec0\u9ebc\u4e8b\u90fd\u6c92\u767c\u751f\uff0cfunction \u57f7\u884c\u5b8c\u7562\u3002"),(0,i.kt)("p",null,"\u7136\u5f8c\u6211\u5011\u6839\u64da\u525b\u525b\u4e0a\u9762\u8b1b\u7684 timing attack\uff0c\u53bb\u8b80\u53d6 array2 \u7684\u6bcf\u4e00\u500b\u5143\u7d20\uff0c\u4e26\u4e14\u8a08\u7b97\u6642\u9593\uff0c\u6703\u767c\u73fe ",(0,i.kt)("inlineCode",{parentName:"p"},"array2[38]")," \u7684\u8b80\u53d6\u6642\u9593\u6700\u77ed\u3002"),(0,i.kt)("p",null,"\u9019\u6642\u5019\u6211\u5011\u5c31\u77e5\u9053\u4e86\u4e00\u4ef6\u4e8b\uff1a"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"array1","[100]"," \u7684\u5167\u5bb9\u662f 38")),(0,i.kt)("p",null,"\u4f60\u53ef\u80fd\u6703\u554f\u8aaa\uff1a\u300c\u90a3\u4f60\u77e5\u9053\u9019\u80fd\u5e79\u561b\uff1f\u300d\uff0c\u80fd\u505a\u7684\u4e8b\u60c5\u53ef\u591a\u4e86\u3002array1 \u7684\u9577\u5ea6\u53ea\u6709 16\uff0c\u6240\u4ee5\u6211\u8b80\u53d6\u5230\u7684\u503c\u4e26\u4e0d\u662f array1 \u672c\u8eab\u7684\u6771\u897f\uff0c\u800c\u662f\u5176\u4ed6\u90e8\u5206\u7684\u8a18\u61b6\u9ad4\uff0c\u662f\u6211\u4e0d\u61c9\u8a72\u5b58\u53d6\u5230\u7684\u5730\u65b9\u3002\u800c\u6211\u53ea\u8981\u4e00\u76f4\u8907\u88fd\u9019\u500b\u6a21\u5f0f\uff0c\u5c31\u80fd\u628a\u5176\u4ed6\u5730\u65b9\u7684\u8cc7\u6599\u5168\u90fd\u8b80\u51fa\u4f86\u3002"),(0,i.kt)("p",null,"\u9019\u500b\u653b\u64ca\u5982\u679c\u653e\u5728\u700f\u89bd\u5668\u4e0a\u9762\uff0c\u6211\u5c31\u80fd\u8b80\u53d6\u540c\u4e00\u500b process \u7684\u5176\u4ed6\u8cc7\u6599\uff0c\u63db\u53e5\u8a71\u8aaa\uff0c\u5982\u679c\u540c\u4e00\u500b process \u88e1\u9762\u6709\u5176\u4ed6\u7db2\u7ad9\u7684\u5167\u5bb9\uff0c\u6211\u5c31\u80fd\u8b80\u53d6\u5230\u90a3\u500b\u7db2\u7ad9\u7684\u5167\u5bb9\uff01"),(0,i.kt)("p",null,"\u9019\u5c31\u662f Spectre \u653b\u64ca\uff0c\u900f\u904e CPU \u7684\u4e00\u4e9b\u6a5f\u5236\u4f86\u9032\u884c side-channal attack\uff0c\u9032\u800c\u8b80\u53d6\u5230\u672c\u4f86\u4e0d\u8a72\u8b80\u5230\u7684\u8cc7\u6599\uff0c\u9020\u6210\u5b89\u5168\u6027\u554f\u984c\u3002"),(0,i.kt)("p",null,"\u6240\u4ee5\u7528\u4e00\u53e5\u767d\u8a71\u6587\u89e3\u91cb\uff1a\u300c\u5728\u700f\u89bd\u5668\u4e0a\u9762\uff0cSpectre \u53ef\u4ee5\u8b93\u4f60\u6709\u6a5f\u6703\u8b80\u53d6\u5230\u5176\u4ed6\u7db2\u7ad9\u7684\u8cc7\u6599\u300d\u3002"),(0,i.kt)("p",null,"\u6709\u95dc Spectre \u7684\u89e3\u91cb\u5c31\u5230\u9019\u88e1\u4e86\uff0c\u4e0a\u9762\u7c21\u5316\u4e86\u5f88\u591a\u7d30\u7bc0\uff0c\u800c\u90a3\u4e9b\u7d30\u7bc0\u6211\u5176\u5be6\u4e5f\u6c92\u6709\u5b8c\u5168\u7406\u89e3\uff0c\u60f3\u77e5\u9053\u66f4\u591a\u7684\u8a71\u53ef\u4ee5\u53c3\u8003\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://googleprojectzero.blogspot.com/2018/01/reading-privileged-memory-with-side.html"},"Reading privileged memory with a side-channel")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://zhuanlan.zhihu.com/p/32757727"},"\u89e3\u8bfb Meltdown & Spectre CPU \u6f0f\u6d1e")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://yangrz.github.io/blog/2018/01/09/cpu/"},"\u6d45\u8c08\u5904\u7406\u5668\u7ea7Spectre Attack\u53caPoc\u5206\u6790")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://www.ptt.cc/bbs/NetSecurity/M.1515146856.A.750.html"},"[\u9592\u804a] Spectre & Meltdown\u6f0f\u6d1e\u6982\u8ad6(\u7ffb\u8b6f)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/hdzitao/spectre-attack-zh"},"Spectre\u6f0f\u6d1e\u793a\u4f8b\u4ee3\u7801\u6ce8\u91ca")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://developers.google.com/web/updates/2018/02/meltdown-spectre"},"Google update: Meltdown/Spectre")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://security.googleblog.com/2018/07/mitigating-spectre-with-site-isolation.html"},"Mitigating Spectre with Site Isolation in Chrome"))),(0,i.kt)("p",null,"\u800c\u90a3\u4e9b COXX \u7684\u6771\u897f\uff0c\u76ee\u7684\u90fd\u662f\u5dee\u4e0d\u591a\u7684\uff0c\u90fd\u662f\u8981\u9632\u6b62\u4e00\u500b\u7db2\u7ad9\u80fd\u5920\u8b80\u53d6\u5230\u5176\u4ed6\u7db2\u7ad9\u7684\u8cc7\u6599\u3002\u53ea\u8981\u4e0d\u8b93\u60e1\u610f\u7db2\u7ad9\u8ddf\u76ee\u6a19\u7db2\u7ad9\u8655\u5728\u540c\u4e00\u500b process\uff0c\u9019\u985e\u578b\u7684\u653b\u64ca\u5c31\u5931\u6548\u4e86\u3002"),(0,i.kt)("p",null,"\u5f9e\u9019\u500b\u89d2\u5ea6\u51fa\u767c\uff0c\u6211\u5011\u4f86\u770b\u770b\u5404\u7a2e\u76f8\u95dc\u6a5f\u5236\u3002"),(0,i.kt)("h2",{id:"corbcross-origin-read-blocking"},"CORB\uff08Cross-Origin Read Blocking\uff09"),(0,i.kt)("p",null,"Google \u65bc Spectre \u653b\u64ca\u516c\u958b\u7684\u4e00\u500b\u6708\u5f8c\uff0c\u4e5f\u5c31\u662f 2018 \u5e74 2 \u6708\uff0c\u5728\u90e8\u843d\u683c\u4e0a\u9762\u767c\u4e86\u4e00\u7bc7\u6587\u7ae0\u8b1b\u8ff0 Chrome \u505a\u4e86\u54ea\u4e9b\u4e8b\u60c5\u4f86\u9632\u5835\u9019\u985e\u578b\u7684\u653b\u64ca\uff1a",(0,i.kt)("a",{parentName:"p",href:"https://developers.google.com/web/updates/2018/02/meltdown-spectre"},"Meltdown/Spectre"),"\u3002"),(0,i.kt)("p",null,"\u6587\u7ae0\u4e2d\u7684 Cross-Site Document Blocking \u5c31\u662f CORB \u7684\u524d\u8eab\u3002\u6839\u64da ",(0,i.kt)("a",{parentName:"p",href:"https://www.chromestatus.com/feature/5629709824032768"},"Chrome Platform Status"),"\uff0c\u5728 Chrome for desktop release 67 \u7684\u6642\u5019\u6b63\u5f0f\u9810\u8a2d\u555f\u7528\uff0c\u90a3\u6642\u5019\u5927\u6982\u662f 2018 \u5e74 5 \u6708\uff0c\u4e5f\u5dee\u4e0d\u591a\u90a3\u500b\u6642\u5019\uff0c\u88ab merge \u9032\u53bb fetch \u7684 spec\uff0c\u6210\u70ba\u898f\u683c\u7684\u4e00\u90e8\u5206\uff08",(0,i.kt)("a",{parentName:"p",href:"https://github.com/whatwg/fetch/pull/686"},"CORB: blocking of nosniff and 206 responses"),"\uff09\u3002"),(0,i.kt)("p",null,"\u524d\u9762\u6709\u63d0\u5230\u904e Spectre \u80fd\u5920\u8b80\u53d6\u5230\u540c\u4e00\u500b process \u5e95\u4e0b\u7684\u8cc7\u6599\uff0c\u6240\u4ee5\u9632\u79a6\u7684\u5176\u4e2d\u4e00\u500b\u65b9\u5f0f\u5c31\u662f\u4e0d\u8981\u8b93\u5176\u4ed6\u7db2\u7ad9\u7684\u8cc7\u6599\u51fa\u73fe\u5728\u540c\u4e00\u500b process \u5e95\u4e0b\u3002"),(0,i.kt)("p",null,"\u4e00\u500b\u7db2\u7ad9\u6709\u8a31\u591a\u65b9\u5f0f\u53ef\u4ee5\u628a\u8de8\u4f86\u6e90\u7684\u8cc7\u6e90\u8a2d\u6cd5\u5f04\u9032\u4f86\uff0c\u4f8b\u5982\u8aaa ",(0,i.kt)("inlineCode",{parentName:"p"},"fetch")," \u6216\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"xhr"),"\uff0c\u4f46\u9019\u5169\u7a2e\u5df2\u7d93\u88ab CORS \u7d66\u63a7\u7ba1\u4f4f\u4e86\uff0c\u800c\u4e14\u62ff\u5230\u7684 response \u61c9\u8a72\u662f\u5b58\u5728 network \u76f8\u95dc\u7684 process \u800c\u4e0d\u662f\u7db2\u7ad9\u672c\u8eab\u7684 process\uff0c\u6240\u4ee5\u5c31\u7b97\u7528 Spectre \u4e5f\u8b80\u4e0d\u5230\u3002"),(0,i.kt)("p",null,"\u4f46\u662f\u5462\uff0c\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"<img>")," \u6216\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"<script>")," \u9019\u4e9b\u6a19\u7c64\u4e5f\u53ef\u4ee5\u8f15\u6613\u5730\u628a\u5176\u4ed6\u7db2\u7ad9\u7684\u8cc7\u6e90\u8f09\u5165\u3002\u4f8b\u5982\u8aaa\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},'<img src="https://bank.com/secret.json">'),"\uff0c\u5047\u8a2d ",(0,i.kt)("inlineCode",{parentName:"p"},"secret.json")," \u662f\u500b\u6a5f\u5bc6\u7684\u8cc7\u6599\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u628a\u9019\u500b\u6a5f\u5bc6\u7684\u8cc7\u6599\u7d66\u300c\u8f09\u5165\u300d\u3002"),(0,i.kt)("p",null,"\u4f60\u53ef\u80fd\u6703\u597d\u5947\u8aaa\uff1a\u300c\u9019\u6a23\u505a\u6709\u4ec0\u9ebc\u7528\uff1f\u90a3\u53c8\u4e0d\u662f\u4e00\u5f35\u5716\u7247\uff0c\u800c\u4e14\u6211\u7528 JavaScript \u4e5f\u8b80\u53d6\u4e0d\u5230\u300d\u3002\u6c92\u932f\uff0c\u9019\u4e0d\u662f\u4e00\u5f35\u5716\u7247\uff0c\u4f46\u4ee5 Chrome \u7684\u904b\u4f5c\u6a5f\u5236\u4f86\u8aaa\uff0cChrome \u5728\u4e0b\u8f09\u4e4b\u524d\u4e0d\u77e5\u9053\u5b83\u4e0d\u662f\u5716\u7247\uff08\u6709\u53ef\u80fd\u526f\u6a94\u540d\u662f .json \u4f46\u5176\u5be6\u662f\u5716\u7247\u5c0d\u5427\uff09\uff0c\u56e0\u6b64\u6703\u5148\u4e0b\u8f09\uff0c\u4e0b\u8f09\u4e4b\u5f8c\u628a\u7d50\u679c\u4e1f\u9032 render process\uff0c\u9019\u6642\u5019\u624d\u6703\u77e5\u9053\u9019\u4e0d\u662f\u4e00\u5f35\u5716\u7247\uff0c\u7136\u5f8c\u5f15\u767c\u8f09\u5165\u932f\u8aa4\u3002"),(0,i.kt)("p",null,"\u770b\u8d77\u4f86\u6c92\u4ec0\u9ebc\u554f\u984c\uff0c\u4f46\u5225\u5fd8\u4e86 Spectre \u958b\u555f\u4e86\u4e00\u6247\u65b0\u7684\u7a97\uff0c\u90a3\u5c31\u662f\u300c\u53ea\u8981\u5728\u540c\u4e00\u500b process \u7684\u8cc7\u6599\u90fd\u6709\u6a5f\u6703\u8b80\u53d6\u5230\u300d\u3002\u56e0\u6b64\u5149\u662f\u300c\u628a\u7d50\u679c\u4e1f\u9032 render process\u300d\u9019\u4ef6\u4e8b\u60c5\u90fd\u4e0d\u884c\uff0c\u56e0\u70ba\u900f\u904e Spectre \u653b\u64ca\uff0c\u653b\u64ca\u8005\u9084\u662f\u62ff\u5f97\u5230\u5b58\u5728\u8a18\u61b6\u9ad4\u88e1\u9762\u7684\u8cc7\u6599\u3002"),(0,i.kt)("p",null,"\u56e0\u6b64 CORB \u9019\u500b\u6a5f\u5236\u7684\u76ee\u7684\u5c31\u662f\uff1a"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u5982\u679c\u4f60\u60f3\u8b80\u7684\u8cc7\u6599\u985e\u578b\u6839\u672c\u4e0d\u5408\u7406\uff0c\u90a3\u6839\u672c\u4e0d\u9700\u8981\u8b80\u5230 render process\uff0c\u76f4\u63a5\u628a\u7d50\u679c\u4e1f\u6389\u5c31\u597d\uff01")),(0,i.kt)("p",null,"\u5ef6\u7e8c\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u90a3\u500b JSON \u6a94\u6848\u7684 MIME type \u5982\u679c\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"application/json"),"\uff0c\u4ee3\u8868\u5b83\u7d55\u5c0d\u4e0d\u6703\u662f\u4e00\u5f35\u5716\u7247\uff0c\u56e0\u6b64\u4e5f\u4e0d\u53ef\u80fd\u653e\u5230 img \u6a19\u7c64\u88e1\u9762\uff0c\u9019\u5c31\u662f\u6211\u6240\u8aaa\u7684\u300c\u8b80\u7684\u8cc7\u6599\u985e\u578b\u4e0d\u5408\u7406\u300d\u3002"),(0,i.kt)("p",null,"CORB \u4e3b\u8981\u4fdd\u8b77\u7684\u8cc7\u6599\u985e\u578b\u6709\u4e09\u7a2e\uff1aHTML\u3001XML \u8ddf JSON\uff0c\u90a3\u700f\u89bd\u5668\u8981\u600e\u9ebc\u77e5\u9053\u662f\u9019\u4e09\u7a2e\u985e\u578b\u5462\uff1f\u4e0d\u5982\u5c31\u5f9e response header \u7684 content type \u5224\u65b7\u5427\uff1f"),(0,i.kt)("p",null,"\u5f88\u907a\u61be\uff0c\u6c92\u8fa6\u6cd5\u3002\u539f\u56e0\u662f\u6709\u5f88\u591a\u7db2\u7ad9\u7684 content type \u662f\u8a2d\u5b9a\u932f\u8aa4\u7684\uff0c\u6709\u53ef\u80fd\u660e\u660e\u5c31\u662f JavaScript \u6a94\u6848\u537b\u8a2d\u6210 ",(0,i.kt)("inlineCode",{parentName:"p"},"text/html"),"\uff0c\u5c31\u6703\u88ab CORB \u64cb\u4f4f\uff0c\u7db2\u7ad9\u5c31\u6703\u58de\u6389\u3002"),(0,i.kt)("p",null,"\u56e0\u6b64 Chrome \u6703\u6839\u64da\u5167\u5bb9\u4f86\u63a2\u6e2c\uff08",(0,i.kt)("a",{parentName:"p",href:"https://mimesniff.spec.whatwg.org/"},"sniffing"),"\uff09\u6a94\u6848\u985e\u578b\u662f\u4ec0\u9ebc\uff0c\u518d\u6c7a\u5b9a\u8981\u4e0d\u8981\u5957\u7528 CORB\u3002"),(0,i.kt)("p",null,"\u4f46\u9019\u5176\u5be6\u4e5f\u6709\u8aa4\u5224\u7684\u53ef\u80fd\uff0c\u6240\u4ee5\u5982\u679c\u4f60\u7684\u4f3a\u670d\u5668\u7d66\u7684 content type \u90fd\u78ba\u5b9a\u662f\u6b63\u78ba\u7684\uff0c\u53ef\u4ee5\u50b3\u4e00\u500b response header \u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"X-Content-Type-Options: nosniff"),"\uff0cChrome \u5c31\u6703\u76f4\u63a5\u7528\u4f60\u7d66\u7684 content type \u800c\u4e0d\u662f\u81ea\u5df1\u63a2\u6e2c\u3002"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"CORB \u7684\u932f\u8aa4\u756b\u9762",src:n(4158).Z,width:"896",height:"98"})),(0,i.kt)("p",null,"\u7e3d\u7d50\u4e00\u4e0b\uff0cCORB \u662f\u500b\u5df2\u7d93\u9810\u8a2d\u5728 Chrome \u88e1\u7684\u6a5f\u5236\uff0c\u6703\u81ea\u52d5\u963b\u64cb\u4e0d\u5408\u7406\u7684\u8de8\u4f86\u6e90\u8cc7\u6e90\u8f09\u5165\uff0c\u50cf\u662f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"<img>")," \u4f86\u8f09\u5165 JSON \u6216\u662f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"<script>")," \u8f09\u5165 HTML \u7b49\u7b49\u3002"),(0,i.kt)("p",null,"\u66f4\u8a73\u7d30\u7684\u89e3\u91cb\u53ef\u4ee5\u53c3\u8003\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://www.chromium.org/Home/chromium-security/corb-for-developers"},"Cross-Origin Read Blocking for Web Developers")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://chromium.googlesource.com/chromium/src/+/master/services/network/cross_origin_read_blocking_explainer.md"},"Cross-Origin Read Blocking (CORB)"))),(0,i.kt)("h2",{id:"corpcross-origin-resource-policy"},"CORP\uff08Cross-Origin Resource Policy\uff09"),(0,i.kt)("p",null,"CORB \u662f\u700f\u89bd\u5668\u5167\u5efa\u7684\u6a5f\u5236\uff0c\u81ea\u52d5\u4fdd\u8b77\u4e86 HTML\u3001XML \u8207 JSON\uff0c\u4e0d\u8b93\u4ed6\u5011\u88ab\u8f09\u5165\u5230\u8de8\u4f86\u6e90\u7684 render process \u88e1\u9762\uff0c\u5c31\u4e0d\u6703\u88ab Spectre \u653b\u64ca\u3002\u4f46\u662f\u5176\u4ed6\u8cc7\u6e90\u5462\uff1f\u5982\u679c\u5176\u4ed6\u985e\u578b\u7684\u8cc7\u6e90\uff0c\u4f8b\u5982\u8aaa\u6709\u4e9b\u7167\u7247\u8ddf\u5f71\u7247\u53ef\u80fd\u4e5f\u662f\u6a5f\u5bc6\u8cc7\u6599\uff0c\u6211\u53ef\u4ee5\u4fdd\u8b77\u4ed6\u5011\u55ce\uff1f"),(0,i.kt)("p",null,"\u9019\u5c31\u662f CORP \u9019\u500b HTTP response header \u7684\u529f\u80fd\u3002CORP \u7684\u524d\u8eab\u53eb\u505a From-Origin\uff0c\u4e0b\u9762\u5f15\u7528\u4e00\u6bb5\u4f86\u81ea ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/whatwg/fetch/issues/687"},"Cross-Origin-Resource-Policy (was: From-Origin) #687")," \u7684\u6558\u8ff0\uff1a"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Cross-Origin Read Blocking (CORB) automatically protects against Spectre attacks that load cross-origin, cross-type HTML, XML, and JSON resources, and is based on the browser\u2019s ability to distinguish resource types. We think CORB is a good idea. From-Origin would offer servers an opt-in protection beyond CORB.")),(0,i.kt)("p",null,"\u5982\u679c\u4f60\u81ea\u5df1\u77e5\u9053\u8a72\u4fdd\u8b77\u54ea\u4e9b\u8cc7\u6e90\uff0c\u90a3\u5c31\u53ef\u4ee5\u7528 CORP \u9019\u500b header\uff0c\u6307\u5b9a\u9019\u4e9b\u8cc7\u6e90\u53ea\u80fd\u88ab\u54ea\u4e9b\u4f86\u6e90\u8f09\u5165\u3002CORP \u7684\u5167\u5bb9\u6709\u4e09\u7a2e\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"same-site"),(0,i.kt)("li",{parentName:"ol"},"same-origin"),(0,i.kt)("li",{parentName:"ol"},"cross-origin")),(0,i.kt)("p",null,"\u7b2c\u4e09\u7a2e\u7684\u8a71\u5c31\u8ddf\u6c92\u6709\u8a2d\u5b9a\u662f\u5dee\u4e0d\u591a\u7684\uff08\u4f46\u5176\u5be6\u8ddf\u6c92\u8a2d\u9084\u662f\u6709\u5dee\uff0c\u4e4b\u5f8c\u6703\u89e3\u91cb\uff09\uff0c\u5c31\u662f\u6240\u6709\u7684\u8de8\u4f86\u6e90\u90fd\u53ef\u4ee5\u8f09\u5165\u8cc7\u6e90\u3002\u63a5\u4e0b\u4f86\u6211\u5011\u5be6\u969b\u4f86\u770b\u770b\u8a2d\u5b9a\u9019\u500b\u4e4b\u5f8c\u6703\u600e\u6a23\u5427\uff01"),(0,i.kt)("p",null,"\u6211\u5011\u5148\u7528 express \u8dd1\u4e00\u500b\u7c21\u55ae\u7684 server\uff0c\u52a0\u4e0a CORP \u7684 header \u7136\u5f8c\u653e\u4e00\u5f35\u5716\u7247\uff0c\u5716\u7247\u7db2\u5740\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"http://b.example.com/logo.jpg"),"\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"app.use((req, res, next) => {\n  res.header('Cross-Origin-Resource-Policy', 'same-origin')\n  next()\n})\napp.use(express.static('public'));\n")),(0,i.kt)("p",null,"\u63a5\u8457\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"http://a.example.com")," \u5f15\u5165\u9019\u5f35\u5716\u7247\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<img src="http://b.example.com/logo.jpg" />\n')),(0,i.kt)("p",null,"\u91cd\u65b0\u6574\u7406\u6253\u958b console\uff0c\u5c31\u6703\u770b\u5230\u5716\u7247\u7121\u6cd5\u8f09\u5165\u7684\u932f\u8aa4\u8a0a\u606f\uff0c\u6253\u958b network tab \u9084\u6703\u8a73\u7d30\u89e3\u91cb\u539f\u56e0\uff1a"),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(6172).Z,width:"1110",height:"574"})),(0,i.kt)("p",null,"\u5982\u679c\u628a header \u6539\u6210 ",(0,i.kt)("inlineCode",{parentName:"p"},"same-site")," \u6216\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"cross-origin"),"\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u5716\u7247\u88ab\u6b63\u78ba\u8f09\u5165\u3002"),(0,i.kt)("p",null,"\u6240\u4ee5\u9019\u500b header \u5176\u5be6\u5c31\u662f\u300c\u8cc7\u6e90\u7248\u7684 CORS\u300d\uff0c\u539f\u672c\u7684 CORS \u6bd4\u8f03\u50cf\u662f API \u6216\u662f\u300c\u8cc7\u6599\u300d\u9593\u5b58\u53d6\u7684\u5354\u8b70\uff0c\u8b93\u8de8\u4f86\u6e90\u5b58\u53d6\u8cc7\u6599\u9700\u8981\u8a31\u53ef\u3002\u800c\u8cc7\u6e90\u7684\u8f09\u5165\u4f8b\u5982\u8aaa\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"<img>")," \u6216\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"<script>"),"\uff0c\u60f3\u8981\u963b\u6b62\u8de8\u4f86\u6e90\u8f09\u5165\u7684\u8a71\uff0c\u539f\u672c\u53ea\u80fd\u900f\u904e server side \u81ea\u884c\u53bb\u5224\u65b7 ",(0,i.kt)("inlineCode",{parentName:"p"},"Origin")," \u6216\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"Referer")," \u4e4b\u985e\u7684\u503c\uff0c\u52d5\u614b\u6c7a\u5b9a\u662f\u5426\u56de\u50b3\u8cc7\u6599\u3002"),(0,i.kt)("p",null,"\u800c CORP \u9019\u500b header \u51fa\u73fe\u4e4b\u5f8c\uff0c\u63d0\u4f9b\u4e86\u963b\u6b62\u300c\u4efb\u4f55\u8de8\u4f86\u6e90\u8f09\u5165\u300d\u7684\u65b9\u6cd5\uff0c\u53ea\u8981\u8a2d\u5b9a\u4e00\u500b header \u5c31\u884c\u4e86\u3002\u6240\u4ee5\u9019\u4e0d\u53ea\u662f\u5b89\u5168\u6027\u7684\u8003\u91cf\u800c\u5df2\uff0c\u5b89\u5168\u6027\u53ea\u662f\u5176\u4e2d\u4e00\u9ede\uff0c\u91cd\u9ede\u662f\u4f60\u53ef\u4ee5\u963b\u6b62\u5225\u4eba\u8f09\u5165\u4f60\u7684\u8cc7\u6e90\u3002"),(0,i.kt)("p",null,"\u5c31\u5982\u540c CORP \u7684\u524d\u8eab From-Origin \u7684 ",(0,i.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/from-origin/"},"spec")," \u6240\u5beb\u5230\u7684\uff1a"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"The Web platform has no limitations on embedding resources from different origins currently. E.g. an HTML document on ",(0,i.kt)("a",{parentName:"p",href:"http://example.org"},"http://example.org")," can embed an image from ",(0,i.kt)("a",{parentName:"p",href:"http://corp.invalid"},"http://corp.invalid")," without issue. This has led to a number of problems:")),(0,i.kt)("p",null,"\u5c0d\u65bc\u9019\u7a2e embedded resource\uff0c\u57fa\u672c\u4e0a Web \u6c92\u6709\u4efb\u4f55\u9650\u5236\uff0c\u60f3\u8f09\u5165\u4ec0\u9ebc\u5c31\u8f09\u5165\u4ec0\u9ebc\uff0c\u96d6\u7136\u65b9\u4fbf\u4f46\u4e5f\u6703\u9020\u6210\u4e00\u4e9b\u554f\u984c\uff0c\u50cf\u662f\uff1a"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Inline linking \u2014 the practice of embedding resources (e.g. images or fonts) from another server, causing the owner of that server to get a higher hosting bill."),(0,i.kt)("p",{parentName:"blockquote"},"Clickjacking \u2014 embedding a resource from another origin and attempting to let the visitor click on a concealed link thereof, causing harm to the visitor.")),(0,i.kt)("p",null,"\u4f8b\u5982\u8aaa\u5728\u6211\u7684\u90e8\u843d\u683c\u76f4\u63a5\u9023\u5230\u5225\u4eba\u5bb6\u7684\u5716\u7247\uff0c\u9019\u6a23\u6d41\u91cf\u5c31\u662f\u5225\u4eba\u5bb6 server \u7684\uff0c\u5e33\u55ae\u4e5f\u662f\u4ed6\u8981\u4ed8\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u4e5f\u6703\u6709 Clickjacking \u7684\u554f\u984c\u3002"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Privacy leakage \u2014 sometimes resource availability depends on whether a visitor is signed in to a particular website. E.g. only with a I'm-signed-in-cookie will an image be returned, and if there is no such cookie an HTML document. An HTML document embedding such a resource (requested with the user's credentials) can figure out the existence of that resource and thus whether the visitor is signed in and therefore has an account with a particular service.")),(0,i.kt)("p",null,"\u5728\u96b1\u79c1\u90e8\u5206\u4e5f\u6709\u4e00\u4e9b\u554f\u984c\uff0c\u4f8b\u5982\u8aaa\u6709\u500b\u7db2\u7ad9\u53ef\u4ee5\u5f97\u77e5\u4f60\u5728\u5176\u4ed6\u7db2\u7ad9\u662f\u4e0d\u662f\u767b\u5165\u72c0\u614b\uff08\u4e4b\u5f8c\u6703\u4ecb\u7d39\u5230\uff09\u3002"),(0,i.kt)("p",null,"\u90a3\u5b83\u600e\u9ebc\u77e5\u9053\u7684\u5462\uff1f\u56e0\u70ba\u6709\u4e9b\u8cc7\u6e90\u53ef\u80fd\u53ea\u6709\u5728\u767b\u5165\u7684\u6642\u5019\u6709\u6b0a\u9650\u5b58\u53d6\u3002\u5047\u8a2d\u67d0\u500b\u5716\u7247\u7db2\u5740\u53ea\u6709\u767b\u5165\u72c0\u614b\u4e0b\u6703\u6b63\u78ba\u56de\u50b3\u5716\u7247\uff0c\u6c92\u767b\u5165\u7684\u8a71\u5c31\u6703\u56de\u50b3 server error\uff0c\u90a3\u6211\u53ea\u8981\u9019\u6a23\u5beb\u5c31\u597d\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},"<img src=xxx onerror=\"alert('not login')\" onload=\"alert('login')\">\n")),(0,i.kt)("p",null,"\u900f\u904e\u5716\u7247\u662f\u5426\u8f09\u5165\u6210\u529f\uff0c\u5c31\u77e5\u9053\u4f60\u662f\u5426\u767b\u5165\u3002"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"License checking \u2014 certain font licenses require that the font be prevented from being embedded on other origins.")),(0,i.kt)("p",null,"\u5b57\u578b\u7db2\u7ad9\u6703\u963b\u6b62\u6c92\u6709 license \u7684\u4f7f\u7528\u8005\u8f09\u5165\u5b57\u578b\uff0c\u9019\u7a2e\u72c0\u6cc1\u4e5f\u5f88\u9069\u5408\u7528\u9019\u500b header\u3002"),(0,i.kt)("p",null,"\u7e3d\u800c\u8a00\u4e4b\u5462\uff0c\u524d\u9762\u4ecb\u7d39\u7684 CORB \u53ea\u662f\u300c\u963b\u6b62\u4e0d\u5408\u7406\u7684\u8b80\u53d6\u300d\uff0c\u4f8b\u5982\u8aaa\u7528 img \u8f09\u5165 HTML\uff0c\u9019\u7d14\u7cb9\u662f\u70ba\u4e86\u5b89\u5168\u6027\u8003\u91cf\u800c\u5df2\u3002"),(0,i.kt)("p",null,"\u4f46\u662f CORP \u5247\u662f\u53ef\u4ee5\u963b\u6b62\u4efb\u4f55\u7684\u8b80\u53d6\uff08\u9664\u4e86 iframe\uff0c\u5c0d iframe \u6c92\u4f5c\u7528\uff09\uff0c\u53ef\u4ee5\u4fdd\u8b77\u4f60\u7db2\u7ad9\u7684\u8cc7\u6e90\u4e0d\u88ab\u5176\u4ed6\u4eba\u8f09\u5165\uff0c\u662f\u529f\u80fd\u66f4\u5f37\u5927\u800c\u4e14\u61c9\u7528\u66f4\u5ee3\u6cdb\u7684\u4e00\u500b header\u3002"),(0,i.kt)("p",null,"\u73fe\u5728\u4e3b\u6d41\u7684\u700f\u89bd\u5668\u90fd\u5df2\u7d93\u652f\u63f4\u9019\u500b header \u4e86\u3002"),(0,i.kt)("h2",{id:"site-isolation"},"Site Isolation"),(0,i.kt)("p",null,"\u8981\u9632\u6b62 Spectre \u653b\u64ca\uff0c\u6709\u5169\u689d\u8def\u7dda\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u4e0d\u8b93\u653b\u64ca\u8005\u6709\u6a5f\u6703\u57f7\u884c Spectre \u653b\u64ca"),(0,i.kt)("li",{parentName:"ol"},"\u5c31\u7b97\u57f7\u884c\u653b\u64ca\uff0c\u4e5f\u62ff\u4e0d\u5230\u60f3\u8981\u7684\u8cc7\u8a0a")),(0,i.kt)("p",null,"\u524d\u9762\u6709\u63d0\u904e Spectre \u653b\u64ca\u7684\u539f\u7406\uff0c\u900f\u904e\u8b80\u53d6\u8cc7\u6599\u7684\u6642\u9593\u5dee\u5f97\u77e5\u54ea\u4e00\u500b\u8cc7\u6599\u88ab\u653e\u5230 cache \u88e1\u9762\uff0c\u5c31\u53ef\u4ee5\u5f9e\u8a18\u61b6\u9ad4\u88e1\u9762\u300c\u5077\u300d\u8cc7\u6599\u51fa\u4f86\u3002\u90a3\u5982\u679c\u700f\u89bd\u5668\u4e0a\u9762\u63d0\u4f9b\u7684\u8a08\u6642\u5668\u6642\u9593\u6545\u610f\u4e0d\u7cbe\u6e96\u7684\u8a71\uff0c\u4e0d\u5c31\u53ef\u4ee5\u9632\u79a6\u4e86\u55ce\uff1f\u56e0\u70ba\u653b\u64ca\u8005\u7b97\u51fa\u4f86\u7684\u79d2\u6578\u6703\u5dee\u4e0d\u591a\uff0c\u6839\u672c\u4e0d\u77e5\u9053\u54ea\u4e00\u500b\u8b80\u53d6\u6bd4\u8f03\u5feb\u3002"),(0,i.kt)("p",null,"Spectre \u653b\u64ca\u51fa\u73fe\u4e4b\u5f8c\u700f\u89bd\u5668\u505a\u4e86\u5169\u4ef6\u4e8b\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u964d\u4f4e ",(0,i.kt)("inlineCode",{parentName:"li"},"performance.now")," \u7684\u7cbe\u6e96\u5ea6"),(0,i.kt)("li",{parentName:"ol"},"\u505c\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"SharedArrayBuffer"))),(0,i.kt)("p",null,"\u7b2c\u4e00\u9ede\u5f88\u597d\u7406\u89e3\uff0c\u964d\u4f4e\u62ff\u6642\u9593\u51fd\u5f0f\u7684\u7cbe\u6e96\u5ea6\uff0c\u5c31\u53ef\u4ee5\u8b93\u653b\u64ca\u8005\u7121\u6cd5\u5224\u65b7\u6b63\u78ba\u7684\u8b80\u53d6\u901f\u5ea6\u3002\u90a3\u7b2c\u4e8c\u9ede\u662f\u70ba\u4ec0\u9ebc\u5462\uff1f"),(0,i.kt)("p",null,"\u5148\u8b1b\u4e00\u4e0b ",(0,i.kt)("inlineCode",{parentName:"p"},"SharedArrayBuffer")," \u9019\u6771\u897f\u597d\u4e86\uff0c\u9019\u6771\u897f\u53ef\u4ee5\u8b93\u4f60 document \u7684 JavaScript \u8ddf web worker \u5171\u7528\u540c\u4e00\u584a\u8a18\u61b6\u9ad4\uff0c\u5171\u4eab\u8cc7\u6599\u3002\u6240\u4ee5\u5728 web worker \u88e1\u9762\u4f60\u53ef\u4ee5\u505a\u4e00\u500b counter \u4e00\u76f4\u7d2f\u52a0\uff0c\u7136\u5f8c\u5728 JavaScript \u88e1\u9762\u8b80\u53d6\u9019\u500b counter\uff0c\u5c31\u9054\u6210\u4e86\u8a08\u6642\u5668\u7684\u529f\u80fd\u3002"),(0,i.kt)("p",null,"\u6240\u4ee5 Spectre \u51fa\u73fe\u4e4b\u5f8c\uff0c\u700f\u89bd\u5668\u5c31\u505a\u4e86\u9019\u5169\u500b\u8abf\u6574\uff0c\u5f9e\u300c\u9632\u6b62\u653b\u64ca\u6e90\u982d\u300d\u7684\u89d2\u5ea6\u4e0b\u624b\uff0c\u9019\u662f\u7b2c\u4e00\u689d\u8def\u3002"),(0,i.kt)("p",null,"\u800c\u53e6\u4e00\u689d\u8def\u5247\u662f\u4e0d\u8b93\u60e1\u610f\u7db2\u7ad9\u62ff\u5230\u8de8\u4f86\u6e90\u7db2\u7ad9\u7684\u8cc7\u8a0a\uff0c\u5c31\u662f\u524d\u9762\u6240\u63d0\u5230\u7684 CORB\uff0c\u4ee5\u53ca\u73fe\u5728\u8981\u4ecb\u7d39\u7684\uff1aSite Isolation\u3002"),(0,i.kt)("p",null,"\u9019\u500b\u540d\u8a5e\u5728\u4e4b\u524d\u7684\u300c\u700f\u89bd\u5668\u7684\u5b89\u5168\u6a21\u578b\u300d\u88e1\u9762\u6709\u7a0d\u5fae\u63d0\u904e\uff0c\u5148\u4f86\u4e00\u6bb5 ",(0,i.kt)("a",{parentName:"p",href:"https://developers.google.com/web/updates/2018/07/site-isolation"},"Site Isolation for web developers")," \u7684\u4ecb\u7d39\uff1a"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Site Isolation is a security feature in Chrome that offers an additional line of defense to make such attacks less likely to succeed. It ensures that pages from different websites are always put into different processes, each running in a sandbox that limits what the process is allowed to do. It also blocks the process from receiving certain types of sensitive data from other sites")),(0,i.kt)("p",null,"\u7c21\u55ae\u4f86\u8aaa\u5462\uff0cSite Isolation \u6703\u78ba\u4fdd\u4f86\u81ea\u4e0d\u540c\u7db2\u7ad9\u7684\u8cc7\u6e90\u6703\u653e\u5728\u4e0d\u540c\u7684 process\uff0c\u6240\u4ee5\u5c31\u7b97\u5728\u81ea\u5df1\u7684\u7db2\u7ad9\u57f7\u884c\u4e86 Spectre \u653b\u64ca\u4e5f\u6c92\u95dc\u4fc2\uff0c\u56e0\u70ba\u8b80\u4e0d\u5230\u5176\u4ed6\u7db2\u7ad9\u7684\u8cc7\u6599\u3002"),(0,i.kt)("p",null,"Site Isolation \u76ee\u524d\u5728 Chrome \u662f\u9810\u8a2d\u555f\u7528\u7684\u72c0\u614b\uff0c\u76f8\u5c0d\u61c9\u7684\u7f3a\u9ede\u662f\u4f7f\u7528\u7684\u8a18\u61b6\u9ad4\u6703\u8b8a\u591a\uff0c\u56e0\u70ba\u958b\u4e86\u66f4\u591a\u7684 process\uff0c\u5176\u4ed6\u7684\u5f71\u97ff\u53ef\u4ee5\u53c3\u8003\u4e0a\u9762\u90a3\u7bc7\u6587\u7ae0\u3002"),(0,i.kt)("p",null,"\u800c\u9664\u4e86 Site Isolation \u4e4b\u5916\uff0c\u9084\u6709\u53e6\u5916\u4e00\u500b\u5f88\u5bb9\u6613\u641e\u6df7\u7684\u6771\u897f\uff0c\u53eb\u505a\uff1a\u300ccross-origin isolated state\u300d\u3002"),(0,i.kt)("p",null,"\u9019\u5169\u8005\u7684\u5dee\u5225\u5728\u54ea\u88e1\u5462\uff1f\u6839\u64da\u6211\u81ea\u5df1\u7684\u7406\u89e3\uff0c\u5728 ",(0,i.kt)("a",{parentName:"p",href:"https://security.googleblog.com/2018/07/mitigating-spectre-with-site-isolation.html"},"Mitigating Spectre with Site Isolation in Chrome")," \u9019\u7bc7\u6587\u7ae0\u4e2d\u6709\u63d0\u5230\uff1a"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},'Note that Chrome uses a specific definition of "site" that includes just the scheme and registered domain. Thus, ',(0,i.kt)("a",{parentName:"p",href:"https://google.co.uk"},"https://google.co.uk")," would be a site, and subdomains like ",(0,i.kt)("a",{parentName:"p",href:"https://maps.google.co.uk"},"https://maps.google.co.uk")," would stay in the same process.")),(0,i.kt)("p",null,"Site Isolation \u7684\u300cSite\u300d\u7684\u5b9a\u7fa9\u5c31\u8ddf same site \u4e00\u6a23\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"http://a.example.com")," \u8ddf ",(0,i.kt)("inlineCode",{parentName:"p"},"http://b.example.com")," \u662f same site\uff0c\u6240\u4ee5\u5118\u7ba1\u5728 Site Isolation \u7684\u72c0\u6cc1\u4e0b\uff0c\u9019\u5169\u500b\u7db2\u9801\u9084\u662f\u6703\u88ab\u653e\u5728\u540c\u4e00\u500b process \u88e1\u9762\u3002"),(0,i.kt)("p",null,"\u800c cross-origin isolated state \u61c9\u8a72\u662f\u4e00\u7a2e\u66f4\u5f37\u7684\u9694\u96e2\uff0c\u53ea\u8981\u4e0d\u662f same origin \u5c31\u9694\u96e2\u958b\u4f86\uff0c\u5c31\u7b97\u662f same site \u4e5f\u4e00\u6a23\u3002\u56e0\u6b64 ",(0,i.kt)("inlineCode",{parentName:"p"},"http://a.example.com")," \u8ddf ",(0,i.kt)("inlineCode",{parentName:"p"},"http://b.example.com")," \u662f\u6703\u88ab\u9694\u96e2\u958b\u4f86\u7684\u3002\u800c\u4e14 Site Isolation \u9694\u96e2\u7684\u5c0d\u8c61\u662f process\uff0ccross-origin isolated \u770b\u8d77\u4f86\u662f\u9694\u96e2 browsing context group\uff0c\u4e0d\u8b93\u8de8\u4f86\u6e90\u7684\u6771\u897f\u8655\u5728\u540c\u4e00\u500b browsing context group\u3002"),(0,i.kt)("p",null,"\u800c\u9019\u500b cross-origin isolated state \u4e26\u4e0d\u662f\u9810\u8a2d\u7684\uff0c\u5fc5\u9808\u5728\u7db2\u9801\u4e0a\u8a2d\u7f6e\u9019\u5169\u500b header \u624d\u80fd\u555f\u7528\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Cross-Origin-Embedder-Policy: require-corp"),(0,i.kt)("li",{parentName:"ol"},"Cross-Origin-Opener-Policy: same-origin")),(0,i.kt)("p",null,"\u81f3\u65bc\u70ba\u4ec0\u9ebc\u662f\u9019\u5169\u500b\uff0c\u5f85\u6703\u544a\u8a34\u4f60\u3002"),(0,i.kt)("h2",{id:"coepcross-origin-embedder-policy"},"COEP\uff08Cross-Origin-Embedder-Policy\uff09"),(0,i.kt)("p",null,"\u8981\u9054\u6210 cross-origin isolated state \u7684\u8a71\uff0c\u5fc5\u9808\u4fdd\u8b49\u4f60\u5c0d\u65bc\u81ea\u5df1\u7db2\u7ad9\u4e0a\u6240\u6709\u7684\u8de8\u4f86\u6e90\u5b58\u53d6\uff0c\u90fd\u662f\u5408\u6cd5\u7684\u4e26\u4e14\u6709\u6b0a\u9650\u7684\u3002"),(0,i.kt)("p",null,"COEP\uff08Cross-Origin-Embedder-Policy\uff09\u9019\u500b header \u6709\u5169\u500b\u503c\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"unsafe-none"),(0,i.kt)("li",{parentName:"ol"},"require-corp")),(0,i.kt)("p",null,"\u7b2c\u4e00\u500b\u662f\u9810\u8a2d\u503c\uff0c\u5c31\u662f\u6c92\u6709\u4efb\u4f55\u9650\u5236\uff0c\u7b2c\u4e8c\u500b\u5247\u662f\u8ddf\u6211\u5011\u524d\u9762\u63d0\u5230\u7684 CORP(Cross-Origin-Resource-Policy) \u6709\u95dc\uff0c\u5982\u679c\u7528\u4e86\u9019\u500b require-corp \u7684\u8a71\uff0c\u5c31\u4ee3\u8868\u544a\u8a34\u700f\u89bd\u5668\u8aaa\uff1a\u300c\u9801\u9762\u4e0a\u6240\u6709\u6211\u8f09\u5165\u7684\u8cc7\u6e90\uff0c\u90fd\u5fc5\u9808\u6709 CORP \u9019\u500b header \u7684\u5b58\u5728\uff08\u6216\u662f CORS\uff09\uff0c\u800c\u4e14\u662f\u5408\u6cd5\u7684\u300d"),(0,i.kt)("p",null,"\u73fe\u5728\u5047\u8a2d\u6211\u5011\u6709\u500b\u7db2\u7ad9 ",(0,i.kt)("inlineCode",{parentName:"p"},"a.example.com"),"\uff0c\u6211\u5011\u60f3\u8b93\u5b83\u8b8a\u6210 cross-rogin isolated state\uff0c\u56e0\u6b64\u5e6b\u4ed6\u52a0\u4e0a\u4e00\u500b header\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"Cross-Origin-Embedder-Policy: require-corp"),"\uff0c\u7136\u5f8c\u7db2\u9801\u88e1\u9762\u5f15\u5165\u4e00\u500b\u8cc7\u6e90\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<img src="http://b.example.com/logo.jpg">\n')),(0,i.kt)("p",null,"\u63a5\u8457\u6211\u5011\u5728 b \u90a3\u908a\u50b3\u9001\u6b63\u78ba\u7684 header\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"app.use((req, res, next) => {\n  res.header('Cross-Origin-Resource-Policy', 'cross-origin')\n  next()\n})\n")),(0,i.kt)("p",null,"\u5982\u6b64\u4e00\u4f86\u5c31\u9054\u6210\u4e86\u7b2c\u4e00\u6b65\u3002"),(0,i.kt)("p",null,"\u53e6\u5916\uff0c\u524d\u9762\u6211\u6709\u8b1b\u904e CORP \u6c92\u6709\u8a2d\u8ddf\u8a2d\u5b9a\u6210 ",(0,i.kt)("inlineCode",{parentName:"p"},"cross-origin")," \u6709\u4e00\u500b\u7d30\u5fae\u7684\u5dee\u7570\uff0c\u5c31\u662f\u5dee\u5728\u9019\u908a\u3002\u4e0a\u9762\u7684\u7bc4\u4f8b\u5982\u679c b \u90a3\u908a\u6c92\u6709\u9001\u9019\u500b header\uff0c\u90a3 Embedder Policy \u5c31\u4e0d\u7b97\u901a\u904e\u3002"),(0,i.kt)("h2",{id:"coopcross-origin-opener-policy"},"COOP\uff08Cross-Origin-Opener-Policy\uff09"),(0,i.kt)("p",null,"\u800c\u7b2c\u4e8c\u6b65\u5247\u662f\u9019\u500b COOP\uff08Cross-Origin-Opener-Policy\uff09\u7684 header\uff0c\u7576\u4f60\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"window.open")," \u958b\u555f\u4e00\u500b\u7db2\u9801\u7684\u6642\u5019\uff0c\u4f60\u53ef\u4ee5\u64cd\u63a7\u90a3\u500b\u7db2\u9801\u7684 location\uff1b\u800c\u958b\u555f\u7684\u7db2\u9801\u4e5f\u53ef\u4ee5\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"window.opener")," \u4f86\u64cd\u63a7\u4f60\u7684\u7db2\u9801\u3002"),(0,i.kt)("p",null,"\u800c\u9019\u6a23\u5b50\u8b93 window \u4e4b\u9593\u6709\u95dc\u9023\uff0c\u5c31\u4e0d\u7b26\u5408\u8de8\u4f86\u6e90\u7684\u9694\u96e2\u3002\u56e0\u6b64 COOP \u9019\u500b header \u5c31\u662f\u4f86\u898f\u7bc4 window \u8ddf opener \u4e4b\u9593\u7684\u95dc\u4fc2\uff0c\u4e00\u5171\u6709\u4e09\u500b\u503c\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Cross-Origin-Opener-Policy: ",(0,i.kt)("inlineCode",{parentName:"li"},"unsafe-none")),(0,i.kt)("li",{parentName:"ol"},"Cross-Origin-Opener-Policy: ",(0,i.kt)("inlineCode",{parentName:"li"},"same-origin")),(0,i.kt)("li",{parentName:"ol"},"Cross-Origin-Opener-Policy: ",(0,i.kt)("inlineCode",{parentName:"li"},"same-origin-allow-popups")," ")),(0,i.kt)("p",null,"\u7b2c\u4e00\u500b\u5c31\u662f\u9810\u8a2d\u503c\uff0c\u4e0d\u89e3\u91cb\uff0c\u56e0\u70ba\u6c92\u4ec0\u9ebc\u4f5c\u7528\u3002\u5176\u4ed6\u5169\u500b\u6709\u9ede\u8907\u96dc\uff0c\u76f4\u63a5\u7528\u500b\u7c21\u55ae\u7684\u7bc4\u4f8b\u7e3d\u7d50\u4e00\u4e0b\u3002"),(0,i.kt)("p",null,"\u5047\u8a2d\u73fe\u5728\u6709\u4e00\u500b\u7db2\u9801 A \u7528 window.open \u958b\u555f\u4e86\u4e00\u500b\u7db2\u9801 B\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c AB \u662f cross-origin\uff0c\u700f\u89bd\u5668\u672c\u4f86\u5c31\u6709\u9650\u5236\uff0c\u53ea\u80fd\u5b58\u53d6 ",(0,i.kt)("inlineCode",{parentName:"li"},"window.location")," \u6216\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"window.close")," \u4e4b\u985e\u7684\u65b9\u6cd5\u3002\u6c92\u8fa6\u6cd5\u5b58\u53d6 DOM \u6216\u5176\u4ed6\u6771\u897f"),(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c AB \u662f same-origin\uff0c\u90a3\u4ed6\u5011\u53ef\u4ee5\u4e92\u76f8\u5b58\u53d6\u5e7e\u4e4e\u5b8c\u6574\u7684 window\uff0c\u5305\u62ec DOM\u3002"),(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c A \u52a0\u4e0a COOP header\uff0c\u800c\u4e14\u503c\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"same-origin"),"\uff0c\u4ee3\u8868\u91dd\u5c0d\u7b2c\u4e8c\u7a2e\u60c5\u6cc1\u505a\u4e86\u66f4\u591a\u9650\u5236\uff0c\u53ea\u6709 B \u4e5f\u6709\u9019\u500b header \u800c\u4e14\u503c\u4e5f\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"same-origin")," \u7684\u6642\u5019\u624d\u80fd\u4e92\u76f8\u5b58\u53d6 window\u3002"),(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c A \u52a0\u4e0a COOP header\uff0c\u800c\u4e14\u503c\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"same-origin-allow-popups"),"\uff0c\u4e5f\u662f\u5c0d\u7b2c\u4e8c\u7a2e\u60c5\u6cc1\u505a\u9650\u5236\u53ea\u662f\u6bd4\u8f03\u5bec\u9b06\uff0c\u53ea\u8981 B \u7684 COOP header \u4e0d\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"same-origin")," \u5c31\u53ef\u4ee5\u4e92\u76f8\u5b58\u53d6 window\u3002")),(0,i.kt)("p",null,"\u7e3d\u4e4b\u5462\uff0c\u8981\u300c\u6709\u6a5f\u6703\u4e92\u76f8\u5b58\u53d6 window\u300d\uff0c\u4e00\u5b9a\u8981\u5148\u662f same origin\uff0c\u9019\u9ede\u662f\u4e0d\u6703\u8b8a\u7684\u3002\u5be6\u969b\u4e0a\u662f\u4e0d\u662f\u5b58\u53d6\u7684\u5230\uff0c\u5c31\u8981\u770b\u6709\u6c92\u6709\u8a2d\u5b9a COOP header \u4ee5\u53ca header \u7684\u503c\u3002"),(0,i.kt)("p",null,"\u5982\u679c\u6709\u8a2d\u5b9a COOP header \u4f46\u4e0d\u7b26\u5408\u898f\u5247\uff0c\u90a3 ",(0,i.kt)("inlineCode",{parentName:"p"},"window.opener")," \u6703\u76f4\u63a5\u8b8a\u6210 ",(0,i.kt)("inlineCode",{parentName:"p"},"null"),"\uff0c\u9023 location \u90fd\u62ff\u4e0d\u5230\uff08\u6c92\u8a2d\u5b9a\u898f\u5247\u7684\u8a71\uff0c\u5c31\u7b97\u662f cross origin \u4e5f\u62ff\u5f97\u5230\uff09\u3002"),(0,i.kt)("p",null,"\u5176\u5be6\u6839\u64da ",(0,i.kt)("a",{parentName:"p",href:"https://html.spec.whatwg.org/multipage/origin.html#cross-origin-opener-policies"},"spec")," \u9084\u6709\u7b2c\u56db\u7a2e\uff1asame-origin-plus-COEP\uff0c\u4f46\u770b\u8d77\u4f86\u66f4\u8907\u96dc\u5c31\u5148\u4e0d\u7814\u7a76\u4e86\u3002"),(0,i.kt)("h2",{id:"\u518d\u56de\u5230-cross-origin-isolated-state"},"\u518d\u56de\u5230 cross-origin isolated state"),(0,i.kt)("p",null,"\u524d\u9762\u63d0\u5230\u4e86 cross-origin isolated state \u9700\u8981\u8a2d\u7f6e\u9019\u5169\u500b header\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Cross-Origin-Embedder-Policy: require-corp"),(0,i.kt)("li",{parentName:"ol"},"Cross-Origin-Opener-Policy: same-origin")),(0,i.kt)("p",null,"\u70ba\u4ec0\u9ebc\u5462\uff1f\u56e0\u70ba\u4e00\u65e6\u8a2d\u7f6e\u4e86\uff0c\u5c31\u4ee3\u8868\u9801\u9762\u4e0a\u6240\u6709\u7684\u8de8\u4f86\u6e90\u8cc7\u6e90\u90fd\u662f\u4f60\u6709\u6b0a\u9650\u5b58\u53d6\u7684\uff0c\u5982\u679c\u6c92\u6709\u6b0a\u9650\u7684\u8a71\u6703\u51fa\u932f\u3002\u6240\u4ee5\u5982\u679c\u8a2d\u5b9a\u800c\u4e14\u901a\u904e\u4e86\uff0c\u5c31\u4ee3\u8868\u8de8\u4f86\u6e90\u8cc7\u6e90\u4e5f\u90fd\u5141\u8a31\u4f60\u5b58\u53d6\uff0c\u5c31\u4e0d\u6703\u6709\u5b89\u5168\u6027\u7684\u554f\u984c\u3002"),(0,i.kt)("p",null,"\u5728\u7db2\u7ad9\u4e0a\u53ef\u4ee5\u7528\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"self.crossOriginIsolated\n")),(0,i.kt)("p",null,"\u4f86\u5224\u5b9a\u81ea\u5df1\u662f\u4e0d\u662f\u9032\u5165 cross-origin isolated state\u3002\u662f\u7684\u8a71\u5c31\u53ef\u4ee5\u7528\u4e00\u4e9b\u88ab\u5c01\u5370\u7684\u529f\u80fd\uff0c\u56e0\u70ba\u700f\u89bd\u5668\u77e5\u9053\u4f60\u5f88\u5b89\u5168\u3002"),(0,i.kt)("p",null,"\u53e6\u5916\uff0c\u5982\u679c\u9032\u5165\u4e86\u9019\u500b\u72c0\u614b\uff0c\u4e4b\u524d\u8b1b\u904e\u7684\u900f\u904e\u4fee\u6539 ",(0,i.kt)("inlineCode",{parentName:"p"},"document.domain")," \u7e5e\u904e same-origin policy \u7684\u62db\u6578\u5c31\u4e0d\u7ba1\u7528\u4e86\uff0c\u700f\u89bd\u5668\u5c31\u4e0d\u6703\u8b93\u4f60\u4fee\u6539\u9019\u500b\u6771\u897f\u4e86\u3002"),(0,i.kt)("p",null,"\u60f3\u77e5\u9053\u66f4\u591a COOP \u8207 COEP \u9084\u6709 cross-origin isolated state\uff0c\u53ef\u4ee5\u53c3\u8003\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://web.dev/coop-coep/"},'Making your website "cross-origin isolated" using COOP and COEP')),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://web.dev/why-coop-coep/"},'Why you need "cross-origin isolated" for powerful features')),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://scotthelme.co.uk/coop-and-coep/"},"COEP COOP CORP CORS CORB - CRAP that's a lot of new stuff!")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/whatwg/html/issues/4175"},"Making postMessage() work for SharedArrayBuffer (Cross-Origin-Embedder-Policy) #4175")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/whatwg/html/issues/3740"},"Restricting cross-origin WindowProxy access (Cross-Origin-Opener-Policy) #3740")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://www.chromestatus.com/feature/4647328103268352"},"Feature: Cross-Origin Resource Policy"))),(0,i.kt)("h2",{id:"\u5c0f\u7d50"},"\u5c0f\u7d50"),(0,i.kt)("p",null,"\u9019\u7bc7\u5176\u5be6\u8b1b\u4e86\u4e0d\u5c11\u6771\u897f\uff0c\u90fd\u662f\u570d\u7e5e\u8457\u5b89\u5168\u6027\u5728\u6253\u8f49\u3002\u4e00\u958b\u59cb\u6211\u5011\u8b1b\u4e86 CORS \u8a2d\u5b9a\u932f\u8aa4\u6703\u9020\u6210\u7684\u7d50\u679c\u4ee5\u53ca\u9632\u79a6\u65b9\u6cd5\uff0c\u4e5f\u8209\u4e86\u5e7e\u500b\u5be6\u969b\u7684\u6848\u4f8b\u3002"),(0,i.kt)("p",null,"\u63a5\u8457\uff0c\u8b1b\u4e86\u5404\u7a2e CO \u958b\u982d\u7684 header\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"CORB\uff08Cross-Origin Read Blocking\uff09"),(0,i.kt)("li",{parentName:"ol"},"CORP\uff08Cross-Origin Resource Policy\uff09"),(0,i.kt)("li",{parentName:"ol"},"COEP\uff08Cross-Origin-Embedder-Policy\uff09"),(0,i.kt)("li",{parentName:"ol"},"COOP\uff08Cross-Origin-Opener-Policy\uff09")),(0,i.kt)("p",null,"\u5982\u679c\u8981\u5404\u7528\u4e00\u6bb5\u8a71\u7e3d\u7d50\u9019\u56db\u500b\u6771\u897f\u7684\u8a71\uff0c\u6216\u8a31\u662f\uff1a"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"CORB\uff1a\u700f\u89bd\u5668\u9810\u8a2d\u7684\u6a5f\u5236\uff0c\u4e3b\u8981\u662f\u9632\u6b62\u8f09\u5165\u4e0d\u5408\u7406\u7684\u8cc7\u6e90\uff0c\u50cf\u662f\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"<img>")," \u8f09\u5165 HTML"),(0,i.kt)("li",{parentName:"ol"},"CORP\uff1a\u662f\u4e00\u500b HTTP response header\uff0c\u6c7a\u5b9a\u9019\u500b\u8cc7\u6e90\u53ef\u4ee5\u88ab\u8ab0\u8f09\u5165\uff0c\u53ef\u4ee5\u9632\u6b62 cross-origin \u8f09\u5165\u5716\u7247\u3001\u5f71\u7247\u6216\u4efb\u4f55\u8cc7\u6e90"),(0,i.kt)("li",{parentName:"ol"},"COEP\uff1a\u662f\u4e00\u500b HTTP response header\uff0c\u78ba\u4fdd\u9801\u9762\u4e0a\u6240\u6709\u7684\u8cc7\u6e90\u90fd\u662f\u5408\u6cd5\u8f09\u5165\u7684"),(0,i.kt)("li",{parentName:"ol"},"COOP\uff1a\u662f\u4e00\u500b HTTP response header\uff0c\u5e6b same-origin \u52a0\u4e0a\u66f4\u56b4\u683c\u7684 window \u5171\u4eab\u8a2d\u5b9a")),(0,i.kt)("p",null,"\u4e4b\u6240\u4ee5\u6703\u7528\u9019\u9ebc\u5927\u7684\u7bc7\u5e45\uff0c\u4e00\u4f86\u662f\u56e0\u70ba\u6709\u4e0d\u5c11\u4f86\u9f8d\u53bb\u8108\u8981\u89e3\u91cb\uff0c\u4e8c\u4f86\u5c31\u53ef\u4ee5\u770b\u51fa origin \u9019\u4ef6\u4e8b\u60c5\u5c0d\u65bc\u700f\u89bd\u5668\u7684\u91cd\u8981\u7a0b\u5ea6\uff0c\u91cd\u8981\u5230\u9700\u8981\u7528\u9019\u9ebc\u591a\u6771\u897f\u53bb\u4fdd\u8b77\uff0c\u53bb\u78ba\u4fdd\u540c\u6e90\u653f\u7b56\u3002"),(0,i.kt)("p",null,"\u770b\u5b8c\u4e86\u9019\u4e00\u5927\u5806\u540c\u6e90\u7684\u8de8\u4f86\u6e90\u7684\u6771\u897f\u4e4b\u5f8c\uff0c\u6211\u5011\u4e0b\u4e00\u7bc7\u63db\u500b\u53e3\u5473\uff0c\u4f86\u770b\u770b\u7d93\u5178\u7684 CSRF\u3002"))}k.isMDXComponent=!0},802:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/22-01-7996e373152b0341b07c18d6498f2259.png"},4158:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/22-02-83e532426aa5c1b67b4a64bb25d1795e.png"},6172:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/22-03-926b42b4f629cf27973e9877ba120244.png"}}]);