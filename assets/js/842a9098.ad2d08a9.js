"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[573],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var a=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=s(t),d=l,k=m["".concat(p,".").concat(d)]||m[d]||u[d]||r;return t?a.createElement(k,o(o({ref:n},c),{},{components:t})):a.createElement(k,o({ref:n},c))}));function k(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var r=t.length,o=new Array(r);o[0]=d;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i[m]="string"==typeof e?e:l,o[1]=i;for(var s=2;s<r;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},8482:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>s});var a=t(7462),l=(t(7294),t(3905));const r={sidebar_position:16},o="\u524d\u7aef\u7684\u6a21\u677f\u6ce8\u5165\u653b\u64ca\uff1aCSTI",i={unversionedId:"ch3/csti",id:"ch3/csti",title:"\u524d\u7aef\u7684\u6a21\u677f\u6ce8\u5165\u653b\u64ca\uff1aCSTI",description:"CSTI\uff0c\u5168\u540d\u70ba Client Side Template Injection\uff0c\u76f4\u7ffb\u7684\u8a71\u5c31\u662f\u524d\u7aef\u6a21\u677f\u6ce8\u5165\uff0c\u90a3\u65e2\u7136\u6703\u7279\u5225\u52a0\u4e0a\u524d\u7aef\uff0c\u5c31\u4ee3\u8868\u8aaa\u4e5f\u6709\u4e00\u500b\u5c0d\u61c9\u7684\u5f8c\u7aef\u7248\u672c\uff0c\u53eb\u505a SSTI\uff0c\u5168\u7a31\u5c31\u53ea\u662f\u628a Client \u6539\u6210 Server\u3002",source:"@site/docs/ch3/16-csti.md",sourceDirName:"ch3",slug:"/ch3/csti",permalink:"/beyond-xss/ch3/csti",draft:!1,tags:[],version:"current",sidebarPosition:16,frontMatter:{sidebar_position:16},sidebar:"tutorialSidebar",previous:{title:"HTML \u4e5f\u53ef\u4ee5\u5f71\u97ff JavaScript\uff1fDOM clobbering \u4ecb\u7d39",permalink:"/beyond-xss/ch3/dom-clobbering"},next:{title:"\u53ea\u7528 CSS \u4e5f\u80fd\u653b\u64ca\uff1fCSS injection\uff08\u4e0a\uff09",permalink:"/beyond-xss/ch3/css-injection"}},p={},s=[{value:"Server Side Template Injection",id:"server-side-template-injection",level:2},{value:"SSTI \u7684\u5be6\u969b\u6848\u4f8b",id:"ssti-\u7684\u5be6\u969b\u6848\u4f8b",level:2},{value:"Client Side Template Injection",id:"client-side-template-injection",level:2},{value:"CSTI \u7684\u5be6\u969b\u6848\u4f8b",id:"csti-\u7684\u5be6\u969b\u6848\u4f8b",level:2},{value:"AngularJS \u8207 CSP bypass",id:"angularjs-\u8207-csp-bypass",level:2},{value:"\u5c0f\u7d50",id:"\u5c0f\u7d50",level:2}],c={toc:s},m="wrapper";function u(e){let{components:n,...t}=e;return(0,l.kt)(m,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"\u524d\u7aef\u7684\u6a21\u677f\u6ce8\u5165\u653b\u64cacsti"},"\u524d\u7aef\u7684\u6a21\u677f\u6ce8\u5165\u653b\u64ca\uff1aCSTI"),(0,l.kt)("p",null,"CSTI\uff0c\u5168\u540d\u70ba Client Side Template Injection\uff0c\u76f4\u7ffb\u7684\u8a71\u5c31\u662f\u524d\u7aef\u6a21\u677f\u6ce8\u5165\uff0c\u90a3\u65e2\u7136\u6703\u7279\u5225\u52a0\u4e0a\u524d\u7aef\uff0c\u5c31\u4ee3\u8868\u8aaa\u4e5f\u6709\u4e00\u500b\u5c0d\u61c9\u7684\u5f8c\u7aef\u7248\u672c\uff0c\u53eb\u505a SSTI\uff0c\u5168\u7a31\u5c31\u53ea\u662f\u628a Client \u6539\u6210 Server\u3002"),(0,l.kt)("p",null,"\u5728\u4ecb\u7d39\u524d\u7aef\u7684\u7248\u672c\u4e4b\u524d\uff0c\u6211\u5011\u5148\u4f86\u770b\u4e00\u4e0b\u5f8c\u7aef\u7684\u3002"),(0,l.kt)("h2",{id:"server-side-template-injection"},"Server Side Template Injection"),(0,l.kt)("p",null,"\u5728\u5beb\u5f8c\u7aef\u7684\u6642\u5019\u5982\u679c\u9700\u8981\u8f38\u51fa HTML\uff0c\u4f60\u53ef\u4ee5\u9078\u64c7\u50cf\u662f\u7d14 PHP \u90a3\u6a23\u76f4\u63a5\u8f38\u51fa\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n  echo '<h1>hello</h1>';\n?>\n")),(0,l.kt)("p",null,"\u4f46\u662f\u7576 HTML \u88e1\u9762\u6709\u90e8\u5206\u5167\u5bb9\u662f\u52d5\u614b\u7684\u8a71\uff0c\u7a0b\u5f0f\u78bc\u5c31\u6703\u8b8a\u5f97\u6108\u4f86\u6108\u8907\u96dc\u3002\u56e0\u6b64\u5728\u771f\u6b63\u7684\u958b\u767c\u4e0a\uff0c\u901a\u5e38\u90fd\u6703\u4f7f\u7528\u4e00\u7a2e\u53eb\u505a\u6a21\u677f\u5f15\u64ce\uff08template engine\uff09\u7684\u6771\u897f\uff0c\u9019\u500b\u6211\u5011\u5728\u8b1b sanitization \u7684\u6642\u5019\u6709\u7a0d\u5fae\u63d0\u904e\u4e86\u3002"),(0,l.kt)("p",null,"\u8209\u4f8b\u4f86\u8aaa\uff0c\u6211\u7684\u90e8\u843d\u683c\u7684\u6587\u7ae0\u9801\u9762\uff0c\u6709\u4e00\u90e8\u5206\u7684\u6a21\u677f\u662f\u9019\u6a23\u7684\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<article class="article content gallery" itemscope itemprop="blogPost">\n    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">\n        <%= post.title %>\n    </h1>\n    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">\n        <span class="column is-narrow">\n            <time datetime="<%= date_xml(post.date) %>" itemprop="datePublished"><%= format_date_full(post.date) %></time>\n        </span>\n        <% if (post.categories && post.categories.length){ %>\n        <span class="column is-narrow article-category">\n            <i class="far fa-folder"></i>\n            <%- (post._categories || post.categories).map(category =>\n                    `<a class="article-category-link" href="${url_for(category.path)}">${category.name}</a>`)\n                    .join(\'<span>></span>\') %>\n        </span>\n        <% } %>\n    </div>\n    \n    <div class="article-entry is-size-6-mobile" itemprop="articleBody">\n        <%- post.content %>\n    </div>\n</article>\n')),(0,l.kt)("p",null,"\u5728 render \u7684\u6642\u5019\u6211\u53ea\u8981\u50b3\u5165 ",(0,l.kt)("inlineCode",{parentName:"p"},"post")," \u9019\u500b\u7269\u4ef6\uff0c\u518d\u642d\u914d\u4e0a\u6a21\u677f\uff0c\u5c31\u53ef\u4ee5\u6e32\u67d3\u51fa\u4e00\u500b\u5b8c\u6574\u7684\u6587\u7ae0\u9801\u9762\u3002"),(0,l.kt)("p",null,"\u800c template injection \u4ee3\u8868\u7684\u4e26\u4e0d\u662f\u300c\u653b\u64ca\u8005\u53ef\u4ee5\u64cd\u63a7\u50cf\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"post")," \u9019\u4e9b\u8cc7\u6599\u300d\uff0c\u800c\u662f\u300c\u653b\u64ca\u8005\u53ef\u4ee5\u64cd\u63a7\u6a21\u677f\u672c\u8eab\u300d\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\u8aaa\u767c\u884c\u92b7\u90f5\u4ef6\u7684\u670d\u52d9\u597d\u4e86\uff0c\u901a\u5e38\u516c\u53f8\u90fd\u6703\u628a\u4f7f\u7528\u8005\u7684\u8cc7\u6599\u532f\u5165\u5230\u4e0a\u9762\uff0c\u7136\u5f8c\u8a2d\u5b9a\u81ea\u5df1\u7684\u6a21\u677f\uff0c\u4f8b\u5982\u8aaa\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'\u55e8\u55e8 {{name}}\uff0c\u6211\u662f\u516c\u53f8\u7684\u5275\u8fa6\u4eba Huli\n\n\u4e0d\u77e5\u9053\u6211\u5011\u76ee\u524d\u7684\u7522\u54c1\u4f60\u7528\u7684\u9084\u7fd2\u6163\u55ce\uff1f\n\u5982\u679c\u4e0d\u7fd2\u6163\u7684\u8a71\uff0c\u96a8\u6642\u53ef\u4ee5\u8ddf\u6211\u7d04\u500b\u5341\u5206\u9418\u7684\u7dda\u4e0a\u6703\u8b70\n\n\u53ef\u4ee5\u9ede\u9019\u500b\u9023\u7d50\u9810\u7d04\uff1a<a href="{{link}}?q={{email}}">\u9810\u7d04\u9023\u7d50</a>\n\nHuli\n')),(0,l.kt)("p",null,"\u5728\u516c\u53f8\u8a2d\u5b9a\u7684\u6642\u5019\u5c31\u53ef\u4ee5\u63a7\u5236\u6a21\u677f\u7684\u5167\u5bb9\u4e86\uff0c\u5047\u8a2d\u9019\u500b\u6a21\u677f\u76f4\u63a5\u88ab\u5f8c\u7aef\u62ff\u53bb\u4f7f\u7528\uff0c\u4ee5 Python \u642d\u914d Jinja2 \u70ba\u4f8b\u7684\u8a71\u6703\u662f\u9019\u6a23\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'from jinja2 import Template\n\ndata = {\n    "name": "Peter",\n    "link": "https://example.com",\n    "email": "test@example.com"\n}\n\ntemplate_str = """\n\u55e8\u55e8 {{name}}\uff0c\u6211\u662f\u516c\u53f8\u7684\u5275\u8fa6\u4eba Huli\n\n\u4e0d\u77e5\u9053\u6211\u5011\u76ee\u524d\u7684\u7522\u54c1\u4f60\u7528\u7684\u9084\u7fd2\u6163\u55ce\uff1f\n\u5982\u679c\u4e0d\u7fd2\u6163\u7684\u8a71\uff0c\u96a8\u6642\u53ef\u4ee5\u8ddf\u6211\u7d04\u500b\u5341\u5206\u9418\u7684\u7dda\u4e0a\u6703\u8b70\n\n\u53ef\u4ee5\u9ede\u9019\u500b\u9023\u7d50\u9810\u7d04\uff1a<a href="{{link}}?q={{email}}">\u9810\u7d04\u9023\u7d50</a>\n\nHuli\n"""\ntemplate = Template(template_str)\nrendered_template = template.render(\n    name=data[\'name\'],\n    link=data[\'link\'],\n    email=data[\'email\'])\nprint(rendered_template)\n')),(0,l.kt)("p",null,"\u6700\u5f8c\u5370\u51fa\u7684\u7d50\u679c\u70ba\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'\u55e8\u55e8 Peter\uff0c\u6211\u662f\u516c\u53f8\u7684\u5275\u8fa6\u4eba Huli\n\n\u4e0d\u77e5\u9053\u6211\u5011\u76ee\u524d\u7684\u7522\u54c1\u4f60\u7528\u7684\u9084\u7fd2\u6163\u55ce\uff1f\n\u5982\u679c\u4e0d\u7fd2\u6163\u7684\u8a71\uff0c\u96a8\u6642\u53ef\u4ee5\u8ddf\u6211\u7d04\u500b\u5341\u5206\u9418\u7684\u7dda\u4e0a\u6703\u8b70\n\n\u53ef\u4ee5\u9ede\u9019\u500b\u9023\u7d50\u9810\u7d04\uff1a<a href="https://example.com?q=test@example.com">\u9810\u7d04\u9023\u7d50</a>\n\nHuli\n')),(0,l.kt)("p",null,"\u770b\u8d77\u4f86\u6c92\u4ec0\u9ebc\u554f\u984c\uff0c\u4f46\u5982\u679c\u6211\u5011\u628a template \u6539\u4e00\u4e0b\u5462\uff1f\u50cf\u662f\u9019\u6a23\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'from jinja2 import Template\n\ndata = {\n    "name": "Peter",\n    "link": "https://example.com",\n    "email": "test@example.com"\n}\n\ntemplate_str = """\nOutput: {{ \n    self.__init__.__globals__.__builtins__\n    .__import__(\'os\').popen(\'uname\').read()\n}}\n"""\ntemplate = Template(template_str)\nrendered_template = template.render(\n    name=data[\'name\'],\n    link=data[\'link\'],\n    email=data[\'email\'])\nprint(rendered_template)\n')),(0,l.kt)("p",null,"\u8f38\u51fa\u5c31\u6703\u8b8a\u6210\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"Output: Darwin"),"\uff0c\u800c Darwin \u5c31\u662f\u6307\u4ee4 ",(0,l.kt)("inlineCode",{parentName:"p"},"uname")," \u57f7\u884c\u4ee5\u5f8c\u7684\u7d50\u679c\u3002"),(0,l.kt)("p",null,"\u7c21\u55ae\u4f86\u8b1b\uff0c\u4f60\u53ef\u4ee5\u628a ",(0,l.kt)("inlineCode",{parentName:"p"},"{{}}")," \u88e1\u9762\u7684\u6771\u897f\u770b\u6210\u662f\u6a21\u677f\u5f15\u64ce\u6703\u5e6b\u4f60\u57f7\u884c\u7684\u7a0b\u5f0f\u78bc\u3002"),(0,l.kt)("p",null,"\u96d6\u7136\u8aaa\u6211\u5011\u4ee5\u524d\u90fd\u53ea\u6709\u7c21\u55ae\u5beb ",(0,l.kt)("inlineCode",{parentName:"p"},"{{name}}"),"\uff0c\u4f46\u5176\u5be6\u9084\u53ef\u4ee5\u505a\u66f4\u591a\u64cd\u4f5c\uff0c\u4f8b\u5982\u8aaa ",(0,l.kt)("inlineCode",{parentName:"p"},"{{ name + email }}")," \u4e5f\u662f\u53ef\u4ee5\u7684\u3002\u4ee5\u4e0a\u9762\u7684\u6848\u4f8b\u4f86\u770b\uff0c\u5c31\u662f\u5f9e ",(0,l.kt)("inlineCode",{parentName:"p"},"self")," \u958b\u59cb\u4e00\u8def\u7528 Python \u9ed1\u9b54\u6cd5\u8b80\u5230\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"__import__"),"\uff0c\u5c31\u53ef\u4ee5 import \u5176\u4ed6 module \u9032\u4f86\uff0c\u9054\u6210\u6307\u4ee4\u7684\u57f7\u884c\u3002"),(0,l.kt)("p",null,"\u50cf\u9019\u7a2e\u80fd\u5920\u8b93\u653b\u64ca\u8005\u638c\u63a7\u6a21\u677f\u7684\u6f0f\u6d1e\u5c31\u53eb\u505a\u6a21\u677f\u6ce8\u5165\uff0c\u767c\u751f\u5728\u5f8c\u7aef\u5c31\u53eb SSTI\uff0c\u5728\u524d\u7aef\u5c31\u53eb\u505a CSTI\u3002"),(0,l.kt)("p",null,"\u9632\u79a6\u65b9\u5f0f\u7684\u8a71\u5f88\u7c21\u55ae\uff0c\u5c31\u662f\u4e0d\u8981\u628a\u4f7f\u7528\u8005\u7684\u8f38\u5165\u7576\u6210\u662f\u6a21\u677f\u7684\u4e00\u90e8\u5206\uff1b\u5982\u679c\u7121\u8ad6\u5982\u4f55\u90fd\u5fc5\u9808\u8981\u9019\u6a23\u505a\u7684\u8a71\uff0c\u8a18\u5f97\u770b\u770b\u6a21\u677f\u5f15\u64ce\u662f\u5426\u6709\u63d0\u4f9b sandbox \u7684\u529f\u80fd\uff0c\u8b93\u4f60\u5728\u5b89\u5168\u7684\u74b0\u5883\u4e0b\u57f7\u884c\u4e0d\u4fe1\u4efb\u7684\u7a0b\u5f0f\u78bc\u3002"),(0,l.kt)("h2",{id:"ssti-\u7684\u5be6\u969b\u6848\u4f8b"},"SSTI \u7684\u5be6\u969b\u6848\u4f8b"),(0,l.kt)("p",null,"\u7b2c\u4e00\u500b\u4f86\u770b 2016 \u5e74 Orange \u5728 Uber \u767c\u73fe\u7684\u6f0f\u6d1e\uff0c\u4ed6\u67d0\u5929\u7a81\u7136\u767c\u73fe Uber \u5bc4\u4f86\u7684\u4fe1\u4e2d\u6709\u4e00\u500b ",(0,l.kt)("inlineCode",{parentName:"p"},"2"),"\uff0c\u624d\u60f3\u8d77\u4f86\u4ed6\u5728\u59d3\u540d\u7684\u6b04\u4f4d\u4e2d\u8f38\u5165\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"{{ 1+1 }}"),"\uff0c\u9019\u500b\u662f\u5728\u627e SSTI \u6f0f\u6d1e\u6642\u5f88\u5e38\u898b\u7684\u6280\u5de7\uff0c\u5c31\u662f\u5728\u53ef\u4ee5\u8f38\u5165\u7684\u5730\u65b9\u8f38\u5165\u4e00\u5927\u5806 payload\uff0c\u5f9e\u7d50\u679c\u5c31\u53ef\u4ee5\u770b\u51fa\u662f\u5426\u6709 SSTI \u7684\u554f\u984c\u3002"),(0,l.kt)("p",null,"\u800c\u63a5\u8457\u5c31\u662f\u7528\u4e86\u6211\u5011\u4e0a\u9762\u63d0\u5230\u7684\u624b\u6cd5\u53bb\u627e\u6709\u54ea\u4e9b\u8b8a\u6578\u53ef\u4ee5\u7528\u7136\u5f8c\u4e32\u63a5\uff0c\u56e0\u70ba Uber \u4e5f\u662f\u7528 Jinja2\uff0c\u6240\u4ee5\u6700\u5f8c\u7684 payload \u8ddf\u6211\u5011\u525b\u525b\u5beb\u7684\u5dee\u4e0d\u591a\uff0c\u6700\u5f8c\u5229\u7528\u4e86 SSTI \u9054\u6210\u4e86 RCE\u3002"),(0,l.kt)("p",null,"\u66f4\u8a73\u7d30\u7684\u904e\u7a0b\u53ef\u4ee5\u53c3\u8003\uff1a",(0,l.kt)("a",{parentName:"p",href:"http://blog.orange.tw/2016/04/bug-bounty-uber-ubercom-remote-code_7.html"},"Uber \u9060\u7aef\u4ee3\u78bc\u57f7\u884c- Uber.com Remote Code Execution via Flask Jinja2 Template Injection")),(0,l.kt)("p",null,"\u7b2c\u4e8c\u500b\u5247\u662f 2019 \u5e74 Shopify \u7684 Handlebars SSTI\uff0c\u7531 Mahmoud Gamal \u56de\u5831\u3002"),(0,l.kt)("p",null,"Shopify \u7684\u5546\u5bb6\u5f8c\u53f0\u6709\u500b\u529f\u80fd\u662f\u53ef\u4ee5\u8b93\u5546\u5bb6\u81ea\u8a02\u8981\u5bc4\u7d66\u4f7f\u7528\u8005\u7684\u4fe1\u4ef6\uff08\u5c31\u8ddf\u6211\u525b\u525b\u8209\u7684\u4f8b\u5b50\u5f88\u50cf\u5566\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"{{order.number}}")," \u9019\u7a2e\u8a9e\u6cd5\u4f86\u81ea\u8a02\u5167\u5bb9\u3002\u800c\u5f8c\u7aef\u662f\u4f7f\u7528\u4e86 Node.js \u642d\u914d Handlebars \u9019\u4e00\u5957\u6a21\u677f\u5f15\u64ce\u3002"),(0,l.kt)("p",null,"\u56e0\u70ba Handlebars \u6709\u4e00\u4e9b\u4fdd\u8b77\u63aa\u65bd\u800c\u4e14\u6bd4\u8f03\u8907\u96dc\uff0c\u6240\u4ee5\u99ed\u5ba2\u82b1\u4e86\u8a31\u591a\u6642\u9593\u5728\u5617\u8a66\u8a72\u600e\u9ebc\u53bb\u653b\u64ca\uff0c\u7562\u7adf\u6709 SSTI \u662f\u4e00\u56de\u4e8b\uff0c\u4f46\u4e26\u4e0d\u662f\u6bcf\u500b\u6a21\u677f\u5f15\u64ce\u90fd\u80fd\u5920\u5f04\u5230 RCE\u3002"),(0,l.kt)("p",null,"\u6700\u5f8c\u8a66\u51fa\u4f86\u7684 payload \u975e\u5e38\u9577\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{{#with this as |obj|}}\n    {{#with (obj.constructor.keys "1") as |arr|}}\n        {{#with obj.constructor.name as |str|}}\n            {{#blockHelperMissing str.toString}}\n              {{#with (arr.constructor (str.toString.bind "return JSON.stringify(process.env);"))}}\n                  {{#with (obj.constructor.getOwnPropertyDescriptor this 0)}}\n                      {{#with (obj.constructor.defineProperty obj.constructor.prototype "toString" this)}}\n                          {{#with (obj.constructor.constructor "test")}}\n                            {{this}}\n                          {{/with}}\n                      {{/with}}\n                  {{/with}}\n              {{/with}}\n            {{/blockHelperMissing}}\n        {{/with}}\n  {{/with}}\n{{/with}}\n')),(0,l.kt)("p",null,"\u7d30\u7bc0\u53ef\u4ee5\u53c3\u8003\u4f5c\u8005\u7684\u539f\u6587\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html"},"Handlebars template injection and RCE in a Shopify app")),(0,l.kt)("h2",{id:"client-side-template-injection"},"Client Side Template Injection"),(0,l.kt)("p",null,"\u5728\u77ad\u89e3\u4e86 SSTI \u4e4b\u5f8c\uff0c\u60f3\u7406\u89e3 CSTI \u5c31\u66f4\u5bb9\u6613\u4e86\uff0c\u56e0\u70ba\u539f\u7406\u90fd\u985e\u4f3c\uff0c\u552f\u4e00\u7684\u5dee\u5225\u5728\u9019\u500b\u6a21\u677f\u662f\u524d\u7aef\u7684\u6a21\u677f\u3002"),(0,l.kt)("p",null,"\u54a6\uff1f\u524d\u7aef\u4e5f\u6709\u6a21\u677f\u55ce\uff1f\u7576\u7136\u6709\uff01"),(0,l.kt)("p",null,"\u4f8b\u5982\u8aaa Angular \u5c31\u662f\u4e00\u500b\uff0c\u5e95\u4e0b\u662f Angular ",(0,l.kt)("a",{parentName:"p",href:"https://angular.io/quick-start"},"\u5b98\u7db2"),"\u7d66\u7684\u7bc4\u4f8b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// import required packages\nimport 'zone.js';\nimport { Component } from '@angular/core';\nimport { bootstrapApplication } from '@angular/platform-browser';\n\n// describe component\n@Component({\n  selector: 'add-one-button', // component name used in markup\n  standalone: true, // component is self-contained\n  template: // the component's markup\n  `\n   <button (click)=\"count = count + 1\">Add one</button> {{ count }}\n  `,\n})\n\n// export component\nexport class AddOneButtonComponent {\n  count = 0;\n}\n\nbootstrapApplication(AddOneButtonComponent);\n")),(0,l.kt)("p",null,"\u53ef\u4ee5\u6e05\u695a\u770b\u5230\u6709\u4e00\u500b\u53eb\u505a ",(0,l.kt)("inlineCode",{parentName:"p"},"template")," \u7684\u53c3\u6578\uff0c\u5982\u679c\u4f60\u628a ",(0,l.kt)("inlineCode",{parentName:"p"},"{{ count }}")," \u6539\u6210 ",(0,l.kt)("inlineCode",{parentName:"p"},"{{ constructor.constructor('alert(1)')() }}"),"\uff0c\u5c31\u6703\u770b\u5230\u4e00\u500b alert \u8996\u7a97\u8df3\u51fa\u4f86\u3002"),(0,l.kt)("p",null,"\u6703\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"constructor.constructor('alert(1)')()")," \u662f\u56e0\u70ba\u6a21\u677f\u88e1\u9762\u6c92\u8fa6\u6cd5\u76f4\u63a5\u5b58\u53d6\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"window"),"\uff0c\u56e0\u6b64\u8981\u900f\u904e Function constructor \u4f86\u5efa\u7acb\u65b0\u7684 function\u3002"),(0,l.kt)("p",null,"\u5728 Angular \u6587\u4ef6\u88e1\u7684 ",(0,l.kt)("a",{parentName:"p",href:"https://angular.io/guide/security#angulars-cross-site-scripting-security-model"},"Angular's cross-site scripting security model")," \u6709\u5beb\u8aaa\uff1a"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Unlike values to be used for rendering, Angular templates are considered trusted by default, and should be treated as executable code. Never create templates by concatenating user input and template syntax. Doing this would enable attackers to inject arbitrary code into your application.")),(0,l.kt)("p",null,"\u61c9\u8a72\u628a template \u770b\u4f5c\u662f\u53ef\u4ee5\u57f7\u884c\u7684 code\uff0c\u6c38\u9060\u4e0d\u8981\u8b93\u4f7f\u7528\u8005\u53ef\u4ee5\u63a7\u5236 template\u3002"),(0,l.kt)("p",null,"\u8a71\u8aaa\u4f60\u77e5\u9053 AngularJS \u8ddf Angular \u7684\u5dee\u5225\u55ce\uff1f"),(0,l.kt)("p",null,"\u5728 2010 \u5e74\u525b\u63a8\u51fa\u6642\u53eb\u505a AngularJS\uff0c\u90a3\u6642\u7684\u7248\u672c\u865f\u90fd\u662f 0.x.x \u6216\u662f 1.x.x\uff0c\u4f46\u662f\u7248\u672c\u865f\u5230\u4e86 2 \u4ee5\u5f8c\uff0c\u5c31\u6539\u540d\u53eb\u505a Angular\uff0c\u4f7f\u7528\u4e0a\u985e\u4f3c\u4f46\u662f\u8a2d\u8a08\u4e0a\u6574\u500b\u91cd\u5beb\u3002\u6211\u5011\u4e4b\u5f8c\u57fa\u672c\u4e0a\u53ea\u6703\u63d0\u5230\u820a\u7248\u7684 AngularJS\uff0c\u56e0\u70ba\u5b83\u820a\u6240\u4ee5\u554f\u984c\u6bd4\u8f03\u591a\uff0c\u662f\u5f88\u9069\u5408\u62ff\u4f86\u8f14\u52a9\u653b\u64ca\u7684\u51fd\u5f0f\u5eab\u3002"),(0,l.kt)("p",null,"\u5728 AngularJS \u525b\u63a8\u51fa\u7684\u6642\u5019\uff0c\u4e5f\u662f\u4e00\u6a23\u900f\u904e ",(0,l.kt)("inlineCode",{parentName:"p"},"{{ constructor.constructor('alert(1)')() }}")," \u5c31\u53ef\u4ee5\u57f7\u884c\u4efb\u610f\u7a0b\u5f0f\u78bc\uff0c\u4f46\u5f8c\u4f86\u5728 1.2.0 \u7248\u672c\u958b\u59cb\u52a0\u4e0a sandbox \u6a5f\u5236\uff0c\u60f3\u76e1\u8fa6\u6cd5\u8b93\u4eba\u4e0d\u80fd\u63a5\u89f8\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"window"),"\uff0c\u4e0d\u904e\u8981\u6bd4\u653b\u9632\u7684\u8a71\uff0c\u8cc7\u5b89\u7814\u7a76\u54e1\u53ef\u662f\u4e0d\u6703\u8f38\u7684\uff0c\u9678\u7e8c\u627e\u5230\u4e86\u4e00\u4e9b\u7e5e\u904e\u7684\u65b9\u5f0f\u3002"),(0,l.kt)("p",null,"\u5c31\u9019\u6a23\u4e0d\u65b7\u7dad\u6301\u8457\u88ab\u7e5e\u904e\u7136\u5f8c\u52a0\u56fa sandbox \u5f8c\u518d\u88ab\u7e5e\u904e\u7684\u8ff4\u5708\uff0cAngularJS \u7d42\u65bc\u5ba3\u5e03\u5728 1.6 \u7248\u4ee5\u5f8c\u5168\u9762\u79fb\u9664 sandbox\uff0c\u539f\u56e0\u662f sandbox \u5176\u5be6\u4e0d\u662f\u4e00\u500b\u8cc7\u5b89\u7684 feature\uff0c\u5982\u679c\u4f60\u7684 template \u53ef\u4ee5\u88ab\u63a7\u5236\uff0c\u90a3\u8981\u89e3\u6c7a\u7684\u61c9\u8a72\u662f\u9019\u500b\u554f\u984c\uff0c\u800c\u4e0d\u662f sandbox\u3002\u7d30\u7bc0\u53ef\u4ee5\u53c3\u8003\u7576\u521d\u516c\u544a\u7684\u6587\u7ae0\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://sites.google.com/site/bughunteruniversity/nonvuln/angularjs-expression-sandbox-bypass"},"AngularJS expression sandbox bypass"),"\uff0c\u66f4\u591a\u7e5e\u904e\u7684\u6b77\u53f2\u53ef\u4ee5\u770b ",(0,l.kt)("a",{parentName:"p",href:"https://portswigger.net/research/dom-based-angularjs-sandbox-escapes"},"DOM based AngularJS sandbox escapes"),"\u3002"),(0,l.kt)("p",null,"\u5728 AngularJS 1.x \u7684\u7248\u672c\u4e2d\uff0c\u4f7f\u7528\u4e0a\u66f4\u52a0\u65b9\u4fbf\u5bb9\u6613\uff0c\u53ea\u9700\u8981\u4e00\u500b ",(0,l.kt)("inlineCode",{parentName:"p"},"ng-app")," \u7684\u5143\u7d20\u5373\u53ef\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="utf-8">\n</head>\n<body>\n  <div ng-app>\n    {{ \'hello world\'.toUpperCase() }}\n  </div>\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"><\/script>\n</body>\n</html>\n')),(0,l.kt)("p",null,"\u96d6\u7136\u8aaa\u7406\u60f3\u4e0a\u6574\u500b\u524d\u7aef\u90fd\u61c9\u8a72\u662f AngularJS \u63a7\u5236\uff0c\u8ddf\u5f8c\u7aef\u7684\u4ea4\u6d41\u90fd\u662f\u900f\u904e API\uff0c\u5f8c\u7aef\u5b8c\u5168\u4e0d\u53c3\u8207 view \u7684 render\uff0c\u4f46\u90a3\u6642\u5019 SPA \u7684\u6982\u5ff5\u4e5f\u9084\u4e0d\u6d41\u884c\uff0c\u8a31\u591a\u7db2\u7ad9\u9084\u662f\u8b93\u5f8c\u7aef\u8ca0\u8cac view \u7684 render\uff0c\u56e0\u6b64\u5f88\u53ef\u80fd\u6703\u5beb\u51fa\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-php"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="utf-8">\n</head>\n<body>\n  <div ng-app>\n    Hello, <?php echo htmlspecialchars($_GET[\'name\']) ?>\n  </div>\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"><\/script>\n</body>\n</html>\n')),(0,l.kt)("p",null,"\u76f4\u63a5\u5728\u5f8c\u7aef render \u7684\u6642\u5019\u653e\u5165\u8cc7\u6599\u4e26\u4e14\u63d2\u5165\u5230 HTML \u4e2d\u3002"),(0,l.kt)("p",null,"\u96d6\u7136\u4e0a\u9762\u9019\u6bb5\u7a0b\u5f0f\u78bc\u5df2\u7d93\u6709\u628a\u8f38\u5165\u505a\u7de8\u78bc\u4e86\uff0c\u4f46\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"{{ alert(1) }}")," \u4e2d\u5b8c\u5168\u6c92\u6709\u4e0d\u5408\u6cd5\u7684\u5b57\u5143\uff0c\u56e0\u6b64\u9084\u662f\u6703\u5c0e\u81f4 XSS \u7684\u767c\u751f\u3002"),(0,l.kt)("p",null,"\u9632\u79a6\u65b9\u5f0f\u7684\u8a71\u8ddf SSTI \u4e00\u6a23\uff0c\u6c38\u9060\u4e0d\u8981\u628a\u4f7f\u7528\u8005\u7684\u8f38\u5165\u76f4\u63a5\u7576\u6210\u6a21\u677f\u5167\u5bb9\u7684\u4e00\u90e8\u5206\uff0c\u4e0d\u7136\u5f88\u5bb9\u6613\u51fa\u4e8b\u3002"),(0,l.kt)("h2",{id:"csti-\u7684\u5be6\u969b\u6848\u4f8b"},"CSTI \u7684\u5be6\u969b\u6848\u4f8b"),(0,l.kt)("p",null,"\u8209\u4e00\u500b\u71b1\u9a30\u9a30\u7684\u6848\u4f8b\uff0c\u4e00\u540d\u4f86\u81ea\u65e5\u672c\u7684\u8cc7\u5b89\u7814\u7a76\u54e1 Masato Kinugawa \u5728 2022 \u5e74\u7684 Pwn2Own \u4e2d\u793a\u7bc4\u4e86\u5fae\u8edf\u901a\u8a0a\u8edf\u9ad4 Teams \u7684 RCE \u6f0f\u6d1e\uff0c\u53ea\u8981\u50b3\u4e00\u500b\u8a0a\u606f\u7d66\u5c0d\u65b9\uff0c\u5c31\u80fd\u5728\u5c0d\u65b9\u7684\u96fb\u8166\u4e0a\u57f7\u884c\u7a0b\u5f0f\u78bc\uff01\u9019\u500b\u6f0f\u6d1e\u5728 Pwn2Own \u4e0a\u62ff\u5230\u4e86 15 \u842c\u7f8e\u91d1\u7684\u734e\u91d1\uff0c\u6298\u5408\u53f0\u5e63\u7d04 480 \u842c\u3002"),(0,l.kt)("p",null,"Teams \u7684\u684c\u9762\u7248\u8edf\u9ad4\u662f\u7528 Electron \u88fd\u4f5c\u800c\u6210\uff0c\u56e0\u6b64\u672c\u8cea\u4e0a\u5c31\u662f\u4e00\u500b\u7db2\u9801\uff0c\u60f3\u8981\u9054\u6210 RCE\uff0c\u7b2c\u4e00\u6b65\u901a\u5e38\u8981\u5148\u627e\u5230 XSS\uff0c\u8b93\u4f60\u53ef\u4ee5\u5728\u7db2\u9801\u4e0a\u57f7\u884c JavaScript \u7a0b\u5f0f\u78bc\u3002"),(0,l.kt)("p",null,"\u800c Teams \u5c0d\u65bc\u4f7f\u7528\u8005\u7684\u8f38\u5165\u7576\u7136\u4e5f\u6709\u505a\u8655\u7406\uff0c\u524d\u5f8c\u7aef\u90fd\u6709 sanitizer \u628a\u5947\u602a\u7684\u6771\u897f\u62ff\u6389\uff0c\u78ba\u4fdd\u6700\u5f8c render \u51fa\u4f86\u7684\u6771\u897f\u6c92\u6709\u554f\u984c\u3002\u5118\u7ba1\u53ef\u4ee5\u63a7\u5236\u90e8\u5206\u7684 HTML\uff0c\u4f46\u662f\u8a31\u591a\u5c6c\u6027\u8ddf\u5167\u5bb9\u90fd\u88ab\u904e\u6ffe\u6389\u4e86\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\u8aaa\u5c31\u9023 class \u597d\u4e86\uff0c\u4e5f\u53ea\u5141\u8a31\u90e8\u5206\u7684 class name\u3002\u800c Masato \u767c\u73fe sanitizer \u5c0d\u65bc class name \u7684\u8655\u7406\u6709\u4e00\u4e9b\u64cd\u4f5c\u7a7a\u9593\uff0c\u4f8b\u5982\u8aaa\u6709\u500b\u898f\u5247\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"swift-*"),"\uff0c\u90a3 ",(0,l.kt)("inlineCode",{parentName:"p"},"swift-abc")," \u8ddf ",(0,l.kt)("inlineCode",{parentName:"p"},"swift-;[]()'%")," \u90fd\u662f\u5141\u8a31\u7684 class name\u3002"),(0,l.kt)("p",null,"\u53ef\u662f\u53ea\u80fd\u64cd\u63a7 class name \u6709\u4ec0\u9ebc\u7528\u5462\uff1f"),(0,l.kt)("p",null,"\u91cd\u9ede\u4f86\u4e86\uff0cTeams \u7684\u7db2\u9801\u662f\u7528 AngularJS \u5beb\u7684\uff0c\u800c AngularJS \u6709\u4e00\u5806\u795e\u5947\u7684\u529f\u80fd\u5b58\u5728\u3002\u6709\u4e00\u500b\u53eb\u505a ",(0,l.kt)("inlineCode",{parentName:"p"},"ng-init")," \u7684\u5c6c\u6027\u53ef\u4ee5\u7528\u4f86\u521d\u59cb\u5316\uff0c\u50cf\u9019\u6a23\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<body>\n  <div ng-app>\n    <div ng-init="name=\'test\'">\n      {{ name }}\n    </div>\n  </div>\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"><\/script>\n</body>\n</html>\n')),(0,l.kt)("p",null,"\u5c31\u6703\u5728\u9801\u9762\u4e0a\u986f\u793a ",(0,l.kt)("inlineCode",{parentName:"p"},"test"),"\uff0c\u7531\u6b64\u53ef\u898b ",(0,l.kt)("inlineCode",{parentName:"p"},"ng-init")," \u88e1\u9762\u7684\u7a0b\u5f0f\u78bc\u662f\u6703\u88ab\u57f7\u884c\u7684\u3002"),(0,l.kt)("p",null,"\u6240\u4ee5\u5982\u679c\u4f60\u6539\u6210 ",(0,l.kt)("inlineCode",{parentName:"p"},"ng-init=\"constructor.constructor('alert(1)')()\""),"\uff0c\u5c31\u6703\u8df3\u4e00\u500b alert \u51fa\u4f86\u3002"),(0,l.kt)("p",null,"\u90a3\u9019\u500b\u8ddf\u525b\u525b\u8b1b\u7684 class name \u6709\u4ec0\u9ebc\u95dc\u4fc2\u5462\uff1f\u56e0\u70ba\u9019\u500b ",(0,l.kt)("inlineCode",{parentName:"p"},"ng-init")," \u5c45\u7136\u4e5f\u80fd\u7528\u5728 class name \u88e1\u9762\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},"<div class=\"ng-init:constructor.constructor('alert(1)')()\">\n</div>\n")),(0,l.kt)("p",null,"\u56e0\u6b64\uff0c\u7d50\u5408\u524d\u9762\u8b1b\u7684 class name \u7684\u6aa2\u67e5\u898f\u5247\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u69cb\u9020\u51fa\u542b\u6709\u4e0a\u9762 payload \u7684 class name\uff0c\u6210\u529f\u57f7\u884c XSS\u3002"),(0,l.kt)("p",null,"\u539f\u6587\u5176\u5be6\u9084\u6709\u4e00\u6bb5\u662f\u53bb\u627e AngularJS \u600e\u9ebc\u89e3\u6790 class name \u4ee5\u53ca\u91dd\u5c0d\u9019\u500b\u7248\u672c\u7684 AngularJS sandbox bypass\uff0c\u627e\u5230 XSS \u4e4b\u5f8c\u8981\u8b8a\u6210 RCE \u4e5f\u9700\u8981\u82b1\u8cbb\u4e00\u756a\u529f\u592b\uff0c\u4f46\u56e0\u70ba\u9019\u4e9b\u8ddf\u9019\u7bc7\u8981\u8b1b\u7684 CSTI \u7121\u95dc\u6240\u4ee5\u5c31\u8df3\u904e\u4e86\uff0c\u5f88\u63a8\u85a6\u5927\u5bb6\u53bb\u770b\u539f\u672c\u7684\u6295\u5f71\u7247\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://speakerdeck.com/masatokinugawa/how-i-hacked-microsoft-teams-and-got-150000-dollars-in-pwn2own"},"How I Hacked Microsoft Teams and got $150,000 in Pwn2Own")),(0,l.kt)("p",null,"\uff08\u8a71\u8aaa Masato \u771f\u7684\u5f88\u5f37\uff0c\u5f88\u591a\u7bc7\u6280\u8853\u6587\u7ae0\u90fd\u8b93\u6211\u6b4e\u70ba\u89c0\u6b62\uff0c\u7121\u8ad6\u662f\u5c0d\u65bc\u524d\u7aef\u3001JavaScript \u6216\u662f AngularJS \u7684\u7406\u89e3\u90fd\u662f\u9802\u5c16\u7684\uff0c\u6211\u6709\u5e78\u8ddf\u4ed6\u5171\u4e8b\u904e\u4e00\u9663\u5b50\uff0c\u8fd1\u8ddd\u96e2\u611f\u53d7\u5230\u4ed6\u7684\u53b2\u5bb3\uff09"),(0,l.kt)("h2",{id:"angularjs-\u8207-csp-bypass"},"AngularJS \u8207 CSP bypass"),(0,l.kt)("p",null,"AngularJS \u5728\u5be6\u6230\u4e2d\u6700\u5e38\u88ab\u62ff\u4f86\u5229\u7528\u7684\u5c31\u662f CSP bypass \u4e86\uff0c\u53ea\u8981\u4f60\u80fd\u5728 CSP \u5141\u8a31\u7684\u8def\u5f91\u4e2d\u627e\u5230 AngularJS\uff0c\u5c31\u6709\u5f88\u5927\u7684\u6a5f\u7387\u80fd\u7e5e\u904e\uff0c\u8209\u4f8b\u4f86\u8aaa\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta http-equiv="Content-Security-Policy" content="script-src https://cdnjs.cloudflare.com">\n</head>\n<body>\n  <div ng-app ng-csp>\n    <input id=x autofocus ng-focus=$event.composedPath()|orderBy:\'(z=alert)(1)\'>\n  </div>\n\n  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"><\/script>\n</body>\n</html>\n')),(0,l.kt)("p",null,"CSP \u7b97\u662f\u56b4\u683c\uff0c\u53ea\u5141\u8a31\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"https://cdnjs.cloudflare.com"),"\uff0c\u4f46\u9019\u4f7f\u5f97\u6211\u5011\u53ef\u4ee5\u5f15\u5165 AngularJS\uff0c\u5c31\u8b8a\u6210\u4e86 XSS\u3002"),(0,l.kt)("p",null,"\u96d6\u7136\u770b\u8d77\u4f86\u7c21\u55ae\u5bb9\u6613\uff0c\u4f46\u4ed4\u7d30\u60f3\u4e00\u4e0b\u6703\u767c\u73fe\u5176\u5be6\u5f88\u4e0d\u5bb9\u6613\u3002\u4f60\u60f3\u60f3\u770b\uff0cCSP \u88e1\u9762\u4e26\u6c92\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"unsafe-eval"),"\uff0c\u56e0\u6b64\u6240\u6709\u7684\u5b57\u4e32\u90fd\u4e0d\u80fd\u88ab\u7576\u4f5c\u7a0b\u5f0f\u78bc\u57f7\u884c\uff0c\u4f46\u5982\u679c\u662f\u9019\u6a23\u7684\u8a71\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"ng-focus")," \u90a3\u88e1\u9762\u4e00\u5927\u5806\u7684\u5b57\u4e32\u662f\u600e\u9ebc\u88ab\u57f7\u884c\u7684\uff1f\u9019\u4e0d\u5c31\u662f\u628a\u5b57\u4e32\u7576\u7a0b\u5f0f\u78bc\u57f7\u884c\u55ce\uff1f"),(0,l.kt)("p",null,"\u9019\u5c31\u662f AngularJS \u53b2\u5bb3\u7684\u5730\u65b9\u4e86\uff0c\u5728\u9810\u8a2d\u7684\u6a21\u5f0f\u5e95\u4e0b\uff0cAngularJS \u6703\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"eval")," \u4e4b\u985e\u7684\u6771\u897f\u89e3\u6790\u4f60\u50b3\u9032\u53bb\u7684\u5b57\u4e32\uff0c\u4f46\u5982\u679c\u4f60\u52a0\u4e0a\u4e86 ",(0,l.kt)("a",{parentName:"p",href:"https://docs.angularjs.org/api/ng/directive/ngCsp"},"ng-csp"),"\uff0c\u5c31\u662f\u544a\u8a34 AngularJS \u5207\u63db\u5230\u5225\u7684\u6a21\u5f0f\uff0c\u5b83\u6703\u7528\u81ea\u5df1\u5be6\u4f5c\u7684\u76f4\u8b6f\u5668\uff08interpreter\uff09\u53bb\u89e3\u6790\u5b57\u4e32\u4e26\u57f7\u884c\u76f8\u5c0d\u61c9\u7684\u52d5\u4f5c\u3002"),(0,l.kt)("p",null,"\u56e0\u6b64\uff0c\u4f60\u53ef\u4ee5\u60f3\u6210\u662f AngularJS \u81ea\u5df1\u5be6\u4f5c\u4e86\u4e00\u5957 ",(0,l.kt)("inlineCode",{parentName:"p"},"eval"),"\uff0c\u624d\u80fd\u5728\u4e0d\u4f7f\u7528\u9019\u4e9b\u9810\u8a2d\u51fd\u5f0f\u7684\u72c0\u6cc1\u4e0b\u628a\u5b57\u4e32\u7576\u4f5c\u7a0b\u5f0f\u78bc\u4f86\u57f7\u884c\u3002"),(0,l.kt)("p",null,"\u4e4b\u524d\u5728\u8b1b CSP \u7e5e\u904e\u7684\u6642\u5019\uff0c\u6211\u6709\u63d0\u904e\u85c9\u7531\u628a\u8def\u5f91\u8a2d\u5b9a\u7684\u56b4\u8b39\u4e00\u9ede\uff0c\u53ef\u4ee5\u300c\u964d\u4f4e\u98a8\u96aa\u300d\uff0c\u800c\u4e0d\u662f\u300c\u5b8c\u5168\u6d88\u9664\u98a8\u96aa\u300d\uff0c\u8209\u7684\u4f8b\u5b50\u662f\u8a2d\u5b9a\u6210 ",(0,l.kt)("inlineCode",{parentName:"p"},"https://www.google.com/recaptcha/"),"\uff0c\u800c\u4e0d\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"https://www.google.com"),"\u3002"),(0,l.kt)("p",null,"\u4e8b\u5be6\u4e0a\u5728 GoogleCTF 2023 \u4e2d\uff0c\u6709\u4e00\u9053\u984c\u76ee\u5c31\u662f\u8981\u4f60\u7e5e\u904e ",(0,l.kt)("inlineCode",{parentName:"p"},"https://www.google.com/recaptcha/")," \u7684 CSP\uff0c\u89e3\u6cd5\u6b63\u662f\u5229\u7528\u4e86 AngularJS\uff0c\u9019\u5c31\u662f\u70ba\u4ec0\u9ebc\u6211\u8aaa\u8def\u5f91\u56b4\u8b39\u53ef\u4ee5\u964d\u4f4e\u98a8\u96aa\uff0c\u4f46\u6c92\u8fa6\u6cd5\u5b8c\u5168\u907f\u514d\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta http-equiv="Content-Security-Policy" content="script-src https://www.google.com/recaptcha/">\n</head>\n<body>\n  <div\n    ng-controller="CarouselController as c"\n    ng-init="c.init()"\n  >\n  [[c.element.ownerDocument.defaultView.alert(1)]]\n  <div carousel><div slides></div></div>\n\n  <script src="https://www.google.com/recaptcha/about/js/main.min.js"><\/script>\n</body>\n</html>\n')),(0,l.kt)("p",null,"\u5982\u679c\u5c0d AngularJS CSP bypass \u6709\u66f4\u591a\u8208\u8da3\uff0c\u53ef\u4ee5\u53c3\u8003\u6211\u4ee5\u524d\u5beb\u904e\u7684\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://blog.huli.tw/2022/09/01/angularjs-csp-bypass-cdnjs/"},"\u81ea\u52d5\u5316\u5c0b\u627e AngularJS CSP Bypass \u4e2d prototype.js \u7684\u66ff\u4ee3\u54c1"),"\uff0c\u88e1\u9762\u6709\u4ecb\u7d39\u53e6\u5916\u4e00\u7a2e\u7e5e\u904e\u65b9\u5f0f\u3002"),(0,l.kt)("h2",{id:"\u5c0f\u7d50"},"\u5c0f\u7d50"),(0,l.kt)("p",null,"\u9019\u6b21\u8b1b\u7684 CSTI \u4e5f\u7b97\u662f\u4e00\u7a2e\u300c\u4e0d\u76f4\u63a5\u57f7\u884c JavaScript\u300d\u7684\u653b\u64ca\u65b9\u5f0f\u3002"),(0,l.kt)("p",null,"\u7576\u4f60\u628a\u8f38\u51fa\u90fd\u505a\u7de8\u78bc\u4ee5\u70ba\u5f88\u5b89\u5168\u7684\u6642\u5019\uff0c\u537b\u5fd8\u8a18\u81ea\u5df1\u524d\u7aef\u6709\u8457 AngularJS\uff0c\u653b\u64ca\u8005\u53ea\u8981\u7528\u770b\u4f3c\u5b89\u5168\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"{{}}")," \u5c31\u53ef\u4ee5\u900f\u904e CSTI \u9054\u6210 XSS\u3002"),(0,l.kt)("p",null,"\u96d6\u7136\u8aaa\u73fe\u5728\u6709 AngularJS \u7684\u7db2\u7ad9\u5df2\u7d93\u8d8a\u4f86\u8d8a\u5c11\u4e86\uff0c\u4e5f\u6bd4\u8f03\u4e0d\u6703\u6709\u4eba\u628a\u4f7f\u7528\u8005\u7684\u8f38\u5165\u7576\u4f5c\u662f template \u7684\u4e00\u90e8\u5206\uff0c\u4f46\u9019\u4e16\u754c\u4e0d\u7f3a\u5c11\u6f0f\u6d1e\uff0c\u800c\u662f\u7f3a\u5c11\u767c\u73fe\uff0c\u5f88\u591a\u6f0f\u6d1e\u53ea\u662f\u9084\u6c92\u88ab\u767c\u73fe\u800c\u5df2\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u4f60\u5bb6\u7684\u670d\u52d9\u6709\u7528 AngularJS\uff0c\u8a18\u5f97\u78ba\u5b9a\u4e00\u4e0b\u6c92\u6709 CSTI \u7684\u554f\u984c\u3002"))}u.isMDXComponent=!0}}]);