"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[653],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),h=r,m=u["".concat(l,".").concat(h)]||u[h]||d[h]||o;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6807:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const o={sidebar_position:13},i="Who says you have to execute JavaScript directly to attack?",s={unversionedId:"ch3/attack-without-js",id:"ch3/attack-without-js",title:"Who says you have to execute JavaScript directly to attack?",description:'Up to this point, Chapter 2, "Defense and Bypass for XSS," comes to a close.',source:"@site/i18n/en/docusaurus-plugin-content-docs/current/ch3/13-attack-without-js.md",sourceDirName:"ch3",slug:"/ch3/attack-without-js",permalink:"/beyond-xss/en/ch3/attack-without-js",draft:!1,tags:[],version:"current",sidebarPosition:13,frontMatter:{sidebar_position:13},sidebar:"tutorialSidebar",previous:{title:"The Most Powerful XSS: Universal XSS",permalink:"/beyond-xss/en/ch2/universal-xss"},next:{title:"Prototype Pollution: Exploiting the Prototype Chain",permalink:"/beyond-xss/en/ch3/prototype-pollution"}},l={},c=[],p={toc:c},u="wrapper";function d(e){let{components:t,...o}=e;return(0,r.kt)(u,(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"who-says-you-have-to-execute-javascript-directly-to-attack"},"Who says you have to execute JavaScript directly to attack?"),(0,r.kt)("p",null,'Up to this point, Chapter 2, "Defense and Bypass for XSS," comes to a close.'),(0,r.kt)("p",null,"We have spent a lot of time discussing XSS, including various ways to execute XSS, defense techniques, and bypass methods. In terms of web front-end, the most serious thing that can be done to a web page is essentially executing code."),(0,r.kt)("p",null,'In the examples of attacks, we basically assume "being able to inject HTML" as a premise and then find ways to transform it into XSS. Although we have only used this simple payload in the previous examples: ',(0,r.kt)("inlineCode",{parentName:"p"},"<img src=x onload=alert(1)>"),", it may not be so easy in real-world scenarios."),(0,r.kt)("p",null,'For example, we briefly mentioned earlier that there is another defense line called WAF, Web Application Firewall, which is a firewall specifically designed for applications. It uses pre-written rules to block "seemingly malicious" payloads.'),(0,r.kt)("p",null,"For instance, Dcard(a social media platform in Taiwan) uses Cloudflare's WAF. You can try clicking on this link: ",(0,r.kt)("a",{parentName:"p",href:"https://www.dcard.tw/?a=%3Cscript%3E"},"https://www.dcard.tw/?a=%3Cscript%3E")),(0,r.kt)("p",null,"You will see a blocked message:"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(1567).Z,width:"1064",height:"813"})),(0,r.kt)("p",null,"The most well-known open-source WAF is ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SpiderLabs/ModSecurity"},"ModSecurity"),", which provides an infrastructure for engineers to add their own blocking rules or use ones written by others."),(0,r.kt)("p",null,"For example, the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/coreruleset/coreruleset/tree/v4.0/dev"},"OWASP ModSecurity Core Rule Set (CRS)")," is an open-source collection of rules. Let's take a look at a small section:"),(0,r.kt)("p",null,"Source: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/coreruleset/coreruleset/blob/v4.0/dev/rules/REQUEST-941-APPLICATION-ATTACK-XSS.conf#L105"},"coreruleset/rules/REQUEST-941-APPLICATION-ATTACK-XSS.conf")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-conf"},"#\n# -=[ XSS Filters - Category 1 ]=-\n# http://xssplayground.net23.net/xssfilter.html\n# script tag based XSS vectors, e.g., <script> alert(1)<\/script>\n#\nSecRule REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|REQUEST_HEADERS:User-Agent|REQUEST_HEADERS:Referer|ARGS_NAMES|ARGS|XML:/* \"@rx (?i)<script[^>]*>[\\s\\S]*?\" \\\n    \"id:941110,\\\n    phase:2,\\\n    block,\\\n    capture,\\\n    t:none,t:utf8toUnicode,t:urlDecodeUni,t:htmlEntityDecode,t:jsDecode,t:cssDecode,t:removeNulls,\\\n    msg:'XSS Filter - Category 1: Script Tag Vector',\\\n    logdata:'Matched Data: %{TX.0} found within %{MATCHED_VAR_NAME}: %{MATCHED_VAR}',\\\n    tag:'application-multi',\\\n    tag:'language-multi',\\\n    tag:'platform-multi',\\\n    tag:'attack-xss',\\\n    tag:'paranoia-level/1',\\\n    tag:'OWASP_CRS',\\\n    tag:'capec/1000/152/242',\\\n    ver:'OWASP_CRS/4.0.0-rc1',\\\n    severity:'CRITICAL',\\\n    setvar:'tx.xss_score=+%{tx.critical_anomaly_score}',\\\n    setvar:'tx.inbound_anomaly_score_pl1=+%{tx.critical_anomaly_score}'\"\n")),(0,r.kt)("p",null,"This rule uses the regular expression ",(0,r.kt)("inlineCode",{parentName:"p"},"<script[^>]*>[\\s\\S]*?")," to find code containing ",(0,r.kt)("inlineCode",{parentName:"p"},"<script")," and blocks it. Therefore, ",(0,r.kt)("inlineCode",{parentName:"p"},"<script>alert(1)<\/script>")," will be detected and blocked."),(0,r.kt)("p",null,"There are also other rules corresponding to our favorite ",(0,r.kt)("inlineCode",{parentName:"p"},"<img src=x onerror=alert()>"),", so in practice, we often encounter situations where we think a website is easy to attack, but it turns out to be blocked by WAF. We keep seeing error windows even though the vulnerability exists, but we can't exploit it because of the WAF."),(0,r.kt)("p",null,'This cat-and-mouse game between hackers and websites is one of the interesting aspects of cybersecurity, and it emphasizes the importance of experience and knowledge. Regarding WAF, many WAF bypass payloads often appear on Twitter. To bypass WAF, the content is usually intentionally "disgusting," like this (credit to ',(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/bxmbn/status/1686415626649145344"},"@bxmbn"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<details/open=/Open/href=/data=; ontoggle="(alert)(document.domain)\n')),(0,r.kt)("p",null,"Actually, the content this payload intends to execute is ",(0,r.kt)("inlineCode",{parentName:"p"},"<details open ontoggle=alert(document.domain)>"),", but it uses a bunch of other keywords to obfuscate it. Since many WAFs rely on regular expressions for detection, as long as the payload is not easily recognizable by the WAF, it can be bypassed using this method."),(0,r.kt)("p",null,"But what if it can't be bypassed?"),(0,r.kt)("p",null,"Even if a website can inject HTML, so what? If the payload that can execute XSS cannot be written, does that mean there is no solution? Not necessarily."),(0,r.kt)("p",null,'This kind of thinking usually stems from a limited understanding of front-end security, where XSS is the only known attack. It is often believed that executing code directly is necessary to achieve an attack. In fact, there are many other "indirect attack" methods, and some attack techniques don\'t even require executing JavaScript.'),(0,r.kt)("p",null,"As I mentioned at the beginning of this series, front-end security is a vast universe. We have already spent a lot of time exploring XSS, so it's time to enter a new galaxy! Let's take a short break, and in the next post, we will officially enter Chapter 3: \"Attacks without JavaScript\""),(0,r.kt)("p",null,"In the upcoming content, I will introduce more attack techniques beyond XSS."),(0,r.kt)("p",null,'Chapter 3 will progress step by step, from "indirectly influencing the execution of JavaScript" to "not needing JavaScript at all," and even "not just JavaScript, but also without CSS." We will continuously explore the limits of front-end attacks.'),(0,r.kt)("p",null,"Before entering Chapter 3, you can also think about any \"attack techniques that don't execute JavaScript directly\" that you have heard of. It's very likely that they will be covered in the upcoming content."),(0,r.kt)("p",null,"Finally, let's have a little quiz. Bob is implementing a multiplayer drawing game using a two-dimensional array to represent the canvas. Players can draw any color on any grid, and the array is updated using ",(0,r.kt)("inlineCode",{parentName:"p"},"onmessage"),". The implementation is as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"onmessage = function(event){\n  const { x, y, color } = event.data\n  // for example, screen[10][5] = 'red'\n  screen[y][x] = color\n}\n")),(0,r.kt)("p",null,"What is the problem with this code? We will reveal it in our next post."))}d.isMDXComponent=!0},1567:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/13-01-196dd43ab77bc4c93c53265fe3e0727b.png"}}]);