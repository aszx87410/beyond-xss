"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[975],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),h=i,m=d["".concat(s,".").concat(h)]||d[h]||u[h]||o;return n?a.createElement(m,r(r({ref:t},p),{},{components:n})):a.createElement(m,r({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:i,r[1]=l;for(var c=2;c<o;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6360:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=n(7462),i=(n(7294),n(3905));const o={sidebar_position:4},r="Understanding XSS a Bit More",l={unversionedId:"ch1/know-xss-a-bit-more",id:"ch1/know-xss-a-bit-more",title:"Understanding XSS a Bit More",description:"In the previous post, it was mentioned that attackers need to adjust the XSS payload to ensure effectiveness in different scenarios. For example, if the injection point is in innerHTML, using alert(1) will not have any effect. Therefore, we need to understand XSS a bit more to know what methods can be used for attacks.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/ch1/04-know-xss-a-bit-more.md",sourceDirName:"ch1",slug:"/ch1/know-xss-a-bit-more",permalink:"/beyond-xss/en/ch1/know-xss-a-bit-more",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Starting with XSS for Frontend Security",permalink:"/beyond-xss/en/ch1/xss-introduction"},next:{title:"Dangerous javascript: pseudo protocol",permalink:"/beyond-xss/en/ch1/javascript-protocol"}},s={},c=[{value:"Ways to Execute JavaScript",id:"ways-to-execute-javascript",level:2},{value:"XSS in Different Scenarios and Defense Mechanisms",id:"xss-in-different-scenarios-and-defense-mechanisms",level:2},{value:"HTML Injection",id:"html-injection",level:3},{value:"Attribute Injection",id:"attribute-injection",level:3},{value:"JavaScript Injection",id:"javascript-injection",level:3},{value:"Conclusion",id:"conclusion",level:2}],p={toc:c},d="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"understanding-xss-a-bit-more"},"Understanding XSS a Bit More"),(0,i.kt)("p",null,"In the previous post, it was mentioned that attackers need to adjust the XSS payload to ensure effectiveness in different scenarios. For example, if the injection point is in ",(0,i.kt)("inlineCode",{parentName:"p"},"innerHTML"),", using ",(0,i.kt)("inlineCode",{parentName:"p"},"<script>alert(1)<\/script>")," will not have any effect. Therefore, we need to understand XSS a bit more to know what methods can be used for attacks."),(0,i.kt)("p",null,"Learning about attacks is learning about defense. We must know how to attack in order to know how to defend effectively."),(0,i.kt)("h2",{id:"ways-to-execute-javascript"},"Ways to Execute JavaScript"),(0,i.kt)("p",null,"Once you have control over HTML, there are several ways to execute JavaScript."),(0,i.kt)("p",null,"The most common way is using the ",(0,i.kt)("inlineCode",{parentName:"p"},"<script>")," tag. However, one of its drawbacks is that it can easily be identified by a Web Application Firewall (WAF). Another drawback is that it does not work in the context of ",(0,i.kt)("inlineCode",{parentName:"p"},"innerHTML"),", as mentioned in the previous post."),(0,i.kt)("p",null,"Apart from ",(0,i.kt)("inlineCode",{parentName:"p"},"<script>"),", we can also use other tags combined with inline event handlers to execute code. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<img src="not_exist" onerror="alert(1)">\n')),(0,i.kt)("p",null,"This loads a non-existent image and uses the ",(0,i.kt)("inlineCode",{parentName:"p"},"onerror")," event to execute code."),(0,i.kt)("p",null,"In fact, many people (including myself) use ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," as the ",(0,i.kt)("inlineCode",{parentName:"p"},"src")," because it is easy to write and remember. Usually, the path ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," does not exist, but if it does, ",(0,i.kt)("inlineCode",{parentName:"p"},"onerror")," will not be triggered. Therefore, there is a joke that you can place an image named ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," in the root directory of a website, and some attackers may not discover the XSS vulnerability."),(0,i.kt)("p",null,"Apart from ",(0,i.kt)("inlineCode",{parentName:"p"},"onerror"),", any event handler can be exploited. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<button onclick="alert(1)">Click me, please</button>\n')),(0,i.kt)("p",null,'Clicking the button will trigger an alert. However, the difference with this method is that "the user has to take some action" to trigger XSS, such as clicking the button. In the previous example with the ',(0,i.kt)("inlineCode",{parentName:"p"},"img")," tag, the user does not need to do anything, and XSS will be triggered."),(0,i.kt)("p",null,"For a shorter payload, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"onload")," event of ",(0,i.kt)("inlineCode",{parentName:"p"},"svg"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<svg onload="alert(1)">\n')),(0,i.kt)("p",null,"Here's a little extra knowledge: in HTML, the ",(0,i.kt)("inlineCode",{parentName:"p"},'"')," for attribute values is not necessary. If your content does not have spaces, you can remove them without any problem. Even the spaces between tags and attributes can be replaced with ",(0,i.kt)("inlineCode",{parentName:"p"},"/"),". Therefore, the payload for ",(0,i.kt)("inlineCode",{parentName:"p"},"svg")," can be written like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},"<svg/onload=alert(1)>\n")),(0,i.kt)("p",null,"No spaces or quotation marks are needed to construct an XSS payload."),(0,i.kt)("p",null,"Commonly exploited event handlers include:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"onerror"),(0,i.kt)("li",{parentName:"ol"},"onload"),(0,i.kt)("li",{parentName:"ol"},"onfocus"),(0,i.kt)("li",{parentName:"ol"},"onblur"),(0,i.kt)("li",{parentName:"ol"},"onanimationend"),(0,i.kt)("li",{parentName:"ol"},"onclick"),(0,i.kt)("li",{parentName:"ol"},"onmouseenter")),(0,i.kt)("p",null,'Apart from these event handlers starting with "on," there is another way to execute code that frontend developers may have seen:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},"<a href=javascript:void(0)>Link</a>\n")),(0,i.kt)("p",null,"This is used to make the element unresponsive when clicked. From this example, we can see that we can use ",(0,i.kt)("inlineCode",{parentName:"p"},"href")," to execute code, like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},"<a href=javascript:alert(1)>Link</a>\n")),(0,i.kt)("p",null,"To summarize, there are several ways to execute JavaScript in HTML:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"<script>")," tag"),(0,i.kt)("li",{parentName:"ol"},"Event handlers in attributes (starting with ",(0,i.kt)("inlineCode",{parentName:"li"},"on"),")"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"javascript:")," pseudo-protocol")),(0,i.kt)("p",null,"Knowing these methods, you can use them in different scenarios."),(0,i.kt)("p",null,"If you want to learn more payloads, you can refer to the ",(0,i.kt)("a",{parentName:"p",href:"https://portswigger.net/web-security/cross-site-scripting/cheat-sheet"},"Cross-site scripting (XSS) cheat sheet"),", which contains various types of payloads."),(0,i.kt)("h2",{id:"xss-in-different-scenarios-and-defense-mechanisms"},"XSS in Different Scenarios and Defense Mechanisms"),(0,i.kt)("p",null,"Usually, the places where payloads can be injected are referred to as injection points. In the following code snippet:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},"<div>\n  Hello, <span id=\"name\"></span>\n</div>\n<script>\n  const qs = new URLSearchParams(window.location.search)\n  const name = qs.get('name')\n  document.querySelector('#name').innerHTML = name\n<\/script>\n")),(0,i.kt)("p",null,"The injection point is in the line ",(0,i.kt)("inlineCode",{parentName:"p"},"document.querySelector('#name').innerHTML = name"),"."),(0,i.kt)("p",null,"Different injection points affect how attacks can be carried out and how to defend against them. Let's categorize three different scenarios."),(0,i.kt)("h3",{id:"html-injection"},"HTML Injection"),(0,i.kt)("p",null,"This is the most common scenario, whether it's the example above or the PHP code snippet below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n echo \"Hello, <h1>\" . $_GET['name'] . '</h1>';\n?>\n")),(0,i.kt)("p",null,"These two cases both involve manipulating a blank HTML provided to you, so you can directly write any desired elements, which provides a lot of freedom."),(0,i.kt)("p",null,"For example, using the commonly seen payload ",(0,i.kt)("inlineCode",{parentName:"p"},"<img src=not_exist onerror=alert(1)>")," can execute JavaScript."),(0,i.kt)("p",null,"The defense method is to replace all occurrences of ",(0,i.kt)("inlineCode",{parentName:"p"},"<")," and ",(0,i.kt)("inlineCode",{parentName:"p"},">")," in user input. By doing so, they won't be able to insert new HTML tags and won't be able to do anything."),(0,i.kt)("h3",{id:"attribute-injection"},"Attribute Injection"),(0,i.kt)("p",null,"Sometimes you may encounter code like the following, where the input content is used as the value of an attribute enclosed within the attribute:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},"<div id=\"content\"></div>\n<script>\n  const qs = new URLSearchParams(window.location.search)\n  const clazz = qs.get('clazz')\n  document.querySelector('#content').innerHTML = `\n    <div class=\"${clazz}\">\n      Demo\n    </div>\n  `\n<\/script>\n")),(0,i.kt)("p",null,"In this case, using the aforementioned ",(0,i.kt)("inlineCode",{parentName:"p"},"<img src=not_exist onerror=alert(1)>")," won't work because the input value is treated as the content of the attribute."),(0,i.kt)("p",null,"To execute XSS in this scenario, you can escape the attribute and close the tag, like this: ",(0,i.kt)("inlineCode",{parentName:"p"},'"><img src=not_exist onerror=alert(1)>'),". This way, the entire HTML will become:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<div class=""><img src=not_exist onerror=alert(1)>">\n  Demo\n</div>\n')),(0,i.kt)("p",null,"After escaping the attribute, you can insert the desired HTML tags."),(0,i.kt)("p",null,"From this case, you can see why I mentioned that the context is important. If you think that XSS only occurs in the first scenario I mentioned and only handle the ",(0,i.kt)("inlineCode",{parentName:"p"},"<>")," characters, it will be ineffective in this context because the attacker can attack without using new tags."),(0,i.kt)("p",null,"For example, using the payload ",(0,i.kt)("inlineCode",{parentName:"p"},'" tabindex=1 onfocus="alert(1)" x="'),", which doesn't contain ",(0,i.kt)("inlineCode",{parentName:"p"},"<>")," at all, the HTML will become:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<div class="" tabindex=1 onfocus="alert(1)" x="">\n  Demo\n</div>\n')),(0,i.kt)("p",null,"Unlike adding new HTML tags, this attack method utilizes the ",(0,i.kt)("inlineCode",{parentName:"p"},"onfocus")," event of the original ",(0,i.kt)("inlineCode",{parentName:"p"},"div")," tag to execute XSS. Therefore, when filtering, in addition to ",(0,i.kt)("inlineCode",{parentName:"p"},"<>"),", the ",(0,i.kt)("inlineCode",{parentName:"p"},"'")," and ",(0,i.kt)("inlineCode",{parentName:"p"},'"')," characters also need to be encoded."),(0,i.kt)("p",null,"Additionally, this is why you should avoid writing code like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"document.querySelector('#content').innerHTML = `\n  <div class=${clazz}>\n    Demo\n  </div>\n")),(0,i.kt)("p",null,"The above attribute is not enclosed in ",(0,i.kt)("inlineCode",{parentName:"p"},'"')," or ",(0,i.kt)("inlineCode",{parentName:"p"},"'"),", so even if we think we have protected it by encoding ",(0,i.kt)("inlineCode",{parentName:"p"},"<>\"'"),", the attacker can still add other attributes using spaces."),(0,i.kt)("h3",{id:"javascript-injection"},"JavaScript Injection"),(0,i.kt)("p",null,"In addition to HTML, sometimes user input is reflected in JavaScript, for example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"<script>\n  const name = \"<?php echo $_GET['name'] ?>\";\n  alert(name);\n<\/script>\n")),(0,i.kt)("p",null,"If you only look at this code snippet, you might think that encoding ",(0,i.kt)("inlineCode",{parentName:"p"},'"')," is enough because it prevents breaking out of the string. However, this approach is problematic because the attacker can close the tag with ",(0,i.kt)("inlineCode",{parentName:"p"},"<\/script>")," and then inject other tags, and so on."),(0,i.kt)("p",null,"So, in this context, just like before, you need to encode ",(0,i.kt)("inlineCode",{parentName:"p"},"<>\"'")," to prevent the attacker from escaping the string."),(0,i.kt)("p",null,"However, even with this, you still need to be aware that if you add an empty line in the input, the entire code snippet will fail to execute due to the line break, resulting in a ",(0,i.kt)("inlineCode",{parentName:"p"},"SyntaxError"),"."),(0,i.kt)("p",null,"What if it's a situation like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"<script>\n  const name = `\n    Hello,\n    <?php echo $_GET['name'] ?>\n  `;\n  alert(name);\n<\/script>\n")),(0,i.kt)("p",null,"In this case, you can inject JavaScript code using the ",(0,i.kt)("inlineCode",{parentName:"p"},"${alert(1)}"),' syntax, achieving XSS. Although frontend engineers know that this can cause issues just by looking at it, not every engineer may be aware of it. Perhaps this code was written by a backend engineer who simply thought, "If a multiline string is needed, use this symbol," without realizing its meaning and potential dangers.'),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"In this article, we have learned more about XSS, understood the different ways JavaScript can be executed, and realized that the necessary defenses vary depending on the context."),(0,i.kt)("p",null,"However, does encoding ",(0,i.kt)("inlineCode",{parentName:"p"},"<>\"'")," guarantee complete security? That's not necessarily the case."),(0,i.kt)("p",null,"There is a commonly overlooked situation that was briefly mentioned in this article but not discussed in detail. We will cover it in the next article."),(0,i.kt)("p",null,"Before moving on to the next article, let's have a brainstorming session. I mentioned earlier that there are basically three ways to execute JavaScript:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"<script>")," tag"),(0,i.kt)("li",{parentName:"ol"},"Event handlers in attributes (always starting with ",(0,i.kt)("inlineCode",{parentName:"li"},"on"),")"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"javascript:")," pseudo-protocol")),(0,i.kt)("p",null,"If the first method, like ",(0,i.kt)("inlineCode",{parentName:"p"},"innerHTML = '<script>alert(1)<\/script>'"),", doesn't work."),(0,i.kt)("p",null,"If event handlers and ",(0,i.kt)("inlineCode",{parentName:"p"},"javascript:")," pseudo-protocol cannot be used, and the injection point is ",(0,i.kt)("inlineCode",{parentName:"p"},"innerHTML = data"),", what other ways can be used to execute scripts? Take a moment to think about it."))}u.isMDXComponent=!0}}]);