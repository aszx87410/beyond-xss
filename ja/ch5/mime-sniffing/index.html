<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-ch5/mime-sniffing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">MIMEスニッフィングを利用した攻撃 | Beyond XSS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aszx87410.github.io/beyond-xss/ja/img/cover.png"><meta data-rh="true" name="twitter:image" content="https://aszx87410.github.io/beyond-xss/ja/img/cover.png"><meta data-rh="true" property="og:url" content="https://aszx87410.github.io/beyond-xss/ja/ch5/mime-sniffing/"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="google-site-verification" content="O7SjDEO9AQXbxqBWhtUW0FVahHxSrnweMXJxLICpSz4"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MIMEスニッフィングを利用した攻撃 | Beyond XSS"><meta data-rh="true" name="description" content="すべてのレスポンスには、通常、ブラウザにレスポンスのMIMEタイプ（text/htmlやapplication/jsonなど）を伝えるContent-Typeというレスポンスヘッダーがあります。"><meta data-rh="true" property="og:description" content="すべてのレスポンスには、通常、ブラウザにレスポンスのMIMEタイプ（text/htmlやapplication/jsonなど）を伝えるContent-Typeというレスポンスヘッダーがあります。"><link data-rh="true" rel="icon" href="/beyond-xss/ja/img/logo.png"><link data-rh="true" rel="canonical" href="https://aszx87410.github.io/beyond-xss/ja/ch5/mime-sniffing/"><link data-rh="true" rel="alternate" href="https://aszx87410.github.io/beyond-xss/en/ch5/mime-sniffing/" hreflang="en"><link data-rh="true" rel="alternate" href="https://aszx87410.github.io/beyond-xss/ch5/mime-sniffing/" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://aszx87410.github.io/beyond-xss/ja/ch5/mime-sniffing/" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aszx87410.github.io/beyond-xss/ch5/mime-sniffing/" hreflang="x-default"><link rel="stylesheet" href="/beyond-xss/ja/assets/css/styles.32fcb3bb.css">
<link rel="preload" href="/beyond-xss/ja/assets/js/runtime~main.531fd90e.js" as="script">
<link rel="preload" href="/beyond-xss/ja/assets/js/main.b4cb8381.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/beyond-xss/ja/"><div class="navbar__logo"><img src="/beyond-xss/ja/img/logo.png" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/beyond-xss/ja/img/logo.png" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Beyond XSS：Webフロントエンドセキュリティの世界を探る</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>日本語</a><ul class="dropdown__menu"><li><a href="/beyond-xss/en/ch5/mime-sniffing/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/beyond-xss/ch5/mime-sniffing/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-TW">中文（台灣）</a></li><li><a href="/beyond-xss/ja/ch5/mime-sniffing/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ja">日本語</a></li></ul></div><a href="https://github.com/aszx87410/beyond-xss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/beyond-xss/ja/">このシリーズについて</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">第一章：XSSから見たフロントエンド・セキュリティ</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch1/browser-security-model/">ブラウザのセキュリティモデル</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch1/xss-introduction/">XSSから始めるフロントエンドのセキュリティ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch1/know-xss-a-bit-more/">XSSについてもう少し詳しく</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch1/javascript-protocol/">危険な javascript: 疑似スキーム</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">第二章：XSSの防御と回避</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/xss-defense-sanitization/">XSSの第一の防御線：サニタイズ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/xss-defense-csp/">XSSの第二の防御線：CSP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/token-storage/">XSSの第三の防御線：影響範囲の縮小</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/trust-types/">最新のXSS防御：Trusted Typesと組み込みSanitizer API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/csp-bypass/">防御の回避：一般的なCSPバイパス</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/mutation-xss/">防御の回避：Mutation XSS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch2/universal-xss/">最強のXSS：Universal XSS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">第三章：JavaScriptを使わない攻撃</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/attack-without-js/">攻撃にJavaScriptを直接実行する必要があるなんて誰が言った？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/prototype-pollution/">プロトタイプチェーンを悪用した攻撃：Prototype Pollution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/dom-clobbering/">HTMLもJavaScriptに影響を与える？DOM clobbering入門</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/csti/">フロントエンドのテンプレートインジェクション攻撃：CSTI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/css-injection/">CSSだけで攻撃できる？CSSインジェクション（前編）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/css-injection-2/">CSSだけで攻撃できる？CSSインジェクション（後編）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch3/html-attack/">HTMLだけで攻撃できる？</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">第四章：クロスサイト攻撃</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/sop-and-site/">最重要：同一オリジンポリシーとサイト</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/cors-intro/">クロスオリジンリソース共有 CORS 基本紹介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/cors-attack/">クロスオリジンセキュリティの問題</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/csrf/">クロスサイトリクエストフォージェリ（CSRF）を簡単に理解する</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/same-site-cookie/">Same-site Cookie、CSRFの救世主？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/subdomain/">Same-Siteからメインサイトへ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch4/cookie-bomb/">面白くて実用的なCookie Bomb</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">第五章：その他の興味深いフロントエンド・セキュリティのトピック</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/clickjacking/">あなたの画面はあなたの画面ではない：クリックジャッキング</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/beyond-xss/ja/ch5/mime-sniffing/">MIMEスニッフィングを利用した攻撃</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/supply-chain-attack/">フロントエンドサプライチェーン攻撃：上流から下流への攻撃</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/web3-attacks/">Web3におけるウェブフロントエンド攻撃の応用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/xsleaks-1/">最も興味深いフロントエンドサイドチャネル攻撃：XSLeaks（パート1）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/beyond-xss/ja/ch5/xsleaks-2/">最も興味深いフロントエンドサイドチャネル攻撃：XSLeaks（パート2）</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/beyond-xss/ja/summary/">まとめ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/beyond-xss/ja/contact/">著者への連絡</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/beyond-xss/ja/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">第五章：その他の興味深いフロントエンド・セキュリティのトピック</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MIMEスニッフィングを利用した攻撃</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><h1>MIMEスニッフィングを利用した攻撃</h1><p>すべてのレスポンスには、通常、ブラウザにレスポンスのMIMEタイプ（<code>text/html</code>や<code>application/json</code>など）を伝える<code>Content-Type</code>というレスポンスヘッダーがあります。</p><p>しかし、<code>Content-Type</code>ヘッダーがない場合はどうなるでしょうか？ブラウザはファイルの内容に基づいてタイプを決定しようとします。<code>Content-Type</code>ヘッダーが存在する場合でも、ブラウザはそれを異なるタイプとして解釈することがあります。</p><p>ファイルの内容からMIMEタイプを推測するこの動作は、MIMEスニッフィングと呼ばれます。この機能について一緒に探ってみましょう！</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mimeスニッフィング入門">MIMEスニッフィング入門<a href="#mimeスニッフィング入門" class="hash-link" aria-label="MIMEスニッフィング入門 への直接リンク" title="MIMEスニッフィング入門 への直接リンク">​</a></h2><p>Expressを使用して、<code>Content-Type</code>ヘッダーのないレスポンスを簡単に出力できます。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> express </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;express&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;&lt;h1&gt;hello&lt;/h1&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5555</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Server is running on port 5555&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>このウェブページをブラウザで開くと、「hello」というテキストが大きく太字になり、ブラウザがレスポンスをウェブページとしてレンダリングしていることがわかります。</p><p><img loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAakAAACuCAYAAACMXvJXAAABXGlDQ1BJQ0MgUHJvZmlsZQAAKJFtkE1LAnEQxp81QykLD9EhOngJCrYQlQ7dzNAED4smvUDQupoGvvxbNyK69hmiT9Cpc3aULn0Ao8BjBF0DwQ4l2/PXSq0GhvnxMDM8M4DDqwtRdAIolS0zGVv1bW3v+FwvcGMCk1AQ1I2qCGtagi34rsPRfmAfo7Eod502nuaV5nRLvfW8Rd3X/r/9QzGWzVUN1g/msiFMC1BCZO3YEpLPyFMmTZEvJOd7fCU50+N6t2cjGSHfk71GQc+Sn8lqZkDPD3CpeGR8eZDuPblyOsU6w5xFAjH4EIeGFGsUaSoJrGONf/p/LtSdi6ACgROYOEAeBVicDlMRKCLX3ViGgSWo5AD8zKD89+8/9rVD3rcSBxylvranATev8sy+NqfSyh1Q3xW6qf98V2k7q/vBQI/Ha8DouW23NgHXAtB5tO33mm13LoGRJmfbn5ONY5tkAuSrAAAAVmVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADkoYABwAAABIAAABEoAIABAAAAAEAAAGpoAMABAAAAAEAAACuAAAAAEFTQ0lJAAAAU2NyZWVuc2hvdICdXxcAAAHWaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjE3NDwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj40MjU8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpVc2VyQ29tbWVudD5TY3JlZW5zaG90PC9leGlmOlVzZXJDb21tZW50PgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KqSRyAAAADwNJREFUeAHt3WeoHFUbB/ATDTZQox/UqKjYSxRBBBWxfxUVbNiIKFhQwYIiCjYEEQRRP6gg9oKiqCiCHyxgYkXE2HuP5oPYC2ruu2d9c9+7s7P3bm5u3Of1+Q2E7MyenX3O7xzun9mdmZ21YOHCsWIhQIAAAQIBBWaNdZaAdSmJAAECBAiUVRgQIECAAIGoAkIq6sioiwABAgQcSZkDBAgQIBBXwJFU3LFRGQECBNILCKn0UwAAAQIE4goIqbhjozICBAikFxBS6acAAAIECMQVEFJxx0ZlBAgQSC8gpNJPAQAECBCIKyCk4o6NyggQIJBeQEilnwIACBAgEFdASMUdG5URIEAgvYCQSj8FABAgQCCugJCKOzYqI0CAQHoBIZV+CgAgQIBAXAEhFXdsVEaAAIH0AkIq/RQAQIAAgbgCQiru2KiMAAEC6QWEVPopAIAAAQJxBYRU3LFRGQECBNILCKn0UwAAAQIE4grMHqa0a665pixevLin6bnnnlvmzp3bsy3aysMPP1yee+658bJWXXXVUuveYIMNxrfVB4sWLSq33357z7a99967HHrooT3brBAgQIDAPyswVEjdcccd5fXXX++pbP78+eFD6oEHHij33HNPT9177bVXOeSQQ3q2vfDCC6UG8cRl6dKlQmoiiMcECBAYgYCP+0aA7i0JECBAYDgBITWck1YECBAgMAIBITUCdG9JgAABAsMJCKnhnLQiQIAAgREICKkRoHtLAgQIEBhOQEgN56QVAQIECIxAYKhT0Cer66+//upei/TUU0+VL774ovzyyy9lu+22K9tvv33Zcccdyy677DLZy1uf+/nnn8ubb77ZvX7ptddeK0uWLOle27ThhhuWPffcs9RrmFZfffXW145i45dfflnefvvtbr1vvPFGt4R58+aVnXfeuWuw8cYbj6Is70mAAIH/e4EVCqlXXnmlHHvsseW9994bCHHccceV66+/vsyZM2dgm2VPfPDBB+W8884rjzzyyLJNA/+/8sory9lnn13WXHPNgW1W5hM1nO+9995y4YUXdsN5svfadNNNy9VXX12OPPLIUi8othAgQIDAcALT/rivBsnuu+8+aUDVEu66667uEcVHH300aUWPPvpo2WabbYYKqLqjiy66qOy6665TBsSkbzrNJ3/88cdy8MEHl+OPP36o969HmMccc0z3IuKffvppmu/qZQQIEMgnMO2Quvjii4fWqn+kr7jiioHtn3zyyb67QAxsPOGJegS37777lq+//nrC1pX78I8//igHHnhgeeKJJ5b7jR5//PFywAEHlLoPCwECBAhMLTDtkJq46/qH95xzzul+nNW8L96ydrfddlt59913l62O///rr7+Wk046aXx94oP6nVZ97vTTTy9HH3103z33att6hFY/+vunlvrR5csvv9z6dttuu22pH2/Wf/Vx21Jfe8MNN7Q9ZRsBAgQINAXGhlg6Jz+MdV7X92/ttdceW7BgQc8evvvuu7HOdy99bevrO2HS07au1G1t+77xxhvH/vzzz572nRMqxi699NLW9p9//nlP27rS+Yitr23nprN97W6++ea+dp3vu/raffrpp33tau3V4fnnn+9rX23qc239a6u3bwc2ECBAILnACh1JPfbYY6XesHXisu6665a777671JMFmssnn3zSs+mzzz7rfrfUs7GzUk8yOOWUU/pOMlhrrbXKJZdc0j2yar6meYPY5vMzsV6PFptLJ4TKSy+9VPbYY4/mU12bF198sdQ2zaXejd1CgAABApMLTDuk9ttvv7LPPvu07n327Nnds/SaTzZDqoZcc6nhVs/am2y56qqr+p6+9tpry/fff9+3faY21I8lH3zwwb7ddY7suqfb9z3x3w077LBDufzyy/uevv/++8vvv//et90GAgQIEPifwLRDqn5HNNnSdn3Uhx9+2POSd955p2e9rhx++OGlhtxkSz0yqd+DNZepziBstl+e9Xp6fNty4okntm3u2VbbtB1NNT16XmSFAAECBMq0Q2rzzTeflK/tAtbm6df1gt3mUo+IZs2aNeW/evFwc6kfH66spe1asHo0ud566035lvUj0ObHovVFbSeSTLkzDQgQIJBIYNoh1RZCE93WWWediautjwedJdfaeIiNKzOk2o76tthiiyGq+rvJlltu2de23qXCQoAAAQKDBaYdUqusMu2XdqvpnLlX6kWxM7l8/PHHM7m7nn199dVXPet1ZdDp9n0NB7Stt1OyECBAgMBggcm//Bn8uhV+pn7vVE+SqBf6Npfl+eM/8bU//PDD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" width="425" height="174" class="img_ev3q"></p><p>次に、2番目の例を見てみましょう。ここでは<code>&lt;h1&gt;</code>を<code>&lt;h2&gt;</code>に変更します。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> express </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;express&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;&lt;h2&gt;hello&lt;/h2&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5555</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Server is running on port 5555&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="data:image/png;base64,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" width="295" height="80" class="img_ev3q"></p><p>あれ、なぜ突然プレーンテキストとして表示されるのでしょうか？</p><p>次に、3番目の例では、同じ<code>&lt;h1&gt;</code>ですが、いくつかの追加テキストがあります。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> express </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;express&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Hello, &lt;h1&gt;world&lt;/h1&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5555</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Server is running on port 5555&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="data:image/png;base64,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8xUmlnX1//jjD7ez4YYbFvfcc09hD2zd8YG0UTWm5TavvfbaxcEHH1zeVfdb/k+YMKFYfvnl/VN3sLRx1FFHFXPMMUdhPfTS3qIYPXp0sd1229Xta7ahGJrYFscdd5zzNrGsq3b66ae7/RNPPLGwkUPdMTbyJ9DxFbnkkkuGo48+2ns+11xzTRg2bFhYddVVwwILLBA23XRTH0aV37QvvfRSuPHGG73HYA9+0PBq1KhRSd8vGs5dd9113gOdddZZw4orrhi23377MNNMMyW9robYt912m/cC7SUS1l133XD33XeHeeaZp+666kGLiXrk6kGa6NX1TmaeeeZgYuHnzD777HXnakM91UcffTSceuqpYeONNw4mGkG9T9nSsVguueQS761re7311gvrrLOOH1JPSbFTe8VE11LMOnH766+/PL7qASqNsO+++3o75KPSDLvttltYa6214uUrfcumCX545ZVXwoILLuj3R6sTf/zxxzB+/PhwxhlneG9vxx13dL+b1f/uu+88DmKke6BZufPOO8Ott94aFl988bDTTjt5uqNcT/HTZ+LEieXdtd8aAalnqV7/8ccfH/bbbz8f7egZofQAgSrvA3vQ/U1rN2St+l133eX7Pv3009o+e1h9n97uepOPHDnSt8eOHdu0N1S1F9KuZ3n//ff7295CVZhA1K6pa9sQvta2bv5Qz+XSSy/13q6uK/8sBzvNJWLPUnXEJPJQz6VVUQ+6sWdZrmu5tGKXXXZxruqFWl60sGG8V7EH3fdbvrNQLGKxnJ2zUTt0zESoqMJNfm622WaF5VC9/aeccorb13bkHa8Rv9vF9IsvvihWW201P1fnRy5iU+5Z6p4SI+1XncMOO6ywF028RNNvy2973a+//nqa4+pZxuvFUZK2y/dz+ST1YnW8sWcZ69jLo7jssstq8dfo6sknn4yH+c6UgPKOHUsUyy233NKFQeKgoZNuqCiWb7/9tm9LsMrDcg2NVE83YGNp92CV67YSy59++skfKImG0gUqGqJqqKprqr3dLpYXqz0k1rOoXbfZdaJY6mH6/fffvW3WO2qbUugklvE6NoFR2MSR+yn/xd96sL59/fXXezW90C644AL/LT5i8tRTTxV95aYXg86VeClmKko1SPwaS7uY6gUqO5Yb9KGy5RML8dC+KJbW8/Nt7TvzzDOLb775pvES02wr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" width="331" height="126" class="img_ev3q"></p><p>繰り返しになりますが、HTMLではなくプレーンテキストとして表示されます。</p><p>ブラウザのMIMEスニッフィングメカニズムは、どのように機能するのかわからないブラックボックスのような謎だと思うかもしれません。幸いなことに、私たちはChromeでテストしており、Chromiumはオープンソースです。</p><p>ChromiumでMIMEスニッフィングを担当するコードは<a href="https://source.chromium.org/chromium/chromium/src/+/refs/tags/118.0.5981.4:net/base/mime_sniffer.cc" target="_blank" rel="noopener noreferrer">net/base/mime_sniffer.cc</a>にあります。コードの冒頭には、検出の仕組みが説明されています。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// MIMEタイプの検出は、互換性の懸念とセキュリティ問題のバランスを取る必要があるため、トリッキーな作業です。以下に、他のブラウザの動作の概要と、私たちが意図する動作の説明を示します。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// HTMLペイロード、Content-Typeヘッダーなし：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * IE 7：HTMLとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * Firefox 2：HTMLとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * Safari 3：HTMLとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * Opera 9：HTMLとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ここでの選択は明確です：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; Chrome：HTMLとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// HTMLペイロード、Content-Type：「text/plain」：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * IE 7：HTMLとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * Firefox 2：テキストとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * Safari 3：テキストとしてレンダリング（注：URLにHTML拡張子がある場合、SafariはHTMLとしてレンダリングします）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * Opera 9：テキストとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ここでは、大多数に従うことを選択します（そしてIEとの互換性を一部損ないます）。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 多くの人々はIEのここでの動作を嫌っています。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; Chrome：テキストとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// これを次のように一般化します。Content-Typeヘッダーがtext/plainの場合、危険なMIMEタイプ（スクリプトを実行できるもの）は検出しません。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// HTMLペイロード、Content-Type：「application/octet-stream」：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * IE 7：HTMLとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * Firefox 2：application/octet-streamとしてダウンロード</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * Safari 3：HTMLとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// * Opera 9：HTMLとしてレンダリング</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Firefoxに従います。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// =&gt; Chrome：application/octet-streamとしてダウンロード</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// この決定の要因の1つは、IIS 4および5が.xhtmlファイルのapplication/octet-streamを送信することです（拡張子を認識しないため）。いくつかの実験を行ったところ、これはWeb上ではあまり発生しないようです。より安全なオプションを選択します。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>では、ペイロードが「HTMLペイロード」と見なされるのはどのような場合でしょうか？コードのさらに下の方でチェックされています。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// HTMLスニッファはMozillaのものとは若干異なります。例えば、Mozillaは「&lt;!DOCTYPE SOAP-ENV:Envelope PUBLIC 」で始まるドキュメントをHTMLと判断しますが、私たちはそうしません。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">tag</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property punctuation" style="color:#393A34">\</span><span class="token macro property" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token macro property" style="color:#36acaa">  </span><span class="token macro property expression function" style="color:#d73a49">MAGIC_STRING</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property string" style="color:#e3116c">&quot;text/html&quot;</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;&lt;&quot;</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">tag</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> MagicNumber kSniffableTags</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// XML処理命令。これはHTMLのMIMEタイプではありませんが、text/xmlはHTMLと同じくらい強力であり、空白スキップ技術を活用したいため、HTMLフェーズでこれをスニッフィングします。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_NUMBER</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;text/xml&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;?xml&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// DOCTYPE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;!DOCTYPE html&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// HTML5 spec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// スニッフィング可能なタグ、スニッフィング可能なドキュメントでの出現頻度順。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;script&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// HTML5 spec, Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;html&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// HTML5 spec, Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;!--&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;head&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// HTML5 spec, Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;iframe&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;h1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;div&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;font&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;table&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;style&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;title&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;body&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;br&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">MAGIC_HTML_TAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;p&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mozilla</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// コンテンツがHTMLであるように見える場合はtrueを返し、結果を設定します。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// より多くのデータが結果を変更する可能性がある場合は、have_enough_contentをクリアします。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SniffForHTML</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">StringPiece content</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         </span><span class="token keyword" style="color:#00009f">bool</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> have_enough_content</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">string</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// HTMLの場合、最大512バイトまで考慮します。IEは256バイトしか考慮しないため、これは過度に保守的かもしれません。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">have_enough_content </span><span class="token operator" style="color:#393A34">&amp;=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TruncateStringPiece</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">512</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// HTMLタグをスニッフィングするためにMozillaが使用する戦略に似た戦略を採用しますが、HTML5仕様によりよく一致するようにいくつかの変更を加えています。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  base</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">StringPiece trimmed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      base</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">TrimWhitespaceASCII</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> base</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">TRIM_LEADING</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// |trimmed| は最初の非空白文字から始まるか、空です。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CheckForMagicNumbers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trimmed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kSniffableTags</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>レスポンスの先頭の文字列（空白を除去後）が上記のHTMLパターンと一致するかどうかを確認します。<code>&lt;!DOCTYPE html</code>や<code>&lt;html</code>などの一般的なHTMLの先頭が含まれています。これにより、以前のテストで<code>&lt;h1&gt;hello&lt;/h1&gt;</code>の例のみがHTMLとしてレンダリングされた理由も説明できます。</p><p>ソースコードから、ChromiumはURLのファイル拡張子やその他の要因を考慮していないように見えます。ファイルの内容のみに依存しています。これを検証するために、もう一度テストしてみましょう。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> express </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;express&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/test.html&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;abcde&lt;h1&gt;test&lt;/h1&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5555</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Server is running on port 5555&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ここでは画像は含めませんが、URLが<code>test.html</code>であるにもかかわらず、結果は依然としてプレーンテキストとして表示されます。他のブラウザはどうでしょうか？Firefoxで開いてみましょう。</p><p><img loading="lazy" src="/beyond-xss/ja/assets/images/28-04-f88ade6dda3ce4eaa33508591626e600.png" width="454" height="208" class="img_ev3q"></p><p>Firefoxは実際にHTMLとしてレンダリングしていることがわかります！したがって、FirefoxはMIMEスニッフィングを実行する際にURLのファイル拡張子を考慮すると推測できます。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mimeスニッフィングを利用した攻撃-1">MIMEスニッフィングを利用した攻撃<a href="#mimeスニッフィングを利用した攻撃-1" class="hash-link" aria-label="MIMEスニッフィングを利用した攻撃 への直接リンク" title="MIMEスニッフィングを利用した攻撃 への直接リンク">​</a></h2><p>以前の調査から、レスポンスに<code>Content-Type</code>が設定されておらず、コンテンツを制御できる場合、MIMEスニッフィングを使用してブラウザにファイルをウェブページとして解釈させることができるという事実を確認しました。</p><p>例えば、ファイル拡張子のみをチェックし、コンテンツはチェックしない画像アップロード機能があるとします。<code>a.png</code>という名前のファイルをアップロードできますが、コンテンツは<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>です。サーバーがこの画像を提供する際に自動的に<code>Content-Type</code>を追加しない場合、XSS脆弱性になります。</p><p>しかし、最近のほとんどのサーバーは自動的に<code>Content-Type</code>を追加します。それでも可能なのでしょうか？</p><p>はい、他の軽微な問題と組み合わせることができます。</p><p>Apache HTTP Serverは一般的に使用されるサーバーであり、有名なLAMPスタック（Linux + Apache + MySQL + PHP）はこのサーバーを使用しています。</p><p>Apache HTTP Serverには奇妙な動作があります。ファイル名にドット（<code>.</code>）のみが含まれている場合、<code>Content-Type</code>を出力しません。例えば、<code>a.png</code>はファイル拡張子に基づいてMIMEタイプを自動的に検出し、<code>image/png</code>を出力しますが、ファイル名が<code>..png</code>の場合、<code>Content-Type</code>を出力しません。</p><p>したがって、バックエンドがApache HTTP Serverを使用してファイルダウンロードを処理している場合、拡張子が<code>..png</code>の正当に見える画像をアップロードできますが、ブラウザで開くとウェブページとして表示され、XSS脆弱性になります。</p><p>Apache HTTP Serverによると、これは期待される動作であり、詳細については<a href="https://twitter.com/YNizry/status/1582733545759330306" target="_blank" rel="noopener noreferrer">@YNizry</a>を参照してください。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="javascriptを実行できるコンテンツタイプ">JavaScriptを実行できるコンテンツタイプ<a href="#javascriptを実行できるコンテンツタイプ" class="hash-link" aria-label="JavaScriptを実行できるコンテンツタイプ への直接リンク" title="JavaScriptを実行できるコンテンツタイプ への直接リンク">​</a></h2><p>HTMLファイル以外に、JavaScriptを実行できるファイルタイプは他にありますか？</p><p>2020年にBlackFan氏が行った調査「<a href="https://github.com/BlackFan/content-type-research/tree/master" target="_blank" rel="noopener noreferrer">Content-Type Research</a>」では、包括的なリストが提供されています：<a href="https://github.com/BlackFan/content-type-research/blob/master/XSS.md" target="_blank" rel="noopener noreferrer">Content-Type that can be used for XSS</a>。</p><p>リストから、HTML以外にも、XMLとSVGがJavaScriptを実行できる最も一般的なコンテンツタイプであることがわかります。</p><p>ここで特に興味深いのはSVGファイルです。なぜなら、多くのウェブサイトには画像アップロード機能があり、SVGは画像形式と見なされているからです。したがって、一部のウェブサイトではSVGのアップロードが許可されています。しかし、この調査から、SVGのアップロードを許可することは、SVGがJavaScriptを実行できるため、HTMLのアップロードを許可することと同じであることがわかります！</p><p>例えば、febin氏は2022年にオープンソースソフトウェアMantis Bug Trackerに脆弱性を報告しました：<a href="https://mantisbt.org/bugs/view.php?id=30384" target="_blank" rel="noopener noreferrer">CVE-2022-33910: Stored XSS via SVG file upload</a>。この脆弱性は、ユーザーが新しい問題を作成する際にファイルをアップロードでき、許可されるファイル形式がSVGであったために発生しました。したがって、悪意のあるSVGファイルをアップロードでき、他のユーザーがそれを開くと、内部に隠されたコードが実行されます。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="スクリプトとして読み込めるコンテンツタイプ">スクリプトとして読み込めるコンテンツタイプ<a href="#スクリプトとして読み込めるコンテンツタイプ" class="hash-link" aria-label="スクリプトとして読み込めるコンテンツタイプ への直接リンク" title="スクリプトとして読み込めるコンテンツタイプ への直接リンク">​</a></h2><p>次のコードスニペットを例にとってみましょう。</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">URL</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ブラウザが<code>URL</code>をスクリプトとして読み込むには、<code>URL</code>のコンテンツタイプが何であるべきか考えたことはありますか？</p><p>例えば、<code>image/png</code>の場合、機能せず、ブラウザに次のエラーメッセージが表示されます。</p><blockquote><p>スクリプト &#x27;http://localhost:5555/js&#x27; の実行を拒否しました。MIMEタイプ (&#x27;image/png&#x27;) が実行可能でないためです。</p></blockquote><p>最も一般的な<code>text/javascript</code>は明らかに問題なく動作します。しかし、他にはありますか？</p><p>以下にリストされている10個のコンテンツタイプのうち、機能しないのは2つだけです。どちらの2つか推測できますか？</p><ol><li>application/zip</li><li>application/json</li><li>application/octet-stream</li><li>text/csv</li><li>text/html</li><li>text/json</li><li>text/plain</li><li>huli/blog</li><li>video/mp4</li><li>font/woff2</li></ol><p>答えは後で明らかにしますが、まず、Chromiumのソースコードに書かれている「有効なJavaScript MIMEタイプ」を明らかにしましょう：<a href="https://chromium.googlesource.com/chromium/src.git/+/refs/tags/103.0.5012.1/third_party/blink/common/mime_util/mime_util.cc" target="_blank" rel="noopener noreferrer">/third_party/blink/common/mime_util/mime_util.cc</a>：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//  仕様で言及されているすべてのスクリプトタイプをサポートします。仕様には「ユーザーエージェントはすべてのJavaScript MIMEタイプを認識しなければならない」と記載されているためです。https://html.spec.whatwg.org/#javascript-mime-type を参照してください。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> kSupportedJavascriptTypes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;application/ecmascript&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;application/javascript&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;application/x-ecmascript&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;application/x-javascript&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/ecmascript&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/javascript&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/javascript1.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/javascript1.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/javascript1.2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/javascript1.3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/javascript1.4&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/javascript1.5&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/jscript&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/livescript&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/x-ecmascript&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;text/x-javascript&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上記はすべて有効なJavaScript MIMEタイプであり、<code>jscript</code>や<code>livescript</code>など、過去の多くの名残を見ることができます。</p><p>有効なJavaScript MIMEタイプ以外に、仕様によると、機能しないタイプは4つだけです。</p><ol><li><code>audio/*</code></li><li><code>image/*</code></li><li><code>video/*</code></li><li><code>text/csv</code></li></ol><p>これらを除いて、他のすべてのタイプは有効です。したがって、上記のオプションの中で、<code>text/csv</code>と<code>video/mp4</code>のみが機能せず、残りは機能します！はい、<code>text/html</code>と<code>application/json</code>も機能し、<code>huli/blog</code>も機能します。</p><p>この寛大なメカニズムを強化し、JavaScript MIMEタイプのみを読み込ませたい場合は、レスポンスにヘッダーを追加できます：<code>X-Content-Type-Options: nosniff</code>。このヘッダーを追加すると、前述の10個の例はすべて機能しなくなり、読み込み時に次のエラーが表示されます。</p><blockquote><p>スクリプト &#x27;http://localhost:5555/js&#x27; の実行を拒否しました。MIMEタイプ (&#x27;text/plain&#x27;) が実行可能でなく、厳密なMIMEタイプチェックが有効になっているためです。</p></blockquote><p><code>strict MIME type</code>は、そのヘッダーを追加することで有効になる機能です。</p><p>スタイルシートも同様です。この機能を有効にすると、<code>text/css</code> MIMEタイプのみが有効として認識され、その他はすべてエラーになります。</p><p>では、この機能を有効にし続けるとどうなるでしょうか？追加のセキュリティリスクが発生します。</p><p>あるウェブサイトでXSS脆弱性を見つけたとします。しかし、問題は、ウェブサイトのCSPが<code>script-src &#x27;self&#x27;;</code>であり、外部スクリプトの読み込みが許可されておらず、インラインスクリプトもブロックされていることです。この場合、どのようにCSPをバイパスできるでしょうか？</p><p>ウェブサイトが画像、動画、CSVファイル以外のファイルを受け入れるファイルアップロード機能を提供し、コンテンツをチェックしない場合、ZIPファイルのみを受け入れるとします。その場合、JavaScriptコードを含むファイルをアップロードできます。</p><p>このようにして、<code>&lt;script src=&quot;/uploads/files/my.zip&quot;&gt;&lt;/script&gt;</code>を使用してスクリプトを読み込み、CSPを正常にバイパスできます。これが機能する理由は、前述の動作のためです。MIMEタイプがそれらのいくつかのタイプでない限り、スクリプトとして読み込むことができます。</p><p>これが、多くのウェブサイトがこのヘッダーを追加している理由であり、そのような動作を防ぐためです。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a href="#まとめ" class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク">​</a></h2><p>この記事では、MIMEタイプに関連する多くの興味深いことを見て、Chromiumのソースコードもたくさん見ました。個人的には、Chromiumのソースコードは非常に明確に書かれており、コメントや仕様へのリンクも含まれているため、別途仕様を検索する必要がないと感じています。一石二鳥のようなものです。</p><p>最後に、<code>X-Content-Type-Options: nosniff</code>ヘッダーの目的と機能を紹介しました。多くの人がこのヘッダーを見たことがあると思いますが、何のためにあるのか知らなかったでしょう。そして今、あなたは知っています。</p><p>参考文献：</p><ol><li><a href="https://blog.huli.tw/2022/08/01/en/uiuctf-2022-writeup/" target="_blank" rel="noopener noreferrer">UIUCTF 2022 Write-up</a></li><li><a href="https://blog.huli.tw/2022/04/24/ja/script-type/" target="_blank" rel="noopener noreferrer">スクリプトタイプについてどれくらい知っていますか？</a></li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/beyond-xss/ja/ch5/clickjacking/"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">あなたの画面はあなたの画面ではない：クリックジャッキング</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/beyond-xss/ja/ch5/supply-chain-attack/"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">フロントエンドサプライチェーン攻撃：上流から下流への攻撃</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mimeスニッフィング入門" class="table-of-contents__link toc-highlight">MIMEスニッフィング入門</a></li><li><a href="#mimeスニッフィングを利用した攻撃-1" class="table-of-contents__link toc-highlight">MIMEスニッフィングを利用した攻撃</a></li><li><a href="#javascriptを実行できるコンテンツタイプ" class="table-of-contents__link toc-highlight">JavaScriptを実行できるコンテンツタイプ</a></li><li><a href="#スクリプトとして読み込めるコンテンツタイプ" class="table-of-contents__link toc-highlight">スクリプトとして読み込めるコンテンツタイプ</a></li><li><a href="#まとめ" class="table-of-contents__link toc-highlight">まとめ</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Huli. All rights reserved. Built with Docusaurus.</div></div></div></footer></div>
<script src="/beyond-xss/ja/assets/js/runtime~main.531fd90e.js"></script>
<script src="/beyond-xss/ja/assets/js/main.b4cb8381.js"></script>
</body>
</html>